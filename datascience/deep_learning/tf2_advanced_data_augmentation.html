
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Data augmentation &#8212; 데사견문록</title>
    
  <link href="../../_static/css/theme.css" rel="stylesheet" />
  <link href="../../_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/sphinx-book-theme.acff12b8f9c144ce68a297486a2fa670.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../../_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/togglebutton.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Image Segmentation" href="tf2_advanced_image_segmentation.html" />
    <link rel="prev" title="Transfer learning with TensorFlow Hub" href="tf2_advanced_transfer_learning_with_hub.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
      <img src="../../_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">데사견문록</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../readme.html">
   데이터사이언스견문록
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  DataScience
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../e2eds.html">
   End to End Data Science (E2EDS)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../random_seed.html">
   Random
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../dataprep.html">
   Data Preperation
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../dataprep/data_type.html">
     Data Type
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../dataprep/spark_dataframe_10mins.html">
     Spark DataFrame 10mins
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../dataprep/pandas_10mins.html">
     Pandas 10mins
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../dataprep/numpy_10mins.html">
     Numpy 10mins
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../data_analytics.html">
   Data Analytics
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../data_analytics/data_description.html">
     Data Description
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../data_analytics/missing_value.html">
     Missing Value
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../data_analytics/descriptive_statistics.html">
     Descriptive Statistcs
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../data_analytics/inferential_statistics.html">
     Inferential Statistcs
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../data_analytics/inferential_statistics/probability_distribution.html">
     Probability Distribution
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../data_analytics/inferential_statistics/estimation.html">
     Estimation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../data_analytics/inferential_statistics/testing_hypothesis.html">
     Testing Hypothesis
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../data_analytics/bayesian_statistics.html">
     Bayesian Statistics
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../data_analytics/outlier.html">
     Outlier
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../data_analytics/scipy_normality_test.html">
     Normality Test
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../data_analytics/scipy_statistics_test.html">
     Statistics Test
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../data_analytics/parallel_algorithm.html">
     One-Pass/Parallel Algorithm
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../machine_learning.html">
   Machine Learning
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../machine_learning/sklearn_feature_selection.html">
     Feature Selection
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../machine_learning/sklearn_feature_extraction.html">
     Feature Extraction
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../machine_learning/sklearn_feature_transformation.html">
     Feature Transformation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../machine_learning/sklearn_split_train_test.html">
     Train/Valid/Test Dataset
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../machine_learning/imblearn_imbalanced_class.html">
     Imbalanced Class
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../machine_learning/sklearn_model_persistence.html">
     Model Persistence
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../machine_learning/sklearn_eval_regression.html">
     Regression Evaluation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../machine_learning/sklearn_linear_regression.html">
     Linear Regression
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../machine_learning/sklearn_polynomial_regression.html">
     Polynomial Regression
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../machine_learning/sklearn_sgd_regression.html">
     SGD Regression
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../machine_learning/sklearn_svm_regression.html">
     SVM Regression
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../machine_learning/sklearn_nearest_neighbor_regression.html">
     Nearest Neighbors Regression
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../machine_learning/sklearn_ensemble_regression.html">
     Ensemble Regression
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../machine_learning/sklearn_eval_classification.html">
     Classification Evaluation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../machine_learning/sklearn_logistic_regression.html">
     Logistic Regression
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../machine_learning/sklearn_sgd_classification.html">
     SGD Classification
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../machine_learning/sklearn_svm_classification.html">
     SVM Classification
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../machine_learning/sklearn_nearest_neighbor_classification.html">
     Nearest Neighbors Classification
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../machine_learning/sklearn_ensemble_classification.html">
     Ensemble Classification
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../machine_learning/sklearn_eval_clustering.html">
     Clustering Evaluation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../machine_learning/sklearn_kmeans.html">
     K-Means
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../machine_learning/sklearn_mean_shift.html">
     Mean Shift
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../machine_learning/sklearn_spectral_clustering.html">
     Spectral Clustering
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../machine_learning/sklearn_hyper_parameter_tunning.html">
     Hyper Parameter Tunning
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../machine_learning/sklearn_anomaly_detection.html">
     Anomaly Detection
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../machine_learning/surprise_collaborative_filtering.html">
     Collaborative Filtering
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../machine_learning/frontal_face_detector.html">
     Frontal Face Detector
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="../deep_learning.html">
   Deep Learning
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="keras_10mins.html">
     Keras 10mins
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="keras_dnn_regression.html">
     DNN Regression
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="keras_dnn_classification.html">
     DNN Classification
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="keras_deepmf.html">
     Deep MF
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="tf2_10mins.html">
     TF2 10mins
    </a>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="tf2_beginner.html">
     TF2 Beginner
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
    <label for="toctree-checkbox-5">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="tf2_beginner_quickstart.html">
       Quickstart
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="tf2_beginner_image_classification.html">
       Image Classification
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="tf2_beginner_text_classification.html">
       Text Classification
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="tf2_beginner_hub_text_classification.html">
       Text Classification with Hub
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="tf2_beginner_regression.html">
       Regression
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="tf2_beginner_overfit_underfit.html">
       Overfit &amp; Underfit
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="tf2_beginner_save_load.html">
       Save &amp; Load
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="tf2_beginner_keras_tuner.html">
       Keras Tuner
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="tf2_beginner_images.html">
       Images
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="tf2_beginner_csv.html">
       CSV
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="tf2_beginner_numpy.html">
       Numpy
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="tf2_beginner_pandas.html">
       Pandas
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="tf2_beginner_text.html">
       Text
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="tf2_beginner_unicode.html">
       Unicode
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="tf2_beginner_tftext.html">
       TF.Text
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="tf2_beginner_subwords_tokenizer.html">
       Subword Tokenization
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="tf2_beginner_tfrecord.html">
       TFRecord and tf.train.Example
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="tf2_beginner_tfio.html">
       TF I/O
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 current active has-children">
    <a class="reference internal" href="tf2_advanced.html">
     TF2 Advanced
    </a>
    <input checked="" class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
    <label for="toctree-checkbox-6">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul class="current">
     <li class="toctree-l3">
      <a class="reference internal" href="tf2_advanced_quickstart.html">
       Quickstart
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="tf2_advanced_image_cnn.html">
       Image CNN
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="tf2_advanced_image_classification.html">
       Image Classification
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="tf2_advanced_transfer_learning.html">
       Transfer learning and fine-tuning
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="tf2_advanced_transfer_learning_with_hub.html">
       Transfer learning with TensorFlow Hub
      </a>
     </li>
     <li class="toctree-l3 current active">
      <a class="current reference internal" href="#">
       Data augmentation
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="tf2_advanced_image_segmentation.html">
       Image Segmentation
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../deploy.html">
   Deployment
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
  <label for="toctree-checkbox-7">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../deploy/streamlit.html">
     Streamlit
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../deploy/flask.html">
     Flask
    </a>
   </li>
  </ul>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  DataPlatform
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../dataplatform/e2edp.html">
   End to End Data Platform (E2EDP)
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../dataplatform/infra.html">
   Infrastructure
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
  <label for="toctree-checkbox-8">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../dataplatform/infra_computer.html">
     Computer
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../dataplatform/infra_network.html">
     Network
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../dataplatform/gce-nested-vm.html">
     Google Computer Engine
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../dataplatform/jupyter.html">
   Jupyter
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/>
  <label for="toctree-checkbox-9">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../dataplatform/jupyter_cloud.html">
     Jupyter (Cloud)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../dataplatform/jupyter_native_ubuntu.html">
     Jupyter (Ubuntu)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../dataplatform/jupyter_native_macos.html">
     Jupyter (macOS)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../dataplatform/jupyter_docker.html">
     Jupyter (Docker)
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../dataplatform/vagrant_virtualbox.html">
   Vagrant &amp; Virtualbox
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/>
  <label for="toctree-checkbox-10">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../dataplatform/vagrant_skp_single.html">
     vagrant_skp_single
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../dataplatform/ansible.html">
   Ansible
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/>
  <label for="toctree-checkbox-11">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../dataplatform/ansible_skp_ubuntu.html">
     ansible_skp_ubuntu
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../dataplatform/skp.html">
   St. Kilda Pier (SKP)
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" type="checkbox"/>
  <label for="toctree-checkbox-12">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../dataplatform/skp_n4e_vscode.html">
     Native Visual Studio Code
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../dataplatform/skp_n4e_jupyter.html">
     Native Jupyter
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../dataplatform/skp_d4r_jupyter.html">
     Docker Jupyter
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../dataplatform/skp_n4e_traefik.html">
     Native Traefik
    </a>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../_sources/datascience/deep_learning/tf2_advanced_data_augmentation.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/comafire/comafire.github.io"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/comafire/comafire.github.io/issues/new?title=Issue%20on%20page%20%2Fdatascience/deep_learning/tf2_advanced_data_augmentation.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/comafire/comafire.github.io/master?urlpath=tree/datascience/deep_learning/tf2_advanced_data_augmentation.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#copyright-2020-the-tensorflow-authors">
   Copyright 2020 The TensorFlow Authors.
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id1">
   Data augmentation
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#overview">
   Overview
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#download-a-dataset">
   Download a dataset
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#use-keras-preprocessing-layers">
   Use Keras preprocessing layers
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#resizing-and-rescaling">
     Resizing and rescaling
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id2">
     Data augmentation
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#two-options-to-use-the-preprocessing-layers">
     Two options to use the preprocessing layers
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#option-1-make-the-preprocessing-layers-part-of-your-model">
       Option 1: Make the preprocessing layers part of your model
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#option-2-apply-the-preprocessing-layers-to-your-dataset">
       Option 2: Apply the preprocessing layers to your dataset
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#apply-the-preprocessing-layers-to-the-datasets">
     Apply the preprocessing layers to the datasets
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#train-a-model">
     Train a model
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#custom-data-augmentation">
     Custom data augmentation
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#using-tf-image">
   Using tf.image
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id3">
     Data augmentation
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#flipping-the-image">
       Flipping the image
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#grayscale-the-image">
       Grayscale the image
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#saturate-the-image">
       Saturate the image
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#change-image-brightness">
       Change image brightness
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#center-crop-the-image">
       Center crop the image
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#rotate-the-image">
       Rotate the image
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#random-transformations">
     Random transformations
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#randomly-change-image-brightness">
       Randomly change image brightness
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#randomly-change-image-contrast">
       Randomly change image contrast
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#randomly-crop-an-image">
       Randomly crop an image
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#apply-augmentation-to-a-dataset">
     Apply augmentation to a dataset
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#option-1-using-tf-data-experimental-counter">
       Option 1: Using
       <code class="docutils literal notranslate">
        <span class="pre">
         tf.data.experimental.Counter()
        </span>
       </code>
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#option-2-using-tf-random-generator">
       Option 2: Using
       <code class="docutils literal notranslate">
        <span class="pre">
         tf.random.Generator
        </span>
       </code>
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#next-steps">
   Next steps
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="data-augmentation">
<h1>Data augmentation<a class="headerlink" href="#data-augmentation" title="Permalink to this headline">¶</a></h1>
<p>TensorFlow2 공식 홈페이지에 나와 있는 코드들을 수행해 보면서 빠르게 TensorFlow2를 익혀 봅니다.</p>
<p><a class="reference external" href="https://www.tensorflow.org/tutorials/images/data_augmentation">https://www.tensorflow.org/tutorials/images/data_augmentation</a></p>
<div class="section" id="copyright-2020-the-tensorflow-authors">
<h2>Copyright 2020 The TensorFlow Authors.<a class="headerlink" href="#copyright-2020-the-tensorflow-authors" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#@title Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<span class="c1"># you may not use this file except in compliance with the License.</span>
<span class="c1"># You may obtain a copy of the License at</span>
<span class="c1">#</span>
<span class="c1"># https://www.apache.org/licenses/LICENSE-2.0</span>
<span class="c1">#</span>
<span class="c1"># Unless required by applicable law or agreed to in writing, software</span>
<span class="c1"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span class="c1"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="c1"># See the License for the specific language governing permissions and</span>
<span class="c1"># limitations under the License.</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 경고 메시지 출력 끄기</span>
<span class="kn">import</span> <span class="nn">warnings</span> 
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="n">action</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">display</span><span class="p">,</span> <span class="n">clear_output</span>

<span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">shutil</span>

<span class="n">rseed</span> <span class="o">=</span> <span class="mi">22</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">rseed</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">rseed</span><span class="p">)</span>
<span class="n">np</span><span class="o">.</span><span class="n">set_printoptions</span><span class="p">(</span><span class="n">precision</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">np</span><span class="o">.</span><span class="n">set_printoptions</span><span class="p">(</span><span class="n">formatter</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;float_kind&#39;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">{:.5f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">})</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.max_rows&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> 
<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.max_columns&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> 
<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.max_colwidth&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">float_format</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{:,.5f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span>

<span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
<span class="n">tf</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">set_seed</span><span class="p">(</span><span class="n">rseed</span><span class="p">)</span>
<span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">set_floatx</span><span class="p">(</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span> <span class="c1"># keras default float type 설정</span>

<span class="kn">import</span> <span class="nn">tensorflow_hub</span> <span class="k">as</span> <span class="nn">tfhub</span>
<span class="kn">import</span> <span class="nn">tensorflow_datasets</span> <span class="k">as</span> <span class="nn">tfds</span>

<span class="kn">import</span> <span class="nn">kerastuner</span> <span class="k">as</span> <span class="nn">kt</span>

<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>

<span class="kn">import</span> <span class="nn">PIL</span>
<span class="kn">import</span> <span class="nn">PIL.Image</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;python ver=</span><span class="si">{</span><span class="n">sys</span><span class="o">.</span><span class="n">version</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;pandas ver=</span><span class="si">{</span><span class="n">pd</span><span class="o">.</span><span class="n">__version__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;numpy ver=</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">__version__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;tensorflow ver=</span><span class="si">{</span><span class="n">tf</span><span class="o">.</span><span class="n">__version__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;tensorflow execuring eagerly=</span><span class="si">{</span><span class="n">tf</span><span class="o">.</span><span class="n">executing_eagerly</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;tensorflow hub ver=</span><span class="si">{</span><span class="n">tfhub</span><span class="o">.</span><span class="n">__version__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;tensorflow GPU=</span><span class="si">{</span><span class="s1">&#39;True&#39;</span> <span class="k">if</span> <span class="n">tf</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">experimental</span><span class="o">.</span><span class="n">list_physical_devices</span><span class="p">(</span><span class="s1">&#39;GPU&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="s1">&#39;False&#39;</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;keras tuner ver=</span><span class="si">{</span><span class="n">kt</span><span class="o">.</span><span class="n">__version__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;senborn ver=</span><span class="si">{</span><span class="n">sns</span><span class="o">.</span><span class="n">__version__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;PIL ver=</span><span class="si">{</span><span class="n">PIL</span><span class="o">.</span><span class="n">__version__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>python ver=3.7.6 (default, Nov 21 2020, 22:51:13) 
[Clang 12.0.0 (clang-1200.0.32.27)]
pandas ver=1.0.5
numpy ver=1.19.5
tensorflow ver=2.4.1
tensorflow execuring eagerly=True
tensorflow hub ver=0.11.0
tensorflow GPU=False
keras tuner ver=1.0.2
senborn ver=0.10.0
PIL ver=7.1.2
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="id1">
<h2>Data augmentation<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<table class="tfo-notebook-buttons" align="left">
  <td>
    <a target="_blank" href="https://www.tensorflow.org/tutorials/images/data_augmentation"><img src="https://www.tensorflow.org/images/tf_logo_32px.png" />View on TensorFlow.org</a>
  </td>
  <td>
    <a target="_blank" href="https://colab.research.google.com/github/tensorflow/docs/blob/master/site/en/tutorials/images/data_augmentation.ipynb"><img src="https://www.tensorflow.org/images/colab_logo_32px.png" />Run in Google Colab</a>
  </td>
  <td>
    <a target="_blank" href="https://github.com/tensorflow/docs/blob/master/site/en/tutorials/images/data_augmentation.ipynb"><img src="https://www.tensorflow.org/images/GitHub-Mark-32px.png" />View source on GitHub</a>
  </td>
  <td>
    <a href="https://storage.googleapis.com/tensorflow_docs/docs/site/en/tutorials/images/data_augmentation.ipynb"><img src="https://www.tensorflow.org/images/download_logo_32px.png" />Download notebook</a>
  </td>
</table>
*</div>
<hr class="docutils" />
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>This tutorial demonstrates data augmentation: a technique to increase the diversity of your training set by applying random (but realistic) transformations such as image rotation. You will learn how to apply data augmentation in two ways. First, you will use <a class="reference external" href="https://www.tensorflow.org/api_docs/python/tf/keras/layers/experimental/preprocessing/">Keras Preprocessing Layers</a>. Next, you will use <code class="docutils literal notranslate"><span class="pre">tf.image</span></code>.</p>
</div>
<div class="section" id="download-a-dataset">
<h2>Download a dataset<a class="headerlink" href="#download-a-dataset" title="Permalink to this headline">¶</a></h2>
<p>This tutorial uses the <a class="reference external" href="https://www.tensorflow.org/datasets/catalog/tf_flowers">tf_flowers</a> dataset. For convenience, download the dataset using <a class="reference external" href="https://www.tensorflow.org/datasets">TensorFlow Datasets</a>. If you would like to learn about others ways of importing data, see the <a class="reference external" href="https://www.tensorflow.org/tutorials/load_data/images">load images</a> tutorial.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">train_ds</span><span class="p">,</span> <span class="n">val_ds</span><span class="p">,</span> <span class="n">test_ds</span><span class="p">),</span> <span class="n">metadata</span> <span class="o">=</span> <span class="n">tfds</span><span class="o">.</span><span class="n">load</span><span class="p">(</span>
    <span class="s1">&#39;tf_flowers&#39;</span><span class="p">,</span>
    <span class="n">split</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;train[:80%]&#39;</span><span class="p">,</span> <span class="s1">&#39;train[80%:90%]&#39;</span><span class="p">,</span> <span class="s1">&#39;train[90%:]&#39;</span><span class="p">],</span>
    <span class="n">with_info</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">as_supervised</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The flowers dataset has five classes.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">num_classes</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">num_classes</span>
<span class="nb">print</span><span class="p">(</span><span class="n">num_classes</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>5
</pre></div>
</div>
</div>
</div>
<p>Let’s retrieve an image from the dataset and use it to demonstrate data augmentation.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">get_label_name</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">int2str</span>

<span class="n">image</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">train_ds</span><span class="p">))</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">get_label_name</span><span class="p">(</span><span class="n">label</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/tf2_advanced_data_augmentation_12_0.png" src="../../_images/tf2_advanced_data_augmentation_12_0.png" />
</div>
</div>
</div>
<div class="section" id="use-keras-preprocessing-layers">
<h2>Use Keras preprocessing layers<a class="headerlink" href="#use-keras-preprocessing-layers" title="Permalink to this headline">¶</a></h2>
<p>Note: The <a class="reference external" href="https://www.tensorflow.org/api_docs/python/tf/keras/layers/experimental/preprocessing">Keras Preprocesing Layers</a> introduced in this section are currently experimental.</p>
<div class="section" id="resizing-and-rescaling">
<h3>Resizing and rescaling<a class="headerlink" href="#resizing-and-rescaling" title="Permalink to this headline">¶</a></h3>
<p>You can use preprocessing layers to <a class="reference external" href="https://www.tensorflow.org/api_docs/python/tf/keras/layers/experimental/preprocessing/Resizing">resize</a> your images to a consistent shape, and to <a class="reference external" href="https://www.tensorflow.org/api_docs/python/tf/keras/layers/experimental/preprocessing/Rescaling">rescale</a> pixel values.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">IMG_SIZE</span> <span class="o">=</span> <span class="mi">180</span>

<span class="n">resize_and_rescale</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Sequential</span><span class="p">([</span>
  <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">experimental</span><span class="o">.</span><span class="n">preprocessing</span><span class="o">.</span><span class="n">Resizing</span><span class="p">(</span><span class="n">IMG_SIZE</span><span class="p">,</span> <span class="n">IMG_SIZE</span><span class="p">),</span>
  <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">experimental</span><span class="o">.</span><span class="n">preprocessing</span><span class="o">.</span><span class="n">Rescaling</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="mi">255</span><span class="p">)</span>
<span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>Note: the rescaling layer above standardizes pixel values to <code class="docutils literal notranslate"><span class="pre">[0,1]</span></code>. If instead you wanted <code class="docutils literal notranslate"><span class="pre">[-1,1]</span></code>, you would write <code class="docutils literal notranslate"><span class="pre">Rescaling(1./127.5,</span> <span class="pre">offset=-1)</span></code>.</p>
<p>You can see the result of applying these layers to an image.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">result</span> <span class="o">=</span> <span class="n">resize_and_rescale</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/tf2_advanced_data_augmentation_20_0.png" src="../../_images/tf2_advanced_data_augmentation_20_0.png" />
</div>
</div>
<p>You can verify the pixels are in <code class="docutils literal notranslate"><span class="pre">[0-1]</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Min and max pixel values:&quot;</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">result</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Min and max pixel values: 0.0 1.0
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="id2">
<h3>Data augmentation<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<p>You can use preprocessing layers for data augmentation as well.</p>
<p>Let’s create a few preprocessing layers and apply them repeatedly to the same image.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_augmentation</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Sequential</span><span class="p">([</span>
  <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">experimental</span><span class="o">.</span><span class="n">preprocessing</span><span class="o">.</span><span class="n">RandomFlip</span><span class="p">(</span><span class="s2">&quot;horizontal_and_vertical&quot;</span><span class="p">),</span>
  <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">experimental</span><span class="o">.</span><span class="n">preprocessing</span><span class="o">.</span><span class="n">RandomRotation</span><span class="p">(</span><span class="mf">0.2</span><span class="p">),</span>
<span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Add the image to a batch</span>
<span class="n">image</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">9</span><span class="p">):</span>
    <span class="n">augmented_image</span> <span class="o">=</span> <span class="n">data_augmentation</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">augmented_image</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/tf2_advanced_data_augmentation_28_0.png" src="../../_images/tf2_advanced_data_augmentation_28_0.png" />
</div>
</div>
<p>There are a variety of preprocessing <a class="reference external" href="https://www.tensorflow.org/api_docs/python/tf/keras/layers/experimental/preprocessing">layers</a> you can use for data augmentation including <code class="docutils literal notranslate"><span class="pre">layers.RandomContrast</span></code>, <code class="docutils literal notranslate"><span class="pre">layers.RandomCrop</span></code>, <code class="docutils literal notranslate"><span class="pre">layers.RandomZoom</span></code>, and others.</p>
</div>
<div class="section" id="two-options-to-use-the-preprocessing-layers">
<h3>Two options to use the preprocessing layers<a class="headerlink" href="#two-options-to-use-the-preprocessing-layers" title="Permalink to this headline">¶</a></h3>
<p>There are two ways you can use these preprocessing layers, with important tradeoffs.</p>
<div class="section" id="option-1-make-the-preprocessing-layers-part-of-your-model">
<h4>Option 1: Make the preprocessing layers part of your model<a class="headerlink" href="#option-1-make-the-preprocessing-layers-part-of-your-model" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Sequential</span><span class="p">([</span>
  <span class="n">resize_and_rescale</span><span class="p">,</span>
  <span class="n">data_augmentation</span><span class="p">,</span>
  <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Conv2D</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="s1">&#39;same&#39;</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">),</span>
  <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">MaxPooling2D</span><span class="p">(),</span>
  <span class="c1"># Rest of your model</span>
<span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>There are two important points to be aware of in this case:</p>
<ul class="simple">
<li><p>Data augmentation will run on-device, synchronously with the rest of your layers, and benefit from GPU acceleration.</p></li>
<li><p>When you export your model using <code class="docutils literal notranslate"><span class="pre">model.save</span></code>, the preprocessing layers will be saved along with the rest of your model. If you later deploy this model, it will automatically standardize images (according to the configuration of your layers). This can save you from the effort of having to reimplement that logic server-side.</p></li>
</ul>
<p>Note: Data augmentation is inactive at test time so input images will only be augmented during calls to <code class="docutils literal notranslate"><span class="pre">model.fit</span></code> (not <code class="docutils literal notranslate"><span class="pre">model.evaluate</span></code> or <code class="docutils literal notranslate"><span class="pre">model.predict</span></code>).</p>
</div>
<div class="section" id="option-2-apply-the-preprocessing-layers-to-your-dataset">
<h4>Option 2: Apply the preprocessing layers to your dataset<a class="headerlink" href="#option-2-apply-the-preprocessing-layers-to-your-dataset" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">aug_ds</span> <span class="o">=</span> <span class="n">train_ds</span><span class="o">.</span><span class="n">map</span><span class="p">(</span>
  <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="p">(</span><span class="n">resize_and_rescale</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">training</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="n">y</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>With this approach, you use <code class="docutils literal notranslate"><span class="pre">Dataset.map</span></code> to create a dataset that yields batches of augmented images. In this case:</p>
<ul class="simple">
<li><p>Data augmentation will happen asynchronously on the CPU, and is non-blocking. You can overlap the training of your model on the GPU with data preprocessing, using <code class="docutils literal notranslate"><span class="pre">Dataset.prefetch</span></code>, shown below.</p></li>
<li><p>In this case the prepreprocessing layers will not be exported with the model when you call <code class="docutils literal notranslate"><span class="pre">model.save</span></code>. You will need to attach them to your model before saving it or reimplement them server-side. After training, you can attach the preprocessing layers before export.</p></li>
</ul>
<p>You can find an example of the first option in the <a class="reference external" href="https://www.tensorflow.org/tutorials/images/classification">image classification</a> tutorial. Let’s demonstrate the second option here.</p>
</div>
</div>
<div class="section" id="apply-the-preprocessing-layers-to-the-datasets">
<h3>Apply the preprocessing layers to the datasets<a class="headerlink" href="#apply-the-preprocessing-layers-to-the-datasets" title="Permalink to this headline">¶</a></h3>
<p>Configure the train, validation, and test datasets with the preprocessing layers you created above. You will also configure the datasets for performance, using parallel reads and buffered prefetching to yield batches from disk without I/O become blocking. You can learn more dataset performance in the <a class="reference external" href="https://www.tensorflow.org/guide/data_performance">Better performance with the tf.data API</a> guide.</p>
<p>Note: data augmentation should only be applied to the training set.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">batch_size</span> <span class="o">=</span> <span class="mi">32</span>
<span class="n">AUTOTUNE</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">AUTOTUNE</span>

<span class="k">def</span> <span class="nf">prepare</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">augment</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="c1"># Resize and rescale all datasets</span>
    <span class="n">ds</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="p">(</span><span class="n">resize_and_rescale</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">y</span><span class="p">),</span> <span class="n">num_parallel_calls</span><span class="o">=</span><span class="n">AUTOTUNE</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">shuffle</span><span class="p">:</span>
        <span class="n">ds</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>

    <span class="c1"># Batch all datasets</span>
    <span class="n">ds</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">batch</span><span class="p">(</span><span class="n">batch_size</span><span class="p">)</span>

    <span class="c1"># Use data augmentation only on the training set</span>
    <span class="k">if</span> <span class="n">augment</span><span class="p">:</span>
        <span class="n">ds</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="p">(</span><span class="n">data_augmentation</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">training</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="n">y</span><span class="p">),</span> <span class="n">num_parallel_calls</span><span class="o">=</span><span class="n">AUTOTUNE</span><span class="p">)</span>

    <span class="c1"># Use buffered prefecting on all datasets</span>
    <span class="k">return</span> <span class="n">ds</span><span class="o">.</span><span class="n">prefetch</span><span class="p">(</span><span class="n">buffer_size</span><span class="o">=</span><span class="n">AUTOTUNE</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train_ds</span> <span class="o">=</span> <span class="n">prepare</span><span class="p">(</span><span class="n">train_ds</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">augment</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">val_ds</span> <span class="o">=</span> <span class="n">prepare</span><span class="p">(</span><span class="n">val_ds</span><span class="p">)</span>
<span class="n">test_ds</span> <span class="o">=</span> <span class="n">prepare</span><span class="p">(</span><span class="n">test_ds</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="train-a-model">
<h3>Train a model<a class="headerlink" href="#train-a-model" title="Permalink to this headline">¶</a></h3>
<p>For completeness, you will now train a model using these datasets. This model has not been tuned for accuracy (the goal is to show you the mechanics).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Sequential</span><span class="p">([</span>
  <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Conv2D</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="s1">&#39;same&#39;</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">),</span>
  <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">MaxPooling2D</span><span class="p">(),</span>
  <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Conv2D</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="s1">&#39;same&#39;</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">),</span>
  <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">MaxPooling2D</span><span class="p">(),</span>
  <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Conv2D</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="s1">&#39;same&#39;</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">),</span>
  <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">MaxPooling2D</span><span class="p">(),</span>
  <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Flatten</span><span class="p">(),</span>
  <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">),</span>
  <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">num_classes</span><span class="p">)</span>
<span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">optimizer</span><span class="o">=</span><span class="s1">&#39;adam&#39;</span><span class="p">,</span>
              <span class="n">loss</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">losses</span><span class="o">.</span><span class="n">SparseCategoricalCrossentropy</span><span class="p">(</span><span class="n">from_logits</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
              <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;accuracy&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">epochs</span><span class="o">=</span><span class="mi">5</span>
<span class="n">history</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span>
  <span class="n">train_ds</span><span class="p">,</span>
  <span class="n">validation_data</span><span class="o">=</span><span class="n">val_ds</span><span class="p">,</span>
  <span class="n">epochs</span><span class="o">=</span><span class="n">epochs</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 1/5
92/92 [==============================] - 23s 232ms/step - loss: 1.5065 - accuracy: 0.3510 - val_loss: 1.0840 - val_accuracy: 0.5722
Epoch 2/5
92/92 [==============================] - 22s 240ms/step - loss: 1.0691 - accuracy: 0.5755 - val_loss: 1.0007 - val_accuracy: 0.5913
Epoch 3/5
92/92 [==============================] - 23s 241ms/step - loss: 0.9552 - accuracy: 0.6300 - val_loss: 0.9187 - val_accuracy: 0.6567
Epoch 4/5
92/92 [==============================] - 21s 230ms/step - loss: 0.8987 - accuracy: 0.6478 - val_loss: 0.8020 - val_accuracy: 0.6866
Epoch 5/5
92/92 [==============================] - 21s 226ms/step - loss: 0.8743 - accuracy: 0.6727 - val_loss: 0.8206 - val_accuracy: 0.6812
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">loss</span><span class="p">,</span> <span class="n">acc</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">test_ds</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Accuracy&quot;</span><span class="p">,</span> <span class="n">acc</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>12/12 [==============================] - 1s 49ms/step - loss: 0.7597 - accuracy: 0.7057
Accuracy 0.7057220935821533
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="custom-data-augmentation">
<h3>Custom data augmentation<a class="headerlink" href="#custom-data-augmentation" title="Permalink to this headline">¶</a></h3>
<p>You can also create custom data augmenation layers. This tutorial shows two ways of doing so. First, you will create a <code class="docutils literal notranslate"><span class="pre">layers.Lambda</span></code> layer. This is a good way to write concise code. Next, you will write a new layer via <a class="reference external" href="https://www.tensorflow.org/guide/keras/custom_layers_and_models">subclassing</a>, which gives you more control. Both layers will randomly invert the colors in an image, according to some probability.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">random_invert_img</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
    <span class="k">if</span>  <span class="n">tf</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">([])</span> <span class="o">&lt;</span> <span class="n">p</span><span class="p">:</span>
        <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="mi">255</span><span class="o">-</span><span class="n">x</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">x</span>
    <span class="k">return</span> <span class="n">x</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">random_invert</span><span class="p">(</span><span class="n">factor</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Lambda</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">random_invert_img</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">factor</span><span class="p">))</span>

<span class="n">random_invert</span> <span class="o">=</span> <span class="n">random_invert</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">9</span><span class="p">):</span>
    <span class="n">augmented_image</span> <span class="o">=</span> <span class="n">random_invert</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">augmented_image</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;uint8&quot;</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/tf2_advanced_data_augmentation_52_0.png" src="../../_images/tf2_advanced_data_augmentation_52_0.png" />
</div>
</div>
<p>Next, implement a custom layer by <a class="reference external" href="https://www.tensorflow.org/guide/keras/custom_layers_and_models">subclassing</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">RandomInvert</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Layer</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">factor</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">factor</span> <span class="o">=</span> <span class="n">factor</span>

    <span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">random_invert_img</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">RandomInvert</span><span class="p">()(</span><span class="n">image</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/tf2_advanced_data_augmentation_55_0.png" src="../../_images/tf2_advanced_data_augmentation_55_0.png" />
</div>
</div>
<p>Both of these layers can be used as described in options 1 and 2 above.</p>
</div>
</div>
<div class="section" id="using-tf-image">
<h2>Using tf.image<a class="headerlink" href="#using-tf-image" title="Permalink to this headline">¶</a></h2>
<p>The above <code class="docutils literal notranslate"><span class="pre">layers.preprocessing</span></code> utilities are convenient. For finer control, you can write your own data augmentation pipelines or layers using <code class="docutils literal notranslate"><span class="pre">tf.data</span></code> and <code class="docutils literal notranslate"><span class="pre">tf.image</span></code>. You may also want to check out <a class="reference external" href="https://www.tensorflow.org/addons/tutorials/image_ops">TensorFlow Addons Image: Operations</a> and <a class="reference external" href="https://www.tensorflow.org/io/tutorials/colorspace">TensorFlow I/O: Color Space Conversions</a></p>
<p>Since the flowers dataset was previously configured with data augmentation, let’s reimport it to start fresh.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">train_ds</span><span class="p">,</span> <span class="n">val_ds</span><span class="p">,</span> <span class="n">test_ds</span><span class="p">),</span> <span class="n">metadata</span> <span class="o">=</span> <span class="n">tfds</span><span class="o">.</span><span class="n">load</span><span class="p">(</span>
    <span class="s1">&#39;tf_flowers&#39;</span><span class="p">,</span>
    <span class="n">split</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;train[:80%]&#39;</span><span class="p">,</span> <span class="s1">&#39;train[80%:90%]&#39;</span><span class="p">,</span> <span class="s1">&#39;train[90%:]&#39;</span><span class="p">],</span>
    <span class="n">with_info</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">as_supervised</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Retrieve an image to work with.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">image</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">train_ds</span><span class="p">))</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">get_label_name</span><span class="p">(</span><span class="n">label</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/tf2_advanced_data_augmentation_62_0.png" src="../../_images/tf2_advanced_data_augmentation_62_0.png" />
</div>
</div>
<p>Let’s use the following function to visualize and compare the original and augmented images side-by-side.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">visualize</span><span class="p">(</span><span class="n">original</span><span class="p">,</span> <span class="n">augmented</span><span class="p">):</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Original image&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">original</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Augmented image&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">augmented</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id3">
<h3>Data augmentation<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<div class="section" id="flipping-the-image">
<h4>Flipping the image<a class="headerlink" href="#flipping-the-image" title="Permalink to this headline">¶</a></h4>
<p>Flip the image either vertically or horizontally.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">flipped</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">flip_left_right</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
<span class="n">visualize</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">flipped</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/tf2_advanced_data_augmentation_67_0.png" src="../../_images/tf2_advanced_data_augmentation_67_0.png" />
</div>
</div>
</div>
<div class="section" id="grayscale-the-image">
<h4>Grayscale the image<a class="headerlink" href="#grayscale-the-image" title="Permalink to this headline">¶</a></h4>
<p>Grayscale an image.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">grayscaled</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">rgb_to_grayscale</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
<span class="n">visualize</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">grayscaled</span><span class="p">))</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/tf2_advanced_data_augmentation_69_0.png" src="../../_images/tf2_advanced_data_augmentation_69_0.png" />
</div>
</div>
</div>
<div class="section" id="saturate-the-image">
<h4>Saturate the image<a class="headerlink" href="#saturate-the-image" title="Permalink to this headline">¶</a></h4>
<p>Saturate an image by providing a saturation factor.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">saturated</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">adjust_saturation</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">visualize</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">saturated</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/tf2_advanced_data_augmentation_71_0.png" src="../../_images/tf2_advanced_data_augmentation_71_0.png" />
</div>
</div>
</div>
<div class="section" id="change-image-brightness">
<h4>Change image brightness<a class="headerlink" href="#change-image-brightness" title="Permalink to this headline">¶</a></h4>
<p>Change the brightness of image by providing a brightness factor.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bright</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">adjust_brightness</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">)</span>
<span class="n">visualize</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">bright</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/tf2_advanced_data_augmentation_73_0.png" src="../../_images/tf2_advanced_data_augmentation_73_0.png" />
</div>
</div>
</div>
<div class="section" id="center-crop-the-image">
<h4>Center crop the image<a class="headerlink" href="#center-crop-the-image" title="Permalink to this headline">¶</a></h4>
<p>Crop the image from center up to the image part you desire.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cropped</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">central_crop</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">central_fraction</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">visualize</span><span class="p">(</span><span class="n">image</span><span class="p">,</span><span class="n">cropped</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/tf2_advanced_data_augmentation_75_0.png" src="../../_images/tf2_advanced_data_augmentation_75_0.png" />
</div>
</div>
</div>
<div class="section" id="rotate-the-image">
<h4>Rotate the image<a class="headerlink" href="#rotate-the-image" title="Permalink to this headline">¶</a></h4>
<p>Rotate an image by 90 degrees.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rotated</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">rot90</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
<span class="n">visualize</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">rotated</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/tf2_advanced_data_augmentation_77_0.png" src="../../_images/tf2_advanced_data_augmentation_77_0.png" />
</div>
</div>
</div>
</div>
<div class="section" id="random-transformations">
<h3>Random transformations<a class="headerlink" href="#random-transformations" title="Permalink to this headline">¶</a></h3>
<p>Warning: There are two sets of random image operations: <code class="docutils literal notranslate"><span class="pre">tf.image.random*</span></code> and <code class="docutils literal notranslate"><span class="pre">tf.image.stateless_random*</span></code>. Using <code class="docutils literal notranslate"><span class="pre">tf.image.random*</span></code> operations is strongly discouraged as they use the old RNGs from TF 1.x. Instead, please use the random image operations introduced in this tutorial. For more information, please refer to <a class="reference external" href="https://www.tensorflow.org/guide/random_numbers">Random number generation</a>.</p>
<p>Applying random transformations to the images can further help generalize and expand the dataset. Current <code class="docutils literal notranslate"><span class="pre">tf.image</span></code> API provides 8 such random image operations (ops):</p>
<ul class="simple">
<li><p><a class="reference external" href="https://www.tensorflow.org/api_docs/python/tf/image/stateless_random_brightness"><code class="docutils literal notranslate"><span class="pre">tf.image.stateless_random_brightness</span></code></a></p></li>
<li><p><a class="reference external" href="https://www.tensorflow.org/api_docs/python/tf/image/stateless_random_contrast"><code class="docutils literal notranslate"><span class="pre">tf.image.stateless_random_contrast</span></code></a></p></li>
<li><p><a class="reference external" href="https://www.tensorflow.org/api_docs/python/tf/image/stateless_random_crop"><code class="docutils literal notranslate"><span class="pre">tf.image.stateless_random_crop</span></code></a></p></li>
<li><p><a class="reference external" href="https://www.tensorflow.org/api_docs/python/tf/image/stateless_random_flip_left_right"><code class="docutils literal notranslate"><span class="pre">tf.image.stateless_random_flip_left_right</span></code></a></p></li>
<li><p><a class="reference external" href="https://www.tensorflow.org/api_docs/python/tf/image/stateless_random_flip_up_down"><code class="docutils literal notranslate"><span class="pre">tf.image.stateless_random_flip_up_down</span></code></a></p></li>
<li><p><a class="reference external" href="https://www.tensorflow.org/api_docs/python/tf/image/stateless_random_hue"><code class="docutils literal notranslate"><span class="pre">tf.image.stateless_random_hue</span></code></a></p></li>
<li><p><a class="reference external" href="https://www.tensorflow.org/api_docs/python/tf/image/stateless_random_jpeg_quality"><code class="docutils literal notranslate"><span class="pre">tf.image.stateless_random_jpeg_quality</span></code></a></p></li>
<li><p><a class="reference external" href="https://www.tensorflow.org/api_docs/python/tf/image/stateless_random_saturation"><code class="docutils literal notranslate"><span class="pre">tf.image.stateless_random_saturation</span></code></a></p></li>
</ul>
<p>These random image ops are purely functional: the ouput only depends on the input. This makes them simple to use in high performance, deterministic input pipelines. They require a <code class="docutils literal notranslate"><span class="pre">seed</span></code> value be input each step. Given the same <code class="docutils literal notranslate"><span class="pre">seed</span></code>, they return the same results independent of how many times they are called.</p>
<p>Note: <code class="docutils literal notranslate"><span class="pre">seed</span></code> is a <code class="docutils literal notranslate"><span class="pre">Tensor</span></code> of shape <code class="docutils literal notranslate"><span class="pre">(2,)</span></code>  whose values are any integers.</p>
<p>In the following sections, we will:</p>
<ol class="simple">
<li><p>Go over examples of using random image operations to transform an image, and</p></li>
<li><p>Demonstrate how to apply random transformations to a training dataset.</p></li>
</ol>
<div class="section" id="randomly-change-image-brightness">
<h4>Randomly change image brightness<a class="headerlink" href="#randomly-change-image-brightness" title="Permalink to this headline">¶</a></h4>
<p>Randomly change the brightness of <code class="docutils literal notranslate"><span class="pre">image</span></code> by providing a brightness factor and <code class="docutils literal notranslate"><span class="pre">seed</span></code>. The brightness factor is chosen randomly in the range <code class="docutils literal notranslate"><span class="pre">[-max_delta,</span> <span class="pre">max_delta)</span></code> and is associated with the given <code class="docutils literal notranslate"><span class="pre">seed</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
    <span class="n">seed</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>  <span class="c1"># tuple of size (2,)</span>
    <span class="n">stateless_random_brightness</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">stateless_random_brightness</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">max_delta</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>
    <span class="n">visualize</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">stateless_random_brightness</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/tf2_advanced_data_augmentation_80_0.png" src="../../_images/tf2_advanced_data_augmentation_80_0.png" />
<img alt="../../_images/tf2_advanced_data_augmentation_80_1.png" src="../../_images/tf2_advanced_data_augmentation_80_1.png" />
<img alt="../../_images/tf2_advanced_data_augmentation_80_2.png" src="../../_images/tf2_advanced_data_augmentation_80_2.png" />
</div>
</div>
</div>
<div class="section" id="randomly-change-image-contrast">
<h4>Randomly change image contrast<a class="headerlink" href="#randomly-change-image-contrast" title="Permalink to this headline">¶</a></h4>
<p>Randomly change the contrast of <code class="docutils literal notranslate"><span class="pre">image</span></code> by providing a contrast range and <code class="docutils literal notranslate"><span class="pre">seed</span></code>. The contrast range is chosen randomly in the interval <code class="docutils literal notranslate"><span class="pre">[lower,</span> <span class="pre">upper]</span></code> and is associated with the given <code class="docutils literal notranslate"><span class="pre">seed</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
    <span class="n">seed</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>  <span class="c1"># tuple of size (2,)</span>
    <span class="n">stateless_random_contrast</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">stateless_random_contrast</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>
    <span class="n">visualize</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">stateless_random_contrast</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/tf2_advanced_data_augmentation_82_0.png" src="../../_images/tf2_advanced_data_augmentation_82_0.png" />
<img alt="../../_images/tf2_advanced_data_augmentation_82_1.png" src="../../_images/tf2_advanced_data_augmentation_82_1.png" />
<img alt="../../_images/tf2_advanced_data_augmentation_82_2.png" src="../../_images/tf2_advanced_data_augmentation_82_2.png" />
</div>
</div>
</div>
<div class="section" id="randomly-crop-an-image">
<h4>Randomly crop an image<a class="headerlink" href="#randomly-crop-an-image" title="Permalink to this headline">¶</a></h4>
<p>Randomly crop <code class="docutils literal notranslate"><span class="pre">image</span></code> by providing target <code class="docutils literal notranslate"><span class="pre">size</span></code> and <code class="docutils literal notranslate"><span class="pre">seed</span></code>. The portion that gets cropped out of <code class="docutils literal notranslate"><span class="pre">image</span></code> is at a randomly chosen offet and is associated with the given <code class="docutils literal notranslate"><span class="pre">seed</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
    <span class="n">seed</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>  <span class="c1"># tuple of size (2,)</span>
    <span class="n">stateless_random_crop</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">stateless_random_crop</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">[</span><span class="mi">210</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>
    <span class="n">visualize</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">stateless_random_crop</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/tf2_advanced_data_augmentation_84_0.png" src="../../_images/tf2_advanced_data_augmentation_84_0.png" />
<img alt="../../_images/tf2_advanced_data_augmentation_84_1.png" src="../../_images/tf2_advanced_data_augmentation_84_1.png" />
<img alt="../../_images/tf2_advanced_data_augmentation_84_2.png" src="../../_images/tf2_advanced_data_augmentation_84_2.png" />
</div>
</div>
</div>
</div>
<div class="section" id="apply-augmentation-to-a-dataset">
<h3>Apply augmentation to a dataset<a class="headerlink" href="#apply-augmentation-to-a-dataset" title="Permalink to this headline">¶</a></h3>
<p>Let’s first download the image dataset again in case they are modified in the previous sections.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">train_datasets</span><span class="p">,</span> <span class="n">val_ds</span><span class="p">,</span> <span class="n">test_ds</span><span class="p">),</span> <span class="n">metadata</span> <span class="o">=</span> <span class="n">tfds</span><span class="o">.</span><span class="n">load</span><span class="p">(</span>
    <span class="s1">&#39;tf_flowers&#39;</span><span class="p">,</span>
    <span class="n">split</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;train[:80%]&#39;</span><span class="p">,</span> <span class="s1">&#39;train[80%:90%]&#39;</span><span class="p">,</span> <span class="s1">&#39;train[90%:]&#39;</span><span class="p">],</span>
    <span class="n">with_info</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">as_supervised</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s define a utility function for resizing and rescaling the images. This function will be used in unifying the size and scale of images in the dataset:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">resize_and_rescale</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">label</span><span class="p">):</span>
    <span class="n">image</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
    <span class="n">image</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="p">[</span><span class="n">IMG_SIZE</span><span class="p">,</span> <span class="n">IMG_SIZE</span><span class="p">])</span>
    <span class="n">image</span> <span class="o">=</span> <span class="p">(</span><span class="n">image</span> <span class="o">/</span> <span class="mf">255.0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">image</span><span class="p">,</span> <span class="n">label</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s also define <code class="docutils literal notranslate"><span class="pre">augment</span></code> function that can apply the random transformations to the images. This function will be used on the dataset in the next step.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">augment</span><span class="p">(</span><span class="n">image_label</span><span class="p">,</span> <span class="n">seed</span><span class="p">):</span>
    <span class="n">image</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="n">image_label</span>
    <span class="n">image</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="n">resize_and_rescale</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span>
    <span class="n">image</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">resize_with_crop_or_pad</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">IMG_SIZE</span> <span class="o">+</span> <span class="mi">6</span><span class="p">,</span> <span class="n">IMG_SIZE</span> <span class="o">+</span> <span class="mi">6</span><span class="p">)</span>
    <span class="c1"># Make a new seed</span>
    <span class="n">new_seed</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">experimental</span><span class="o">.</span><span class="n">stateless_split</span><span class="p">(</span><span class="n">seed</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>
    <span class="c1"># Random crop back to the original size</span>
    <span class="n">image</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">stateless_random_crop</span><span class="p">(</span>
      <span class="n">image</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">[</span><span class="n">IMG_SIZE</span><span class="p">,</span> <span class="n">IMG_SIZE</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>
    <span class="c1"># Random brightness</span>
    <span class="n">image</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">stateless_random_brightness</span><span class="p">(</span>
      <span class="n">image</span><span class="p">,</span> <span class="n">max_delta</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="n">new_seed</span><span class="p">)</span>
    <span class="n">image</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">clip_by_value</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">image</span><span class="p">,</span> <span class="n">label</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="option-1-using-tf-data-experimental-counter">
<h4>Option 1: Using <code class="docutils literal notranslate"><span class="pre">tf.data.experimental.Counter()</span></code><a class="headerlink" href="#option-1-using-tf-data-experimental-counter" title="Permalink to this headline">¶</a></h4>
<p>Create a <code class="docutils literal notranslate"><span class="pre">tf.data.experimental.Counter()</span></code> object (let’s call it <code class="docutils literal notranslate"><span class="pre">counter</span></code>) and <code class="docutils literal notranslate"><span class="pre">zip</span></code> the dataset with <code class="docutils literal notranslate"><span class="pre">(counter,</span> <span class="pre">counter)</span></code>. This will ensure that each image in the dataset gets associated with a unique value (of shape <code class="docutils literal notranslate"><span class="pre">(2,)</span></code>) based on <code class="docutils literal notranslate"><span class="pre">counter</span></code> which later can get passed into the <code class="docutils literal notranslate"><span class="pre">augment</span></code> function as the <code class="docutils literal notranslate"><span class="pre">seed</span></code> value for random transformations.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create counter and zip together with train dataset</span>
<span class="n">counter</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">experimental</span><span class="o">.</span><span class="n">Counter</span><span class="p">()</span>
<span class="n">train_ds</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">Dataset</span><span class="o">.</span><span class="n">zip</span><span class="p">((</span><span class="n">train_datasets</span><span class="p">,</span> <span class="p">(</span><span class="n">counter</span><span class="p">,</span> <span class="n">counter</span><span class="p">)))</span>
</pre></div>
</div>
</div>
</div>
<p>Map the <code class="docutils literal notranslate"><span class="pre">augment</span></code> function to the training dataset.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train_ds</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">train_ds</span>
    <span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>
    <span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">augment</span><span class="p">,</span> <span class="n">num_parallel_calls</span><span class="o">=</span><span class="n">AUTOTUNE</span><span class="p">)</span>
    <span class="o">.</span><span class="n">batch</span><span class="p">(</span><span class="n">batch_size</span><span class="p">)</span>
    <span class="o">.</span><span class="n">prefetch</span><span class="p">(</span><span class="n">AUTOTUNE</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">val_ds</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">val_ds</span>
    <span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">resize_and_rescale</span><span class="p">,</span> <span class="n">num_parallel_calls</span><span class="o">=</span><span class="n">AUTOTUNE</span><span class="p">)</span>
    <span class="o">.</span><span class="n">batch</span><span class="p">(</span><span class="n">batch_size</span><span class="p">)</span>
    <span class="o">.</span><span class="n">prefetch</span><span class="p">(</span><span class="n">AUTOTUNE</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">test_ds</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">test_ds</span>
    <span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">resize_and_rescale</span><span class="p">,</span> <span class="n">num_parallel_calls</span><span class="o">=</span><span class="n">AUTOTUNE</span><span class="p">)</span>
    <span class="o">.</span><span class="n">batch</span><span class="p">(</span><span class="n">batch_size</span><span class="p">)</span>
    <span class="o">.</span><span class="n">prefetch</span><span class="p">(</span><span class="n">AUTOTUNE</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="option-2-using-tf-random-generator">
<h4>Option 2: Using <code class="docutils literal notranslate"><span class="pre">tf.random.Generator</span></code><a class="headerlink" href="#option-2-using-tf-random-generator" title="Permalink to this headline">¶</a></h4>
<p>Create a <code class="docutils literal notranslate"><span class="pre">tf.random.Generator</span></code> object with an intial <code class="docutils literal notranslate"><span class="pre">seed</span></code> value. Calling <code class="docutils literal notranslate"><span class="pre">make_seeds</span></code> function on the same generator object returns a new, unique <code class="docutils literal notranslate"><span class="pre">seed</span></code> value always. Define a wrapper function that 1) calls <code class="docutils literal notranslate"><span class="pre">make_seeds</span></code> function and that 2) passes the newly generated <code class="docutils literal notranslate"><span class="pre">seed</span></code> value into the <code class="docutils literal notranslate"><span class="pre">augment</span></code> function for random transformations.</p>
<p>Note: <code class="docutils literal notranslate"><span class="pre">tf.random.Generator</span></code> objects store RNG state in a <code class="docutils literal notranslate"><span class="pre">tf.Variable</span></code>, which means it can be saved as a <a class="reference external" href="https://www.tensorflow.org/guide/checkpoint">checkpoint</a> or in a <a class="reference external" href="https://www.tensorflow.org/guide/saved_model">SavedModel</a>. For more details, please refer to <a class="reference external" href="https://www.tensorflow.org/guide/random_numbers">Random number generation</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create a generator</span>
<span class="n">rng</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">Generator</span><span class="o">.</span><span class="n">from_seed</span><span class="p">(</span><span class="mi">123</span><span class="p">,</span> <span class="n">alg</span><span class="o">=</span><span class="s1">&#39;philox&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># A wrapper function for updating seeds</span>
<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="n">seed</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">make_seeds</span><span class="p">(</span><span class="mi">2</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">image</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="n">augment</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="n">seed</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">image</span><span class="p">,</span> <span class="n">label</span>
</pre></div>
</div>
</div>
</div>
<p>Map the wrapper function <code class="docutils literal notranslate"><span class="pre">f</span></code> to the training dataset.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train_ds</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">train_datasets</span>
    <span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>
    <span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">num_parallel_calls</span><span class="o">=</span><span class="n">AUTOTUNE</span><span class="p">)</span>
    <span class="o">.</span><span class="n">batch</span><span class="p">(</span><span class="n">batch_size</span><span class="p">)</span>
    <span class="o">.</span><span class="n">prefetch</span><span class="p">(</span><span class="n">AUTOTUNE</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">val_ds</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">val_ds</span>
    <span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">resize_and_rescale</span><span class="p">,</span> <span class="n">num_parallel_calls</span><span class="o">=</span><span class="n">AUTOTUNE</span><span class="p">)</span>
    <span class="o">.</span><span class="n">batch</span><span class="p">(</span><span class="n">batch_size</span><span class="p">)</span>
    <span class="o">.</span><span class="n">prefetch</span><span class="p">(</span><span class="n">AUTOTUNE</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">test_ds</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">test_ds</span>
    <span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">resize_and_rescale</span><span class="p">,</span> <span class="n">num_parallel_calls</span><span class="o">=</span><span class="n">AUTOTUNE</span><span class="p">)</span>
    <span class="o">.</span><span class="n">batch</span><span class="p">(</span><span class="n">batch_size</span><span class="p">)</span>
    <span class="o">.</span><span class="n">prefetch</span><span class="p">(</span><span class="n">AUTOTUNE</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>These datasets can now be used to train a model as shown previously.</p>
</div>
</div>
</div>
<div class="section" id="next-steps">
<h2>Next steps<a class="headerlink" href="#next-steps" title="Permalink to this headline">¶</a></h2>
<p>This tutorial demonstrated data augmentation using <a class="reference external" href="https://www.tensorflow.org/api_docs/python/tf/keras/layers/experimental/preprocessing/">Keras Preprocessing Layers</a> and <code class="docutils literal notranslate"><span class="pre">tf.image</span></code>. To learn how to include preprocessing layers inside your model, see the <a class="reference external" href="https://www.tensorflow.org/tutorials/images/classification">Image classification</a> tutorial. You may also be interested in learning how preprocessing layers can help you classify text, as shown in the <a class="reference external" href="https://www.tensorflow.org/tutorials/keras/text_classification">Basic text classification</a> tutorial. You can learn more about <code class="docutils literal notranslate"><span class="pre">tf.data</span></code> in this <a class="reference external" href="https://www.tensorflow.org/guide/data">guide</a>, and you can learn how to configure your input pipelines for performance <a class="reference external" href="https://www.tensorflow.org/guide/data_performance">here</a>.</p>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./datascience/deep_learning"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
        <div class='prev-next-bottom'>
            
    <a class='left-prev' id="prev-link" href="tf2_advanced_transfer_learning_with_hub.html" title="previous page">Transfer learning with TensorFlow Hub</a>
    <a class='right-next' id="next-link" href="tf2_advanced_image_segmentation.html" title="next page">Image Segmentation</a>

        </div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By comafire<br/>
        
            &copy; Copyright 2015.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../../_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
<script async="" src="https://www.google-analytics.com/analytics.js"></script>
<script>
                        window.ga = window.ga || function () {
                            (ga.q = ga.q || []).push(arguments) };
                        ga.l = +new Date;
                        ga('create', 'UA-81648003-1', 'auto');
                        ga('set', 'anonymizeIp', true);
                        ga('send', 'pageview');
                    </script>

  </body>
</html>