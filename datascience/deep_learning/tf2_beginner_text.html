
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Text &#8212; 데사견문록</title>
    
  <link href="../../_static/css/theme.css" rel="stylesheet" />
  <link href="../../_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/sphinx-book-theme.acff12b8f9c144ce68a297486a2fa670.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../../_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/togglebutton.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Unicode" href="tf2_beginner_unicode.html" />
    <link rel="prev" title="Pandas" href="tf2_beginner_pandas.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
      <img src="../../_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">데사견문록</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../readme.html">
   데이터사이언스견문록
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  DataScience
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../e2eds.html">
   End to End Data Science (E2EDS)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../random_seed.html">
   Random
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../dataprep.html">
   Data Preperation
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../dataprep/data_type.html">
     Data Type
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../dataprep/spark_dataframe_10mins.html">
     Spark DataFrame 10mins
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../dataprep/pandas_10mins.html">
     Pandas 10mins
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../dataprep/numpy_10mins.html">
     Numpy 10mins
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../data_analytics.html">
   Data Analytics
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../data_analytics/data_description.html">
     Data Description
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../data_analytics/missing_value.html">
     Missing Value
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../data_analytics/descriptive_statistics.html">
     Descriptive Statistcs
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../data_analytics/inferential_statistics.html">
     Inferential Statistcs
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../data_analytics/inferential_statistics/probability_distribution.html">
     Probability Distribution
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../data_analytics/inferential_statistics/estimation.html">
     Estimation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../data_analytics/inferential_statistics/testing_hypothesis.html">
     Testing Hypothesis
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../data_analytics/bayesian_statistics.html">
     Bayesian Statistics
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../data_analytics/outlier.html">
     Outlier
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../data_analytics/scipy_normality_test.html">
     Normality Test
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../data_analytics/scipy_statistics_test.html">
     Statistics Test
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../data_analytics/parallel_algorithm.html">
     One-Pass/Parallel Algorithm
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../machine_learning.html">
   Machine Learning
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../machine_learning/sklearn_feature_selection.html">
     Feature Selection
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../machine_learning/sklearn_feature_extraction.html">
     Feature Extraction
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../machine_learning/sklearn_feature_transformation.html">
     Feature Transformation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../machine_learning/sklearn_split_train_test.html">
     Train/Valid/Test Dataset
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../machine_learning/imblearn_imbalanced_class.html">
     Imbalanced Class
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../machine_learning/sklearn_model_persistence.html">
     Model Persistence
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../machine_learning/sklearn_eval_regression.html">
     Regression Evaluation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../machine_learning/sklearn_linear_regression.html">
     Linear Regression
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../machine_learning/sklearn_polynomial_regression.html">
     Polynomial Regression
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../machine_learning/sklearn_sgd_regression.html">
     SGD Regression
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../machine_learning/sklearn_svm_regression.html">
     SVM Regression
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../machine_learning/sklearn_nearest_neighbor_regression.html">
     Nearest Neighbors Regression
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../machine_learning/sklearn_ensemble_regression.html">
     Ensemble Regression
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../machine_learning/sklearn_eval_classification.html">
     Classification Evaluation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../machine_learning/sklearn_logistic_regression.html">
     Logistic Regression
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../machine_learning/sklearn_sgd_classification.html">
     SGD Classification
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../machine_learning/sklearn_svm_classification.html">
     SVM Classification
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../machine_learning/sklearn_nearest_neighbor_classification.html">
     Nearest Neighbors Classification
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../machine_learning/sklearn_ensemble_classification.html">
     Ensemble Classification
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../machine_learning/sklearn_eval_clustering.html">
     Clustering Evaluation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../machine_learning/sklearn_kmeans.html">
     K-Means
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../machine_learning/sklearn_mean_shift.html">
     Mean Shift
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../machine_learning/sklearn_spectral_clustering.html">
     Spectral Clustering
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../machine_learning/sklearn_hyper_parameter_tunning.html">
     Hyper Parameter Tunning
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../machine_learning/sklearn_anomaly_detection.html">
     Anomaly Detection
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../machine_learning/surprise_collaborative_filtering.html">
     Collaborative Filtering
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../machine_learning/frontal_face_detector.html">
     Frontal Face Detector
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="../deep_learning.html">
   Deep Learning
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="keras_10mins.html">
     Keras 10mins
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="keras_dnn_regression.html">
     DNN Regression
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="keras_dnn_classification.html">
     DNN Classification
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="keras_deepmf.html">
     Deep MF
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="tf2_10mins.html">
     TF2 10mins
    </a>
   </li>
   <li class="toctree-l2 current active has-children">
    <a class="reference internal" href="tf2_beginner.html">
     TF2 Beginner
    </a>
    <input checked="" class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
    <label for="toctree-checkbox-5">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul class="current">
     <li class="toctree-l3">
      <a class="reference internal" href="tf2_beginner_quickstart.html">
       Quickstart
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="tf2_beginner_image_classification.html">
       Image Classification
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="tf2_beginner_text_classification.html">
       Text Classification
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="tf2_beginner_hub_text_classification.html">
       Text Classification with Hub
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="tf2_beginner_regression.html">
       Regression
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="tf2_beginner_overfit_underfit.html">
       Overfit &amp; Underfit
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="tf2_beginner_save_load.html">
       Save &amp; Load
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="tf2_beginner_keras_tuner.html">
       Keras Tuner
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="tf2_beginner_images.html">
       Images
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="tf2_beginner_csv.html">
       CSV
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="tf2_beginner_numpy.html">
       Numpy
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="tf2_beginner_pandas.html">
       Pandas
      </a>
     </li>
     <li class="toctree-l3 current active">
      <a class="current reference internal" href="#">
       Text
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="tf2_beginner_unicode.html">
       Unicode
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="tf2_beginner_tftext.html">
       TF.Text
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="tf2_beginner_subwords_tokenizer.html">
       Subword Tokenization
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="tf2_beginner_tfrecord.html">
       TFRecord and tf.train.Example
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="tf2_beginner_tfio.html">
       TF I/O
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="tf2_advanced.html">
     TF2 Advanced
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
    <label for="toctree-checkbox-6">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="tf2_advanced_quickstart.html">
       Quickstart
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="tf2_advanced_image_cnn.html">
       Image CNN
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="tf2_advanced_image_classification.html">
       Image Classification
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="tf2_advanced_transfer_learning.html">
       Transfer learning and fine-tuning
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="tf2_advanced_transfer_learning_with_hub.html">
       Transfer learning with TensorFlow Hub
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="tf2_advanced_data_augmentation.html">
       Data augmentation
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="tf2_advanced_image_segmentation.html">
       Image Segmentation
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../deploy.html">
   Deployment
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
  <label for="toctree-checkbox-7">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../deploy/streamlit.html">
     Streamlit
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../deploy/flask.html">
     Flask
    </a>
   </li>
  </ul>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  DataPlatform
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../dataplatform/e2edp.html">
   End to End Data Platform (E2EDP)
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../dataplatform/infra.html">
   Infrastructure
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
  <label for="toctree-checkbox-8">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../dataplatform/infra_computer.html">
     Computer
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../dataplatform/infra_network.html">
     Network
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../dataplatform/gce-nested-vm.html">
     Google Computer Engine
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../dataplatform/jupyter.html">
   Jupyter
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/>
  <label for="toctree-checkbox-9">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../dataplatform/jupyter_cloud.html">
     Jupyter (Cloud)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../dataplatform/jupyter_native_ubuntu.html">
     Jupyter (Ubuntu)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../dataplatform/jupyter_native_macos.html">
     Jupyter (macOS)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../dataplatform/jupyter_docker.html">
     Jupyter (Docker)
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../dataplatform/vagrant_virtualbox.html">
   Vagrant &amp; Virtualbox
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/>
  <label for="toctree-checkbox-10">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../dataplatform/vagrant_skp_single.html">
     vagrant_skp_single
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../dataplatform/ansible.html">
   Ansible
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/>
  <label for="toctree-checkbox-11">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../dataplatform/ansible_skp_ubuntu.html">
     ansible_skp_ubuntu
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../dataplatform/skp.html">
   St. Kilda Pier (SKP)
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" type="checkbox"/>
  <label for="toctree-checkbox-12">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../dataplatform/skp_n4e_vscode.html">
     Native Visual Studio Code
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../dataplatform/skp_n4e_jupyter.html">
     Native Jupyter
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../dataplatform/skp_d4r_jupyter.html">
     Docker Jupyter
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../dataplatform/skp_n4e_traefik.html">
     Native Traefik
    </a>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../_sources/datascience/deep_learning/tf2_beginner_text.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/comafire/comafire.github.io"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/comafire/comafire.github.io/issues/new?title=Issue%20on%20page%20%2Fdatascience/deep_learning/tf2_beginner_text.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/comafire/comafire.github.io/master?urlpath=tree/datascience/deep_learning/tf2_beginner_text.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#copyright-2018-the-tensorflow-authors">
   Copyright 2018 The TensorFlow Authors.
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#load-text">
   Load text
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#example-1-predict-the-tag-for-a-stack-overflow-question">
   Example 1: Predict the tag for a Stack Overflow question
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#download-and-explore-the-dataset">
     Download and explore the dataset
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#load-the-dataset">
     Load the dataset
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#prepare-the-dataset-for-training">
     Prepare the dataset for training
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#configure-the-dataset-for-performance">
     Configure the dataset for performance
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#train-the-model">
     Train the model
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#export-the-model">
     Export the model
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#run-inference-on-new-data">
     Run inference on new data
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#example-2-predict-the-author-of-illiad-translations">
   Example 2: Predict the author of Illiad translations
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id1">
     Download and explore the dataset
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id2">
     Load the dataset
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id3">
     Prepare the dataset for training
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#split-the-dataset-into-train-and-test">
     Split the dataset into train and test
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id4">
     Train the model
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id5">
     Export the model
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id6">
     Run inference on new data
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#downloading-more-datasets-using-tensorflow-datasets-tfds">
   Downloading more datasets using TensorFlow Datasets (TFDS)
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id7">
     Prepare the dataset for training
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id8">
     Train the model
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id9">
     Export the model
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#conclusion">
   Conclusion
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="text">
<h1>Text<a class="headerlink" href="#text" title="Permalink to this headline">¶</a></h1>
<p>TensorFlow2 공식 홈페이지에 나와 있는 코드들을 수행해 보면서 빠르게 TensorFlow2를 익혀 봅니다.</p>
<p><a class="reference external" href="https://www.tensorflow.org/tutorials/load_data/text">https://www.tensorflow.org/tutorials/load_data/text</a></p>
<div class="section" id="copyright-2018-the-tensorflow-authors">
<h2>Copyright 2018 The TensorFlow Authors.<a class="headerlink" href="#copyright-2018-the-tensorflow-authors" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#@title Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<span class="c1"># you may not use this file except in compliance with the License.</span>
<span class="c1"># You may obtain a copy of the License at</span>
<span class="c1">#</span>
<span class="c1"># https://www.apache.org/licenses/LICENSE-2.0</span>
<span class="c1">#</span>
<span class="c1"># Unless required by applicable law or agreed to in writing, software</span>
<span class="c1"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span class="c1"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="c1"># See the License for the specific language governing permissions and</span>
<span class="c1"># limitations under the License.</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 설치</span>
<span class="o">!</span>pip install -q --upgrade pip
<span class="c1"># Be sure you&#39;re using the stable versions of both tf and tf-text, for binary compatibility.</span>
<span class="o">!</span>pip install -q -U tensorflow
<span class="o">!</span>pip install -q -U tensorflow-text
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 경고 메시지 출력 끄기</span>
<span class="kn">import</span> <span class="nn">warnings</span> 
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="n">action</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="n">action</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">FutureWarning</span><span class="p">)</span>

<span class="c1"># 노트북 셀 표시를 브라우저 전체 폭 사용하기</span>
<span class="kn">from</span> <span class="nn">IPython.core.display</span> <span class="kn">import</span> <span class="n">display</span><span class="p">,</span> <span class="n">HTML</span>
<span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="s2">&quot;&lt;style&gt;.container { width:100% !important; }&lt;/style&gt;&quot;</span><span class="p">))</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">clear_output</span>

<span class="c1"># Matplotlib 설정</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
<span class="o">%</span><span class="k">config</span> InlineBackend.figure_format = &#39;retina&#39; # Macbook Retina Display를 위한 고해상도 설정
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;seaborn&#39;</span><span class="p">)</span> <span class="c1"># 스타일 설정</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.figsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">16</span><span class="p">,</span> <span class="mi">9</span><span class="p">]</span> <span class="c1"># 그림 크기</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.dpi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">300</span> <span class="c1"># 해상도</span>

<span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">shutil</span><span class="o">,</span> <span class="nn">functools</span>
<span class="kn">import</span> <span class="nn">collections</span><span class="o">,</span> <span class="nn">pathlib</span><span class="o">,</span> <span class="nn">re</span><span class="o">,</span> <span class="nn">string</span>

<span class="n">rseed</span> <span class="o">=</span> <span class="mi">22</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">rseed</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">rseed</span><span class="p">)</span>
<span class="n">np</span><span class="o">.</span><span class="n">set_printoptions</span><span class="p">(</span><span class="n">precision</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">np</span><span class="o">.</span><span class="n">set_printoptions</span><span class="p">(</span><span class="n">formatter</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;float_kind&#39;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">{:.5f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">})</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.max_rows&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> 
<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.max_columns&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> 
<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.max_colwidth&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">float_format</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{:,.5f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span>

<span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
<span class="n">tf</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">set_seed</span><span class="p">(</span><span class="n">rseed</span><span class="p">)</span>
<span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">set_floatx</span><span class="p">(</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span> <span class="c1"># keras default float type 설정</span>

<span class="kn">import</span> <span class="nn">tensorflow_hub</span> <span class="k">as</span> <span class="nn">tfhub</span>
<span class="kn">import</span> <span class="nn">tensorflow_datasets</span> <span class="k">as</span> <span class="nn">tfds</span>
<span class="kn">import</span> <span class="nn">tensorflow_text</span> <span class="k">as</span> <span class="nn">tftext</span>

<span class="kn">import</span> <span class="nn">kerastuner</span> <span class="k">as</span> <span class="nn">kt</span>

<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>

<span class="kn">import</span> <span class="nn">PIL</span>
<span class="kn">import</span> <span class="nn">PIL.Image</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;python ver=</span><span class="si">{</span><span class="n">sys</span><span class="o">.</span><span class="n">version</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;pandas ver=</span><span class="si">{</span><span class="n">pd</span><span class="o">.</span><span class="n">__version__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;numpy ver=</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">__version__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;tensorflow ver=</span><span class="si">{</span><span class="n">tf</span><span class="o">.</span><span class="n">__version__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;tensorflow execuring eagerly=</span><span class="si">{</span><span class="n">tf</span><span class="o">.</span><span class="n">executing_eagerly</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;tensorflow GPU=</span><span class="si">{</span><span class="s1">&#39;True&#39;</span> <span class="k">if</span> <span class="n">tf</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">experimental</span><span class="o">.</span><span class="n">list_physical_devices</span><span class="p">(</span><span class="s1">&#39;GPU&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="s1">&#39;False&#39;</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;keras tuner ver=</span><span class="si">{</span><span class="n">kt</span><span class="o">.</span><span class="n">__version__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;senborn ver=</span><span class="si">{</span><span class="n">sns</span><span class="o">.</span><span class="n">__version__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;PIL ver=</span><span class="si">{</span><span class="n">PIL</span><span class="o">.</span><span class="n">__version__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>.container { width:100% !important; }</style></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>python ver=3.7.6 (default, Nov 21 2020, 22:51:13) 
[Clang 12.0.0 (clang-1200.0.32.27)]
pandas ver=1.0.5
numpy ver=1.19.5
tensorflow ver=2.4.1
tensorflow execuring eagerly=True
tensorflow GPU=False
keras tuner ver=1.0.2
senborn ver=0.10.0
PIL ver=7.1.2
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="load-text">
<h2>Load text<a class="headerlink" href="#load-text" title="Permalink to this headline">¶</a></h2>
<table class="tfo-notebook-buttons" align="left">
  <td>
    <a target="_blank" href="https://www.tensorflow.org/tutorials/load_data/text"><img src="https://www.tensorflow.org/images/tf_logo_32px.png" />View on TensorFlow.org</a>
  </td>
  <td>
    <a target="_blank" href="https://colab.research.google.com/github/tensorflow/docs/blob/master/site/en/tutorials/load_data/text.ipynb"><img src="https://www.tensorflow.org/images/colab_logo_32px.png" />Run in Google Colab</a>
  </td>
  <td>
    <a target="_blank" href="https://github.com/tensorflow/docs/blob/master/site/en/tutorials/load_data/text.ipynb"><img src="https://www.tensorflow.org/images/GitHub-Mark-32px.png" />View source on GitHub</a>
  </td>
  <td>
    <a href="https://storage.googleapis.com/tensorflow_docs/docs/site/en/tutorials/load_data/text.ipynb"><img src="https://www.tensorflow.org/images/download_logo_32px.png" />Download notebook</a>
  </td>
</table>
*<hr class="docutils" />
<p>This tutorial demonstrates two ways to load and preprocess text.</p>
<ul class="simple">
<li><p>First, you will use Keras utilities and layers. If you are new to TensorFlow, you should start with these.</p></li>
<li><p>Next, you will use lower-level utilities like <code class="docutils literal notranslate"><span class="pre">tf.data.TextLineDataset</span></code> to load text files, and <code class="docutils literal notranslate"><span class="pre">tf.text</span></code> to preprocess the data for finer-grain control.</p></li>
</ul>
</div>
<div class="section" id="example-1-predict-the-tag-for-a-stack-overflow-question">
<h2>Example 1: Predict the tag for a Stack Overflow question<a class="headerlink" href="#example-1-predict-the-tag-for-a-stack-overflow-question" title="Permalink to this headline">¶</a></h2>
<p>As a first example, you will download a dataset of programming questions from Stack Overflow. Each question (“How do I sort a dictionary by value?”) is labeled with exactly one tag (<code class="docutils literal notranslate"><span class="pre">Python</span></code>, <code class="docutils literal notranslate"><span class="pre">CSharp</span></code>, <code class="docutils literal notranslate"><span class="pre">JavaScript</span></code>, or <code class="docutils literal notranslate"><span class="pre">Java</span></code>). Your task is to develop a model that predicts the tag for a question. This is an example of multi-class classification, an important and widely applicable kind of machine learning problem.</p>
<div class="section" id="download-and-explore-the-dataset">
<h3>Download and explore the dataset<a class="headerlink" href="#download-and-explore-the-dataset" title="Permalink to this headline">¶</a></h3>
<p>Next, you will download the dataset, and explore the directory structure.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_url</span> <span class="o">=</span> <span class="s1">&#39;https://storage.googleapis.com/download.tensorflow.org/data/stack_overflow_16k.tar.gz&#39;</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">get_file</span><span class="p">(</span>
    <span class="s1">&#39;/tmp/stack_overflow_16k.tar.gz&#39;</span><span class="p">,</span>
    <span class="n">data_url</span><span class="p">,</span>
    <span class="n">untar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">cache_dir</span><span class="o">=</span><span class="s1">&#39;/tmp&#39;</span><span class="p">,</span>
    <span class="n">cache_subdir</span><span class="o">=</span><span class="s1">&#39;stack_overflow&#39;</span><span class="p">)</span>
<span class="n">dataset_dir</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="s2">&quot;stack_overflow&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">list</span><span class="p">(</span><span class="n">dataset_dir</span><span class="o">.</span><span class="n">iterdir</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[PosixPath(&#39;/tmp/stack_overflow/test&#39;),
 PosixPath(&#39;/tmp/stack_overflow/README.md&#39;),
 PosixPath(&#39;/tmp/stack_overflow/train&#39;)]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train_dir</span> <span class="o">=</span> <span class="n">dataset_dir</span><span class="o">/</span><span class="s1">&#39;train&#39;</span>
<span class="nb">list</span><span class="p">(</span><span class="n">train_dir</span><span class="o">.</span><span class="n">iterdir</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[PosixPath(&#39;/tmp/stack_overflow/train/python&#39;),
 PosixPath(&#39;/tmp/stack_overflow/train/java&#39;),
 PosixPath(&#39;/tmp/stack_overflow/train/csharp&#39;),
 PosixPath(&#39;/tmp/stack_overflow/train/javascript&#39;)]
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">train/csharp</span></code>, <code class="docutils literal notranslate"><span class="pre">train/java</span></code>, <code class="docutils literal notranslate"><span class="pre">train/python</span></code> and <code class="docutils literal notranslate"><span class="pre">train/javascript</span></code> directories contain many text files, each of which is a Stack Overflow question. Print a file and inspect the data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sample_file</span> <span class="o">=</span> <span class="n">train_dir</span><span class="o">/</span><span class="s1">&#39;python/1755.txt&#39;</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">sample_file</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>why does this blank program print true x=true.def stupid():.    x=false.stupid().print x
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="load-the-dataset">
<h3>Load the dataset<a class="headerlink" href="#load-the-dataset" title="Permalink to this headline">¶</a></h3>
<p>Next, you will load the data off disk and prepare it into a format suitable for training. To do so, you will use <a class="reference external" href="https://www.tensorflow.org/api_docs/python/tf/keras/preprocessing/text_dataset_from_directory">text_dataset_from_directory</a> utility to create a labeled <code class="docutils literal notranslate"><span class="pre">tf.data.Dataset</span></code>. If you’re new to <a class="reference external" href="https://www.tensorflow.org/guide/data">tf.data</a>, it’s a powerful collection of tools for building input pipelines.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">preprocessing.text_dataset_from_directory</span></code> expects a directory structure as follows.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">train</span><span class="o">/</span>
<span class="o">...</span><span class="n">csharp</span><span class="o">/</span>
<span class="o">.....</span><span class="mf">.1</span><span class="o">.</span><span class="n">txt</span>
<span class="o">.....</span><span class="mf">.2</span><span class="o">.</span><span class="n">txt</span>
<span class="o">...</span><span class="n">java</span><span class="o">/</span>
<span class="o">.....</span><span class="mf">.1</span><span class="o">.</span><span class="n">txt</span>
<span class="o">.....</span><span class="mf">.2</span><span class="o">.</span><span class="n">txt</span>
<span class="o">...</span><span class="n">javascript</span><span class="o">/</span>
<span class="o">.....</span><span class="mf">.1</span><span class="o">.</span><span class="n">txt</span>
<span class="o">.....</span><span class="mf">.2</span><span class="o">.</span><span class="n">txt</span>
<span class="o">...</span><span class="n">python</span><span class="o">/</span>
<span class="o">.....</span><span class="mf">.1</span><span class="o">.</span><span class="n">txt</span>
<span class="o">.....</span><span class="mf">.2</span><span class="o">.</span><span class="n">txt</span>
</pre></div>
</div>
<p>When running a machine learning experiment, it is a best practice to divide your dataset into three splits: <a class="reference external" href="https://developers.google.com/machine-learning/glossary#training_set">train</a>, <a class="reference external" href="https://developers.google.com/machine-learning/glossary#validation_set">validation</a>, and <a class="reference external" href="https://developers.google.com/machine-learning/glossary#test-set">test</a>. The Stack Overflow dataset has already been divided into train and test, but it lacks a validation set. Create a validation set using an 80:20 split of the training data by using the <code class="docutils literal notranslate"><span class="pre">validation_split</span></code> argument below.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">batch_size</span> <span class="o">=</span> <span class="mi">32</span>
<span class="n">seed</span> <span class="o">=</span> <span class="mi">42</span>

<span class="n">raw_train_ds</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">preprocessing</span><span class="o">.</span><span class="n">text_dataset_from_directory</span><span class="p">(</span>
    <span class="n">train_dir</span><span class="p">,</span>
    <span class="n">batch_size</span><span class="o">=</span><span class="n">batch_size</span><span class="p">,</span>
    <span class="n">validation_split</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
    <span class="n">subset</span><span class="o">=</span><span class="s1">&#39;training&#39;</span><span class="p">,</span>
    <span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Found 8000 files belonging to 4 classes.
Using 6400 files for training.
</pre></div>
</div>
</div>
</div>
<p>As you can see above, there are 8,000 examples in the training folder, of which you will use 80% (or 6,400) for training. As you will see in a moment, you can train a model by passing a <code class="docutils literal notranslate"><span class="pre">tf.data.Dataset</span></code> directly to <code class="docutils literal notranslate"><span class="pre">model.fit</span></code>. First, iterate over the dataset and print out a few examples, to get a feel for the data.</p>
<p>Note: To increase the difficulty of the classification problem, the dataset author replaced occurrences of the words <em>Python</em>, <em>CSharp</em>, <em>JavaScript</em>, or <em>Java</em> in the programming question with the word <em>blank</em>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">text_batch</span><span class="p">,</span> <span class="n">label_batch</span> <span class="ow">in</span> <span class="n">raw_train_ds</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Question: &quot;</span><span class="p">,</span> <span class="n">text_batch</span><span class="o">.</span><span class="n">numpy</span><span class="p">()[</span><span class="n">i</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Label:&quot;</span><span class="p">,</span> <span class="n">label_batch</span><span class="o">.</span><span class="n">numpy</span><span class="p">()[</span><span class="n">i</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Question:  b&#39;&quot;is it possible to split a xml string into elements in array? suppose i have xml string...string str=&quot;&quot;&amp;lt;loan&amp;gt;&amp;lt;account&amp;gt;123456&amp;lt;/account&amp;gt;&amp;lt;name&amp;gt;ramakrishna&amp;lt;/name&amp;gt;&amp;lt;principle&amp;gt;1000&amp;lt;/principle&amp;gt;&amp;lt;issue_date&amp;gt;jan-1-2013&amp;lt;/issue_date&amp;gt;&amp;lt;interest_rate&amp;gt;12%&amp;lt;/interest_rate&amp;gt;&amp;lt;/loan&amp;gt;&quot;&quot;...my output should be like..arr = [&quot;&quot;&amp;lt;account&amp;gt;123456&amp;lt;/account&amp;gt;&quot;&quot;,&quot;&quot;&amp;lt;name&amp;gt;ramakrishna&amp;lt;/name&amp;gt;&quot;&quot;,&quot;&quot;&amp;lt;principle&amp;gt;1000&amp;lt;/principle&amp;gt;&quot;&quot;,&quot;&quot;&amp;lt;issue_date&amp;gt;jan-1-2013&amp;lt;/issue_date&amp;gt;&quot;&quot;,&quot;&quot;&amp;lt;interest_rate&amp;gt;12%&amp;lt;/interest_rate&amp;gt;&quot;&quot;]&quot;\n&#39;
Label: 1
Question:  b&#39;&quot;fails on encountering null this code is part of a shopify sync utility. never has failed, until we encountered a product with no value in the compareto shopify field, not that we have a product with no compareto value. ..private decimal? getcompareprice(long? productid, long? variantid, list&amp;lt;product&amp;gt; products).{.    var product = products.where(x =&amp;gt; x.id == productid).firstordefault();.    var variantdata = product.variants.where(x =&amp;gt; x.id == variantid).firstordefault();..    return variantdata != null ? variantdata.compareatprice : null;.}...how do i get my function to return null if the compareto value is null?&quot;\n&#39;
Label: 0
Question:  b&#39;&quot;blank basic function concatenation to avoid using switch i am looking for a smarter way to call functions without using switch. my problem is as below:.i have many function calls that read something like .    this.map.functionapple();.    this.map.functionpeach();.    this.map.functionorange();..i am currently calling a parent function fruit(&quot;&quot;orange&quot;&quot;) which basically is a huge function with switch which selects the function this.map.functionorange().is there a way where i can simply do:..this.map.function+name+();&quot;\n&#39;
Label: 0
</pre></div>
</div>
</div>
</div>
<p>The labels are <code class="docutils literal notranslate"><span class="pre">0</span></code>, <code class="docutils literal notranslate"><span class="pre">1</span></code>, <code class="docutils literal notranslate"><span class="pre">2</span></code> or <code class="docutils literal notranslate"><span class="pre">3</span></code>. To see which of these correspond to which string label, you can check the <code class="docutils literal notranslate"><span class="pre">class_names</span></code> property on the dataset.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">raw_train_ds</span><span class="o">.</span><span class="n">class_names</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Label&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="s2">&quot;corresponds to&quot;</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Label 0 corresponds to csharp
Label 1 corresponds to java
Label 2 corresponds to javascript
Label 3 corresponds to python
</pre></div>
</div>
</div>
</div>
<p>Next, you will create a validation and test dataset. You will use the remaining 1,600 reviews from the training set for validation.</p>
<p>Note:  When using the <code class="docutils literal notranslate"><span class="pre">validation_split</span></code> and <code class="docutils literal notranslate"><span class="pre">subset</span></code> arguments, make sure to either specify a random seed, or to pass <code class="docutils literal notranslate"><span class="pre">shuffle=False</span></code>, so that the validation and training splits have no overlap.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">raw_val_ds</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">preprocessing</span><span class="o">.</span><span class="n">text_dataset_from_directory</span><span class="p">(</span>
    <span class="n">train_dir</span><span class="p">,</span>
    <span class="n">batch_size</span><span class="o">=</span><span class="n">batch_size</span><span class="p">,</span>
    <span class="n">validation_split</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
    <span class="n">subset</span><span class="o">=</span><span class="s1">&#39;validation&#39;</span><span class="p">,</span>
    <span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Found 8000 files belonging to 4 classes.
Using 1600 files for validation.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">test_dir</span> <span class="o">=</span> <span class="n">dataset_dir</span><span class="o">/</span><span class="s1">&#39;test&#39;</span>
<span class="n">raw_test_ds</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">preprocessing</span><span class="o">.</span><span class="n">text_dataset_from_directory</span><span class="p">(</span>
    <span class="n">test_dir</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="n">batch_size</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Found 8000 files belonging to 4 classes.
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="prepare-the-dataset-for-training">
<h3>Prepare the dataset for training<a class="headerlink" href="#prepare-the-dataset-for-training" title="Permalink to this headline">¶</a></h3>
<p>Note: The Preprocessing APIs used in this section are experimental in TensorFlow 2.3 and subject to change.</p>
<p>Next, you will standardize, tokenize, and vectorize the data using the <code class="docutils literal notranslate"><span class="pre">preprocessing.TextVectorization</span></code> layer.</p>
<ul class="simple">
<li><p>Standardization refers to preprocessing the text, typically to remove punctuation or HTML elements to simplify the dataset.</p></li>
<li><p>Tokenization refers to splitting strings into tokens (for example, splitting a sentence into individual words by splitting on whitespace).</p></li>
<li><p>Vectorization refers to converting tokens into numbers so they can be fed into a neural network.</p></li>
</ul>
<p>All of these tasks can be accomplished with this layer. You can learn more about each of these in the <a class="reference external" href="https://www.tensorflow.org/api_docs/python/tf/keras/layers/experimental/preprocessing/TextVectorization">API doc</a>.</p>
<ul class="simple">
<li><p>The default standardization converts text to lowercase and removes punctuation.</p></li>
<li><p>The default tokenizer splits on whitespace.</p></li>
<li><p>The default vectorization mode is <code class="docutils literal notranslate"><span class="pre">int</span></code>. This outputs integer indices (one per token). This mode can be used to build models that take word order into account. You can also use other modes, like <code class="docutils literal notranslate"><span class="pre">binary</span></code>, to build bag-of-word models.</p></li>
</ul>
<p>You will build two modes to learn more about these. First, you will use the <code class="docutils literal notranslate"><span class="pre">binary</span></code> model to build a bag-of-words model. Next, you will use the <code class="docutils literal notranslate"><span class="pre">int</span></code> mode with a 1D ConvNet.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">VOCAB_SIZE</span> <span class="o">=</span> <span class="mi">10000</span>

<span class="n">binary_vectorize_layer</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">experimental</span><span class="o">.</span><span class="n">preprocessing</span><span class="o">.</span><span class="n">TextVectorization</span><span class="p">(</span>
    <span class="n">max_tokens</span><span class="o">=</span><span class="n">VOCAB_SIZE</span><span class="p">,</span>
    <span class="n">output_mode</span><span class="o">=</span><span class="s1">&#39;binary&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>For <code class="docutils literal notranslate"><span class="pre">int</span></code> mode, in addition to maximum vocabulary size, you need to set an explicit maximum sequence length, which will cause the layer to pad or truncate sequences to exactly sequence_length values.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">MAX_SEQUENCE_LENGTH</span> <span class="o">=</span> <span class="mi">250</span>

<span class="n">int_vectorize_layer</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">experimental</span><span class="o">.</span><span class="n">preprocessing</span><span class="o">.</span><span class="n">TextVectorization</span><span class="p">(</span>
    <span class="n">max_tokens</span><span class="o">=</span><span class="n">VOCAB_SIZE</span><span class="p">,</span>
    <span class="n">output_mode</span><span class="o">=</span><span class="s1">&#39;int&#39;</span><span class="p">,</span>
    <span class="n">output_sequence_length</span><span class="o">=</span><span class="n">MAX_SEQUENCE_LENGTH</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Next, you will call <code class="docutils literal notranslate"><span class="pre">adapt</span></code> to fit the state of the preprocessing layer to the dataset. This will cause the model to build an index of strings to integers.</p>
<p>Note: it’s important to only use your training data when calling adapt (using the test set would leak information).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Make a text-only dataset (without labels), then call adapt</span>
<span class="n">train_text</span> <span class="o">=</span> <span class="n">raw_train_ds</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">text</span><span class="p">,</span> <span class="n">labels</span><span class="p">:</span> <span class="n">text</span><span class="p">)</span>
<span class="n">binary_vectorize_layer</span><span class="o">.</span><span class="n">adapt</span><span class="p">(</span><span class="n">train_text</span><span class="p">)</span>
<span class="n">int_vectorize_layer</span><span class="o">.</span><span class="n">adapt</span><span class="p">(</span><span class="n">train_text</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>See the result of using these layers to preprocess data:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">binary_vectorize_text</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">label</span><span class="p">):</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">binary_vectorize_layer</span><span class="p">(</span><span class="n">text</span><span class="p">),</span> <span class="n">label</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">int_vectorize_text</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">label</span><span class="p">):</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">int_vectorize_layer</span><span class="p">(</span><span class="n">text</span><span class="p">),</span> <span class="n">label</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Retrieve a batch (of 32 reviews and labels) from the dataset</span>
<span class="n">text_batch</span><span class="p">,</span> <span class="n">label_batch</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">raw_train_ds</span><span class="p">))</span>
<span class="n">first_question</span><span class="p">,</span> <span class="n">first_label</span> <span class="o">=</span> <span class="n">text_batch</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">label_batch</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Question&quot;</span><span class="p">,</span> <span class="n">first_question</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Label&quot;</span><span class="p">,</span> <span class="n">first_label</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Question tf.Tensor(b&#39;&quot;what is the difference between these two ways to create an element? var a = document.createelement(\&#39;div\&#39;);..a.id = &quot;&quot;mydiv&quot;&quot;;...and..var a = document.createelement(\&#39;div\&#39;).id = &quot;&quot;mydiv&quot;&quot;;...what is the difference between them such that the first one works and the second one doesn\&#39;t?&quot;\n&#39;, shape=(), dtype=string)
Label tf.Tensor(2, shape=(), dtype=int32)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&#39;binary&#39; vectorized question:&quot;</span><span class="p">,</span> 
      <span class="n">binary_vectorize_text</span><span class="p">(</span><span class="n">first_question</span><span class="p">,</span> <span class="n">first_label</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;binary&#39; vectorized question: tf.Tensor([[1.00000 1.00000 0.00000 ... 0.00000 0.00000 0.00000]], shape=(1, 10000), dtype=float32)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&#39;int&#39; vectorized question:&quot;</span><span class="p">,</span>
      <span class="n">int_vectorize_text</span><span class="p">(</span><span class="n">first_question</span><span class="p">,</span> <span class="n">first_label</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;int&#39; vectorized question: tf.Tensor(
[[ 55   6   2 410 211 229 121 895   4 124  32 245  43   5   1   1   5   1
    1   6   2 410 211 191 318  14   2  98  71 188   8   2 199  71 178   0
    0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0
    0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0
    0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0
    0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0
    0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0
    0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0
    0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0
    0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0
    0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0
    0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0
    0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0
    0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0]], shape=(1, 250), dtype=int64)
</pre></div>
</div>
</div>
</div>
<p>As you can see above, <code class="docutils literal notranslate"><span class="pre">binary</span></code> mode returns an array denoting which tokens exist at least once in the input, while <code class="docutils literal notranslate"><span class="pre">int</span></code> mode replaces each token by an integer, thus preserving their order. You can lookup the token (string) that each integer corresponds to by calling <code class="docutils literal notranslate"><span class="pre">.get_vocabulary()</span></code> on the layer.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;1289 ---&gt; &quot;</span><span class="p">,</span> <span class="n">int_vectorize_layer</span><span class="o">.</span><span class="n">get_vocabulary</span><span class="p">()[</span><span class="mi">1289</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;313 ---&gt; &quot;</span><span class="p">,</span> <span class="n">int_vectorize_layer</span><span class="o">.</span><span class="n">get_vocabulary</span><span class="p">()[</span><span class="mi">313</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Vocabulary size: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">int_vectorize_layer</span><span class="o">.</span><span class="n">get_vocabulary</span><span class="p">())))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1289 ---&gt;  roman
313 ---&gt;  source
Vocabulary size: 10000
</pre></div>
</div>
</div>
</div>
<p>You are nearly ready to train your model. As a final preprocessing step, you will apply the <code class="docutils literal notranslate"><span class="pre">TextVectorization</span></code> layers you created earlier to the train, validation, and test dataset.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">binary_train_ds</span> <span class="o">=</span> <span class="n">raw_train_ds</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">binary_vectorize_text</span><span class="p">)</span>
<span class="n">binary_val_ds</span> <span class="o">=</span> <span class="n">raw_val_ds</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">binary_vectorize_text</span><span class="p">)</span>
<span class="n">binary_test_ds</span> <span class="o">=</span> <span class="n">raw_test_ds</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">binary_vectorize_text</span><span class="p">)</span>

<span class="n">int_train_ds</span> <span class="o">=</span> <span class="n">raw_train_ds</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">int_vectorize_text</span><span class="p">)</span>
<span class="n">int_val_ds</span> <span class="o">=</span> <span class="n">raw_val_ds</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">int_vectorize_text</span><span class="p">)</span>
<span class="n">int_test_ds</span> <span class="o">=</span> <span class="n">raw_test_ds</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">int_vectorize_text</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="configure-the-dataset-for-performance">
<h3>Configure the dataset for performance<a class="headerlink" href="#configure-the-dataset-for-performance" title="Permalink to this headline">¶</a></h3>
<p>These are two important methods you should use when loading data to make sure that I/O does not become blocking.</p>
<p><code class="docutils literal notranslate"><span class="pre">.cache()</span></code> keeps data in memory after it’s loaded off disk. This will ensure the dataset does not become a bottleneck while training your model. If your dataset is too large to fit into memory, you can also use this method to create a performant on-disk cache, which is more efficient to read than many small files.</p>
<p><code class="docutils literal notranslate"><span class="pre">.prefetch()</span></code> overlaps data preprocessing and model execution while training.</p>
<p>You can learn more about both methods, as well as how to cache data to disk in the <a class="reference external" href="https://www.tensorflow.org/guide/data_performance">data performance guide</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">AUTOTUNE</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">AUTOTUNE</span>

<span class="k">def</span> <span class="nf">configure_dataset</span><span class="p">(</span><span class="n">dataset</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">dataset</span><span class="o">.</span><span class="n">cache</span><span class="p">()</span><span class="o">.</span><span class="n">prefetch</span><span class="p">(</span><span class="n">buffer_size</span><span class="o">=</span><span class="n">AUTOTUNE</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">binary_train_ds</span> <span class="o">=</span> <span class="n">configure_dataset</span><span class="p">(</span><span class="n">binary_train_ds</span><span class="p">)</span>
<span class="n">binary_val_ds</span> <span class="o">=</span> <span class="n">configure_dataset</span><span class="p">(</span><span class="n">binary_val_ds</span><span class="p">)</span>
<span class="n">binary_test_ds</span> <span class="o">=</span> <span class="n">configure_dataset</span><span class="p">(</span><span class="n">binary_test_ds</span><span class="p">)</span>

<span class="n">int_train_ds</span> <span class="o">=</span> <span class="n">configure_dataset</span><span class="p">(</span><span class="n">int_train_ds</span><span class="p">)</span>
<span class="n">int_val_ds</span> <span class="o">=</span> <span class="n">configure_dataset</span><span class="p">(</span><span class="n">int_val_ds</span><span class="p">)</span>
<span class="n">int_test_ds</span> <span class="o">=</span> <span class="n">configure_dataset</span><span class="p">(</span><span class="n">int_test_ds</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="train-the-model">
<h3>Train the model<a class="headerlink" href="#train-the-model" title="Permalink to this headline">¶</a></h3>
<p>It’s time to create our neural network. For the <code class="docutils literal notranslate"><span class="pre">binary</span></code> vectorized data, train a simple bag-of-words linear model:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">binary_model</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Sequential</span><span class="p">([</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">4</span><span class="p">)])</span>
<span class="n">binary_model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
    <span class="n">loss</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">losses</span><span class="o">.</span><span class="n">SparseCategoricalCrossentropy</span><span class="p">(</span><span class="n">from_logits</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
    <span class="n">optimizer</span><span class="o">=</span><span class="s1">&#39;adam&#39;</span><span class="p">,</span>
    <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;accuracy&#39;</span><span class="p">])</span>
<span class="n">history</span> <span class="o">=</span> <span class="n">binary_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span>
    <span class="n">binary_train_ds</span><span class="p">,</span> <span class="n">validation_data</span><span class="o">=</span><span class="n">binary_val_ds</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 1/10
200/200 [==============================] - 3s 13ms/step - loss: 1.2369 - accuracy: 0.5275 - val_loss: 0.9143 - val_accuracy: 0.7825
Epoch 2/10
200/200 [==============================] - 0s 1ms/step - loss: 0.8191 - accuracy: 0.8224 - val_loss: 0.7506 - val_accuracy: 0.7994
Epoch 3/10
200/200 [==============================] - 0s 1ms/step - loss: 0.6509 - accuracy: 0.8593 - val_loss: 0.6650 - val_accuracy: 0.8106
Epoch 4/10
200/200 [==============================] - 0s 1ms/step - loss: 0.5508 - accuracy: 0.8869 - val_loss: 0.6116 - val_accuracy: 0.8175
Epoch 5/10
200/200 [==============================] - 0s 1ms/step - loss: 0.4815 - accuracy: 0.9034 - val_loss: 0.5750 - val_accuracy: 0.8300
Epoch 6/10
200/200 [==============================] - 0s 1ms/step - loss: 0.4293 - accuracy: 0.9167 - val_loss: 0.5484 - val_accuracy: 0.8325
Epoch 7/10
200/200 [==============================] - 0s 1ms/step - loss: 0.3879 - accuracy: 0.9266 - val_loss: 0.5284 - val_accuracy: 0.8313
Epoch 8/10
200/200 [==============================] - 0s 1ms/step - loss: 0.3538 - accuracy: 0.9331 - val_loss: 0.5129 - val_accuracy: 0.8350
Epoch 9/10
200/200 [==============================] - 0s 1ms/step - loss: 0.3250 - accuracy: 0.9415 - val_loss: 0.5008 - val_accuracy: 0.8388
Epoch 10/10
200/200 [==============================] - 0s 1ms/step - loss: 0.3002 - accuracy: 0.9459 - val_loss: 0.4911 - val_accuracy: 0.8388
</pre></div>
</div>
</div>
</div>
<p>Next, you will use the <code class="docutils literal notranslate"><span class="pre">int</span></code> vectorized layer to build a 1D ConvNet.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">create_model</span><span class="p">(</span><span class="n">vocab_size</span><span class="p">,</span> <span class="n">num_labels</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Sequential</span><span class="p">([</span>
        <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Embedding</span><span class="p">(</span><span class="n">vocab_size</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="n">mask_zero</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
        <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Conv1D</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="s2">&quot;valid&quot;</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s2">&quot;relu&quot;</span><span class="p">,</span> <span class="n">strides</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span>
        <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">GlobalMaxPooling1D</span><span class="p">(),</span>
        <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">num_labels</span><span class="p">)</span>
    <span class="p">])</span>
    <span class="k">return</span> <span class="n">model</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># vocab_size is VOCAB_SIZE + 1 since 0 is used additionally for padding.</span>
<span class="n">int_model</span> <span class="o">=</span> <span class="n">create_model</span><span class="p">(</span><span class="n">vocab_size</span><span class="o">=</span><span class="n">VOCAB_SIZE</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">num_labels</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="n">int_model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
    <span class="n">loss</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">losses</span><span class="o">.</span><span class="n">SparseCategoricalCrossentropy</span><span class="p">(</span><span class="n">from_logits</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
    <span class="n">optimizer</span><span class="o">=</span><span class="s1">&#39;adam&#39;</span><span class="p">,</span>
    <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;accuracy&#39;</span><span class="p">])</span>
<span class="n">history</span> <span class="o">=</span> <span class="n">int_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">int_train_ds</span><span class="p">,</span> <span class="n">validation_data</span><span class="o">=</span><span class="n">int_val_ds</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 1/5
200/200 [==============================] - 3s 11ms/step - loss: 1.3076 - accuracy: 0.3882 - val_loss: 0.7758 - val_accuracy: 0.6869
Epoch 2/5
200/200 [==============================] - 2s 8ms/step - loss: 0.7206 - accuracy: 0.7046 - val_loss: 0.5515 - val_accuracy: 0.7900
Epoch 3/5
200/200 [==============================] - 2s 8ms/step - loss: 0.4416 - accuracy: 0.8485 - val_loss: 0.4711 - val_accuracy: 0.8263
Epoch 4/5
200/200 [==============================] - 2s 8ms/step - loss: 0.2530 - accuracy: 0.9443 - val_loss: 0.4595 - val_accuracy: 0.8244
Epoch 5/5
200/200 [==============================] - 2s 9ms/step - loss: 0.1305 - accuracy: 0.9779 - val_loss: 0.4794 - val_accuracy: 0.8219
</pre></div>
</div>
</div>
</div>
<p>Compare the two models:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Linear model on binary vectorized data:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">binary_model</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Linear model on binary vectorized data:
Model: &quot;sequential&quot;
_________________________________________________________________
Layer (type)                 Output Shape              Param #   
=================================================================
dense (Dense)                (None, 4)                 40004     
=================================================================
Total params: 40,004
Trainable params: 40,004
Non-trainable params: 0
_________________________________________________________________
None
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ConvNet model on int vectorized data:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">int_model</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ConvNet model on int vectorized data:
Model: &quot;sequential_1&quot;
_________________________________________________________________
Layer (type)                 Output Shape              Param #   
=================================================================
embedding (Embedding)        (None, None, 64)          640064    
_________________________________________________________________
conv1d (Conv1D)              (None, None, 64)          20544     
_________________________________________________________________
global_max_pooling1d (Global (None, 64)                0         
_________________________________________________________________
dense_1 (Dense)              (None, 4)                 260       
=================================================================
Total params: 660,868
Trainable params: 660,868
Non-trainable params: 0
_________________________________________________________________
None
</pre></div>
</div>
</div>
</div>
<p>Evaluate both models on the test data:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">binary_loss</span><span class="p">,</span> <span class="n">binary_accuracy</span> <span class="o">=</span> <span class="n">binary_model</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">binary_test_ds</span><span class="p">)</span>
<span class="n">int_loss</span><span class="p">,</span> <span class="n">int_accuracy</span> <span class="o">=</span> <span class="n">int_model</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">int_test_ds</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Binary model accuracy: </span><span class="si">{:2.2%}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">binary_accuracy</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Int model accuracy: </span><span class="si">{:2.2%}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">int_accuracy</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>250/250 [==============================] - 3s 10ms/step - loss: 0.5171 - accuracy: 0.8134
250/250 [==============================] - 1s 4ms/step - loss: 0.5068 - accuracy: 0.8106
Binary model accuracy: 81.34%
Int model accuracy: 81.06%
</pre></div>
</div>
</div>
</div>
<p>Note: This example dataset represents a rather simple classification problem. More complex datasets and problems bring out subtle but significant differences in preprocessing strategies and model architectures. Be sure to try out different hyperparameters and epochs to compare various approaches.</p>
</div>
<div class="section" id="export-the-model">
<h3>Export the model<a class="headerlink" href="#export-the-model" title="Permalink to this headline">¶</a></h3>
<p>In the code above, you applied the <code class="docutils literal notranslate"><span class="pre">TextVectorization</span></code> layer to the dataset before feeding text to the model. If you want to make your model capable of processing raw strings (for example, to simplify deploying it), you can include the <code class="docutils literal notranslate"><span class="pre">TextVectorization</span></code> layer inside your model. To do so, you can create a new model using the weights you just trained.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">export_model</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Sequential</span><span class="p">([</span>
    <span class="n">binary_vectorize_layer</span><span class="p">,</span> 
    <span class="n">binary_model</span><span class="p">,</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Activation</span><span class="p">(</span><span class="s1">&#39;sigmoid&#39;</span><span class="p">)</span>
<span class="p">])</span>

<span class="n">export_model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
    <span class="n">loss</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">losses</span><span class="o">.</span><span class="n">SparseCategoricalCrossentropy</span><span class="p">(</span><span class="n">from_logits</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
    <span class="n">optimizer</span><span class="o">=</span><span class="s1">&#39;adam&#39;</span><span class="p">,</span>
    <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;accuracy&#39;</span><span class="p">])</span>

<span class="c1"># Test it with `raw_test_ds`, which yields raw strings</span>
<span class="n">loss</span><span class="p">,</span> <span class="n">accuracy</span> <span class="o">=</span> <span class="n">export_model</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">raw_test_ds</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Accuracy: </span><span class="si">{:2.2%}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">binary_accuracy</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>250/250 [==============================] - 1s 4ms/step - loss: 0.5123 - accuracy: 0.8174
Accuracy: 81.34%
</pre></div>
</div>
</div>
</div>
<p>Now your model can take raw strings as input and predict a score for each label using <code class="docutils literal notranslate"><span class="pre">model.predict</span></code>. Define a function to find the label with the maximum score:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_string_labels</span><span class="p">(</span><span class="n">predicted_scores_batch</span><span class="p">):</span>
    <span class="n">predicted_int_labels</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">predicted_scores_batch</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">predicted_labels</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="n">raw_train_ds</span><span class="o">.</span><span class="n">class_names</span><span class="p">,</span> <span class="n">predicted_int_labels</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">predicted_labels</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="run-inference-on-new-data">
<h3>Run inference on new data<a class="headerlink" href="#run-inference-on-new-data" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">inputs</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;how do I extract keys from a dict into a list?&quot;</span><span class="p">,</span>  <span class="c1"># python</span>
    <span class="s2">&quot;debug public static void main(string[] args) {...}&quot;</span><span class="p">,</span>  <span class="c1"># java</span>
<span class="p">]</span>
<span class="n">predicted_scores</span> <span class="o">=</span> <span class="n">export_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>
<span class="n">predicted_labels</span> <span class="o">=</span> <span class="n">get_string_labels</span><span class="p">(</span><span class="n">predicted_scores</span><span class="p">)</span>
<span class="k">for</span> <span class="nb">input</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">predicted_labels</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Question: &quot;</span><span class="p">,</span> <span class="nb">input</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Predicted label: &quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">.</span><span class="n">numpy</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Question:  how do I extract keys from a dict into a list?
Predicted label:  b&#39;python&#39;
Question:  debug public static void main(string[] args) {...}
Predicted label:  b&#39;java&#39;
</pre></div>
</div>
</div>
</div>
<p>Including the text preprocessing logic inside your model enables you to export a model for production that simplifies deployment, and reduces the potential for <a class="reference external" href="https://developers.google.com/machine-learning/guides/rules-of-ml#training-serving_skew">train/test skew</a>.</p>
<p>There is a performance difference to keep in mind when choosing where to apply your <code class="docutils literal notranslate"><span class="pre">TextVectorization</span></code> layer. Using it outside of your model enables you to do asynchronous CPU processing and buffering of your data when training on GPU. So, if you’re training your model on the GPU, you probably want to go with this option to get the best performance while developing your model, then switch to including the TextVectorization layer inside your model when you’re ready to prepare for deployment.</p>
<p>Visit this <a class="reference external" href="https://www.tensorflow.org/tutorials/keras/save_and_load">tutorial</a> to learn more about saving models.</p>
</div>
</div>
<div class="section" id="example-2-predict-the-author-of-illiad-translations">
<h2>Example 2: Predict the author of Illiad translations<a class="headerlink" href="#example-2-predict-the-author-of-illiad-translations" title="Permalink to this headline">¶</a></h2>
<p>The following provides an example of using <code class="docutils literal notranslate"><span class="pre">tf.data.TextLineDataset</span></code> to load examples from text files, and <code class="docutils literal notranslate"><span class="pre">tf.text</span></code> to preprocess the data. In this example, you will use three different English translations of the same work, Homer’s Illiad, and train a model to identify the translator given a single line of text.</p>
<div class="section" id="id1">
<h3>Download and explore the dataset<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>The texts of the three translations are by:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://en.wikipedia.org/wiki/William_Cowper">William Cowper</a> — <a class="reference external" href="https://storage.googleapis.com/download.tensorflow.org/data/illiad/cowper.txt">text</a></p></li>
<li><p><a class="reference external" href="https://en.wikipedia.org/wiki/Edward_Smith-Stanley,_14th_Earl_of_Derby">Edward, Earl of Derby</a> — <a class="reference external" href="https://storage.googleapis.com/download.tensorflow.org/data/illiad/derby.txt">text</a></p></li>
<li><p><a class="reference external" href="https://en.wikipedia.org/wiki/Samuel_Butler_%28novelist%29">Samuel Butler</a> — <a class="reference external" href="https://storage.googleapis.com/download.tensorflow.org/data/illiad/butler.txt">text</a></p></li>
</ul>
<p>The text files used in this tutorial have undergone some typical preprocessing tasks like removing document header and footer, line numbers and chapter titles. Download these lightly munged files locally.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">DIRECTORY_URL</span> <span class="o">=</span> <span class="s1">&#39;https://storage.googleapis.com/download.tensorflow.org/data/illiad/&#39;</span>
<span class="n">FILE_NAMES</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;cowper.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;derby.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;butler.txt&#39;</span><span class="p">]</span>

<span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">FILE_NAMES</span><span class="p">:</span>
    <span class="n">text_dir</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">get_file</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="n">DIRECTORY_URL</span> <span class="o">+</span> <span class="n">name</span><span class="p">)</span>

<span class="n">parent_dir</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">text_dir</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span>
<span class="nb">list</span><span class="p">(</span><span class="n">parent_dir</span><span class="o">.</span><span class="n">iterdir</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[PosixPath(&#39;/Users/comafire/.keras/datasets/cowper.txt&#39;),
 PosixPath(&#39;/Users/comafire/.keras/datasets/imdb_word_index.json&#39;),
 PosixPath(&#39;/Users/comafire/.keras/datasets/flower_photos.tar.gz&#39;),
 PosixPath(&#39;/Users/comafire/.keras/datasets/mnist.npz&#39;),
 PosixPath(&#39;/Users/comafire/.keras/datasets/fashion-mnist&#39;),
 PosixPath(&#39;/Users/comafire/.keras/datasets/butler.txt&#39;),
 PosixPath(&#39;/Users/comafire/.keras/datasets/imdb.npz&#39;),
 PosixPath(&#39;/Users/comafire/.keras/datasets/derby.txt&#39;),
 PosixPath(&#39;/Users/comafire/.keras/datasets/auto-mpg.data&#39;),
 PosixPath(&#39;/Users/comafire/.keras/datasets/train.csv&#39;),
 PosixPath(&#39;/Users/comafire/.keras/datasets/flower_photos&#39;),
 PosixPath(&#39;/Users/comafire/.keras/datasets/eval.csv&#39;)]
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="id2">
<h3>Load the dataset<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<p>You will use <code class="docutils literal notranslate"><span class="pre">TextLineDataset</span></code>, which is designed to create a <code class="docutils literal notranslate"><span class="pre">tf.data.Dataset</span></code> from a text file in which each example is a line of text from the original file, whereas <code class="docutils literal notranslate"><span class="pre">text_dataset_from_directory</span></code> treats all contents of a file as a single example. <code class="docutils literal notranslate"><span class="pre">TextLineDataset</span></code> is useful for text data that is primarily line-based (for example, poetry or error logs).</p>
<p>Iterate through these files, loading each one into its own dataset. Each example needs to be individually labeled, so use <code class="docutils literal notranslate"><span class="pre">tf.data.Dataset.map</span></code> to apply a labeler function to each one. This will iterate over every example in the dataset, returning (<code class="docutils literal notranslate"><span class="pre">example,</span> <span class="pre">label</span></code>) pairs.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">labeler</span><span class="p">(</span><span class="n">example</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">example</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">labeled_data_sets</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">file_name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">FILE_NAMES</span><span class="p">):</span>
    <span class="n">lines_dataset</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">TextLineDataset</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">parent_dir</span><span class="o">/</span><span class="n">file_name</span><span class="p">))</span>
    <span class="n">labeled_dataset</span> <span class="o">=</span> <span class="n">lines_dataset</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">ex</span><span class="p">:</span> <span class="n">labeler</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span>
    <span class="n">labeled_data_sets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">labeled_dataset</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Next, you’ll combine these labeled datasets into a single dataset, and shuffle it.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">BUFFER_SIZE</span> <span class="o">=</span> <span class="mi">50000</span>
<span class="n">BATCH_SIZE</span> <span class="o">=</span> <span class="mi">64</span>
<span class="n">VALIDATION_SIZE</span> <span class="o">=</span> <span class="mi">5000</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">all_labeled_data</span> <span class="o">=</span> <span class="n">labeled_data_sets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="k">for</span> <span class="n">labeled_dataset</span> <span class="ow">in</span> <span class="n">labeled_data_sets</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
    <span class="n">all_labeled_data</span> <span class="o">=</span> <span class="n">all_labeled_data</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">labeled_dataset</span><span class="p">)</span>

<span class="n">all_labeled_data</span> <span class="o">=</span> <span class="n">all_labeled_data</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span>
    <span class="n">BUFFER_SIZE</span><span class="p">,</span> <span class="n">reshuffle_each_iteration</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Print out a few examples as before. The dataset hasn’t been batched yet, hence each entry in <code class="docutils literal notranslate"><span class="pre">all_labeled_data</span></code> corresponds to one data point:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">text</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">all_labeled_data</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Sentence: &quot;</span><span class="p">,</span> <span class="n">text</span><span class="o">.</span><span class="n">numpy</span><span class="p">())</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Label:&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">.</span><span class="n">numpy</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Sentence:  b&quot;That slackness show&#39;st which in another seen&quot;
Label: 0
Sentence:  b&#39;That on the mountain side have hunted down&#39;
Label: 1
Sentence:  b&#39;By Vulcan for the mighty Sire of all.&#39;
Label: 0
Sentence:  b&#39;That so thou mayst not fail to gain a prize.&#39;
Label: 1
Sentence:  b&#39;utterly effaced.&quot;&#39;
Label: 2
Sentence:  b&#39;And legs and feet, the arms, and eyes, of all&#39;
Label: 1
Sentence:  b&#39;Ulysses yet heard not, but, passing, flew&#39;
Label: 0
Sentence:  b&#39;and help either Trojans or Danaans.&#39;
Label: 2
Sentence:  b&quot;The Hero&#39;s knees; for longingly he sought&quot;
Label: 1
Sentence:  b&quot;Around a stag, that from an archer&#39;s hand&quot;
Label: 1
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="id3">
<h3>Prepare the dataset for training<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<p>Instead of using the Keras <code class="docutils literal notranslate"><span class="pre">TextVectorization</span></code> layer to preprocess our text dataset, you will now use the <a class="reference external" href="https://www.tensorflow.org/tutorials/tensorflow_text/intro"><code class="docutils literal notranslate"><span class="pre">tf.text</span></code> API</a> to standardize and tokenize the data, build a vocabulary and use <code class="docutils literal notranslate"><span class="pre">StaticVocabularyTable</span></code> to map tokens to integers to feed to the model.</p>
<p>While tf.text provides various tokenizers, you will use the <code class="docutils literal notranslate"><span class="pre">UnicodeScriptTokenizer</span></code> to tokenize our dataset. Define a function to convert the text to lower-case and tokenize it. You will use <code class="docutils literal notranslate"><span class="pre">tf.data.Dataset.map</span></code> to apply the tokenization to the dataset.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tokenizer</span> <span class="o">=</span> <span class="n">tftext</span><span class="o">.</span><span class="n">UnicodeScriptTokenizer</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">tokenize</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">unused_label</span><span class="p">):</span>
    <span class="n">lower_case</span> <span class="o">=</span> <span class="n">tftext</span><span class="o">.</span><span class="n">case_fold_utf8</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">tokenizer</span><span class="o">.</span><span class="n">tokenize</span><span class="p">(</span><span class="n">lower_case</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tokenized_ds</span> <span class="o">=</span> <span class="n">all_labeled_data</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">tokenize</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>WARNING:tensorflow:From /Users/comafire/.pyenv/versions/3.7.6/envs/st-kilda-pier/lib/python3.7/site-packages/tensorflow/python/util/dispatch.py:201: batch_gather (from tensorflow.python.ops.array_ops) is deprecated and will be removed after 2017-10-25.
Instructions for updating:
`tf.batch_gather` is deprecated, please use `tf.gather` with `batch_dims=-1` instead.
</pre></div>
</div>
</div>
</div>
<p>You can iterate over the dataset and print out a few tokenized examples.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">text_batch</span> <span class="ow">in</span> <span class="n">tokenized_ds</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Tokens: &quot;</span><span class="p">,</span> <span class="n">text_batch</span><span class="o">.</span><span class="n">numpy</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Tokens:  [b&#39;that&#39; b&#39;slackness&#39; b&#39;show&#39; b&quot;&#39;&quot; b&#39;st&#39; b&#39;which&#39; b&#39;in&#39; b&#39;another&#39; b&#39;seen&#39;]
Tokens:  [b&#39;that&#39; b&#39;on&#39; b&#39;the&#39; b&#39;mountain&#39; b&#39;side&#39; b&#39;have&#39; b&#39;hunted&#39; b&#39;down&#39;]
Tokens:  [b&#39;by&#39; b&#39;vulcan&#39; b&#39;for&#39; b&#39;the&#39; b&#39;mighty&#39; b&#39;sire&#39; b&#39;of&#39; b&#39;all&#39; b&#39;.&#39;]
Tokens:  [b&#39;that&#39; b&#39;so&#39; b&#39;thou&#39; b&#39;mayst&#39; b&#39;not&#39; b&#39;fail&#39; b&#39;to&#39; b&#39;gain&#39; b&#39;a&#39; b&#39;prize&#39;
 b&#39;.&#39;]
Tokens:  [b&#39;utterly&#39; b&#39;effaced&#39; b&#39;.&quot;&#39;]
</pre></div>
</div>
</div>
</div>
<p>Next, you will build a vocabulary by sorting tokens by frequency and keeping the top <code class="docutils literal notranslate"><span class="pre">VOCAB_SIZE</span></code> tokens.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tokenized_ds</span> <span class="o">=</span> <span class="n">configure_dataset</span><span class="p">(</span><span class="n">tokenized_ds</span><span class="p">)</span>

<span class="n">vocab_dict</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="mi">0</span><span class="p">)</span>
<span class="k">for</span> <span class="n">toks</span> <span class="ow">in</span> <span class="n">tokenized_ds</span><span class="o">.</span><span class="n">as_numpy_iterator</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">tok</span> <span class="ow">in</span> <span class="n">toks</span><span class="p">:</span>
        <span class="n">vocab_dict</span><span class="p">[</span><span class="n">tok</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

<span class="n">vocab</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">vocab_dict</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">vocab</span> <span class="o">=</span> <span class="p">[</span><span class="n">token</span> <span class="k">for</span> <span class="n">token</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">vocab</span><span class="p">]</span>
<span class="n">vocab</span> <span class="o">=</span> <span class="n">vocab</span><span class="p">[:</span><span class="n">VOCAB_SIZE</span><span class="p">]</span>
<span class="n">vocab_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">vocab</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Vocab size: &quot;</span><span class="p">,</span> <span class="n">vocab_size</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;First five vocab entries:&quot;</span><span class="p">,</span> <span class="n">vocab</span><span class="p">[:</span><span class="mi">5</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Vocab size:  10000
First five vocab entries: [b&#39;,&#39;, b&#39;the&#39;, b&#39;and&#39;, b&quot;&#39;&quot;, b&#39;of&#39;]
</pre></div>
</div>
</div>
</div>
<p>To convert the tokens into integers, use the <code class="docutils literal notranslate"><span class="pre">vocab</span></code> set to create a <code class="docutils literal notranslate"><span class="pre">StaticVocabularyTable</span></code>. You will map tokens to integers in the range [<code class="docutils literal notranslate"><span class="pre">2</span></code>, <code class="docutils literal notranslate"><span class="pre">vocab_size</span> <span class="pre">+</span> <span class="pre">2</span></code>]. As with the <code class="docutils literal notranslate"><span class="pre">TextVectorization</span></code> layer, <code class="docutils literal notranslate"><span class="pre">0</span></code> is reserved to denote padding and <code class="docutils literal notranslate"><span class="pre">1</span></code> is reserved to denote an out-of-vocabulary (OOV) token.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">keys</span> <span class="o">=</span> <span class="n">vocab</span>
<span class="n">values</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">vocab</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>  <span class="c1"># reserve 0 for padding, 1 for OOV</span>

<span class="n">init</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">lookup</span><span class="o">.</span><span class="n">KeyValueTensorInitializer</span><span class="p">(</span>
    <span class="n">keys</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">key_dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">string</span><span class="p">,</span> <span class="n">value_dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>

<span class="n">num_oov_buckets</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">vocab_table</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">lookup</span><span class="o">.</span><span class="n">StaticVocabularyTable</span><span class="p">(</span><span class="n">init</span><span class="p">,</span> <span class="n">num_oov_buckets</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Finally, define a fuction to standardize, tokenize and vectorize the dataset using the tokenizer and lookup table:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">preprocess_text</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">label</span><span class="p">):</span>
    <span class="n">standardized</span> <span class="o">=</span> <span class="n">tftext</span><span class="o">.</span><span class="n">case_fold_utf8</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="n">tokenized</span> <span class="o">=</span> <span class="n">tokenizer</span><span class="o">.</span><span class="n">tokenize</span><span class="p">(</span><span class="n">standardized</span><span class="p">)</span>
    <span class="n">vectorized</span> <span class="o">=</span> <span class="n">vocab_table</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span><span class="n">tokenized</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">vectorized</span><span class="p">,</span> <span class="n">label</span>
</pre></div>
</div>
</div>
</div>
<p>You can try this on a single example to see the output:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">example_text</span><span class="p">,</span> <span class="n">example_label</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">all_labeled_data</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Sentence: &quot;</span><span class="p">,</span> <span class="n">example_text</span><span class="o">.</span><span class="n">numpy</span><span class="p">())</span>
<span class="n">vectorized_text</span><span class="p">,</span> <span class="n">example_label</span> <span class="o">=</span> <span class="n">preprocess_text</span><span class="p">(</span><span class="n">example_text</span><span class="p">,</span> <span class="n">example_label</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Vectorized sentence: &quot;</span><span class="p">,</span> <span class="n">vectorized_text</span><span class="o">.</span><span class="n">numpy</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Sentence:  b&quot;That slackness show&#39;st which in another seen&quot;
Vectorized sentence:  [  23 3768  740    5  227   73   13  316  698]
</pre></div>
</div>
</div>
</div>
<p>Now run the preprocess function on the dataset using <code class="docutils literal notranslate"><span class="pre">tf.data.Dataset.map</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">all_encoded_data</span> <span class="o">=</span> <span class="n">all_labeled_data</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">preprocess_text</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="split-the-dataset-into-train-and-test">
<h3>Split the dataset into train and test<a class="headerlink" href="#split-the-dataset-into-train-and-test" title="Permalink to this headline">¶</a></h3>
<p>The Keras <code class="docutils literal notranslate"><span class="pre">TextVectorization</span></code> layer also batches and pads the vectorized data. Padding is required because the examples inside of a batch need to be the same size and shape, but the examples in these datasets are not all the same size — each line of text has a different number of words. <code class="docutils literal notranslate"><span class="pre">tf.data.Dataset</span></code> supports splitting and padded-batching datasets:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train_data</span> <span class="o">=</span> <span class="n">all_encoded_data</span><span class="o">.</span><span class="n">skip</span><span class="p">(</span><span class="n">VALIDATION_SIZE</span><span class="p">)</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">BUFFER_SIZE</span><span class="p">)</span>
<span class="n">validation_data</span> <span class="o">=</span> <span class="n">all_encoded_data</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">VALIDATION_SIZE</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train_data</span> <span class="o">=</span> <span class="n">train_data</span><span class="o">.</span><span class="n">padded_batch</span><span class="p">(</span><span class="n">BATCH_SIZE</span><span class="p">)</span>
<span class="n">validation_data</span> <span class="o">=</span> <span class="n">validation_data</span><span class="o">.</span><span class="n">padded_batch</span><span class="p">(</span><span class="n">BATCH_SIZE</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now, <code class="docutils literal notranslate"><span class="pre">validation_data</span></code> and <code class="docutils literal notranslate"><span class="pre">train_data</span></code> are not collections of (<code class="docutils literal notranslate"><span class="pre">example,</span> <span class="pre">label</span></code>) pairs, but collections of batches. Each batch is a pair of (<em>many examples</em>, <em>many labels</em>) represented as arrays. To illustrate:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sample_text</span><span class="p">,</span> <span class="n">sample_labels</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">validation_data</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Text batch shape: &quot;</span><span class="p">,</span> <span class="n">sample_text</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Label batch shape: &quot;</span><span class="p">,</span> <span class="n">sample_labels</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;First text example: &quot;</span><span class="p">,</span> <span class="n">sample_text</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;First label example: &quot;</span><span class="p">,</span> <span class="n">sample_labels</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text batch shape:  (64, 16)
Label batch shape:  (64,)
First text example:  tf.Tensor(
[  23 3768  740    5  227   73   13  316  698    0    0    0    0    0
    0    0], shape=(16,), dtype=int64)
First label example:  tf.Tensor(0, shape=(), dtype=int64)
</pre></div>
</div>
</div>
</div>
<p>Since we use <code class="docutils literal notranslate"><span class="pre">0</span></code> for padding and <code class="docutils literal notranslate"><span class="pre">1</span></code> for out-of-vocabulary (OOV) tokens, the vocabulary size has increased by two.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">vocab_size</span> <span class="o">+=</span> <span class="mi">2</span>
</pre></div>
</div>
</div>
</div>
<p>Configure the datasets for better performance as before.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train_data</span> <span class="o">=</span> <span class="n">configure_dataset</span><span class="p">(</span><span class="n">train_data</span><span class="p">)</span>
<span class="n">validation_data</span> <span class="o">=</span> <span class="n">configure_dataset</span><span class="p">(</span><span class="n">validation_data</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="id4">
<h3>Train the model<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<p>You can train a model on this dataset as before.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">create_model</span><span class="p">(</span><span class="n">vocab_size</span><span class="o">=</span><span class="n">vocab_size</span><span class="p">,</span> <span class="n">num_labels</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
    <span class="n">optimizer</span><span class="o">=</span><span class="s1">&#39;adam&#39;</span><span class="p">,</span>
    <span class="n">loss</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">losses</span><span class="o">.</span><span class="n">SparseCategoricalCrossentropy</span><span class="p">(</span><span class="n">from_logits</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
    <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;accuracy&#39;</span><span class="p">])</span>
<span class="n">history</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_data</span><span class="p">,</span> <span class="n">validation_data</span><span class="o">=</span><span class="n">validation_data</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 1/3
697/697 [==============================] - 20s 9ms/step - loss: 0.6960 - accuracy: 0.6690 - val_loss: 0.3855 - val_accuracy: 0.8356
Epoch 2/3
697/697 [==============================] - 5s 7ms/step - loss: 0.3189 - accuracy: 0.8692 - val_loss: 0.3723 - val_accuracy: 0.8404
Epoch 3/3
697/697 [==============================] - 5s 7ms/step - loss: 0.2209 - accuracy: 0.9158 - val_loss: 0.4027 - val_accuracy: 0.8402
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">loss</span><span class="p">,</span> <span class="n">accuracy</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">validation_data</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Loss: &quot;</span><span class="p">,</span> <span class="n">loss</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Accuracy: </span><span class="si">{:2.2%}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">accuracy</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>79/79 [==============================] - 1s 793us/step - loss: 0.4027 - accuracy: 0.8402
Loss:  0.4027015268802643
Accuracy: 84.02%
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="id5">
<h3>Export the model<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<p>To make our model capable to taking raw strings as input, you will create a <code class="docutils literal notranslate"><span class="pre">TextVectorization</span></code> layer that performs the same steps as our custom preprocessing function. Since you already trained a vocabulary, you can use <code class="docutils literal notranslate"><span class="pre">set_vocaublary</span></code> instead of <code class="docutils literal notranslate"><span class="pre">adapt</span></code> which trains a new vocabulary.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">preprocess_layer</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">experimental</span><span class="o">.</span><span class="n">preprocessing</span><span class="o">.</span><span class="n">TextVectorization</span><span class="p">(</span>
    <span class="n">max_tokens</span><span class="o">=</span><span class="n">vocab_size</span><span class="p">,</span>
    <span class="n">standardize</span><span class="o">=</span><span class="n">tftext</span><span class="o">.</span><span class="n">case_fold_utf8</span><span class="p">,</span>
    <span class="n">split</span><span class="o">=</span><span class="n">tokenizer</span><span class="o">.</span><span class="n">tokenize</span><span class="p">,</span>
    <span class="n">output_mode</span><span class="o">=</span><span class="s1">&#39;int&#39;</span><span class="p">,</span>
    <span class="n">output_sequence_length</span><span class="o">=</span><span class="n">MAX_SEQUENCE_LENGTH</span><span class="p">)</span>
<span class="n">preprocess_layer</span><span class="o">.</span><span class="n">set_vocabulary</span><span class="p">(</span><span class="n">vocab</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">export_model</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Sequential</span><span class="p">([</span>
    <span class="n">preprocess_layer</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Activation</span><span class="p">(</span><span class="s1">&#39;sigmoid&#39;</span><span class="p">)</span>
<span class="p">])</span>

<span class="n">export_model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
    <span class="n">loss</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">losses</span><span class="o">.</span><span class="n">SparseCategoricalCrossentropy</span><span class="p">(</span><span class="n">from_logits</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
    <span class="n">optimizer</span><span class="o">=</span><span class="s1">&#39;adam&#39;</span><span class="p">,</span>
    <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;accuracy&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create a test dataset of raw strings</span>
<span class="n">test_ds</span> <span class="o">=</span> <span class="n">all_labeled_data</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">VALIDATION_SIZE</span><span class="p">)</span><span class="o">.</span><span class="n">batch</span><span class="p">(</span><span class="n">BATCH_SIZE</span><span class="p">)</span>
<span class="n">test_ds</span> <span class="o">=</span> <span class="n">configure_dataset</span><span class="p">(</span><span class="n">test_ds</span><span class="p">)</span>
<span class="n">loss</span><span class="p">,</span> <span class="n">accuracy</span> <span class="o">=</span> <span class="n">export_model</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">test_ds</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Loss: &quot;</span><span class="p">,</span> <span class="n">loss</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Accuracy: </span><span class="si">{:2.2%}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">accuracy</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>79/79 [==============================] - 5s 3ms/step - loss: 0.5794 - accuracy: 0.7733
Loss:  0.587557315826416
Accuracy: 77.12%
</pre></div>
</div>
</div>
</div>
<p>The loss and accuracy for the model on encoded validation set and the exported model on the raw validation set are the same, as expected.</p>
</div>
<div class="section" id="id6">
<h3>Run inference on new data<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">inputs</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;Join&#39;d to th&#39; Ionians with their flowing robes,&quot;</span><span class="p">,</span>  <span class="c1"># Label: 1</span>
    <span class="s2">&quot;the allies, and his armour flashed about him so that he seemed to all&quot;</span><span class="p">,</span>  <span class="c1"># Label: 2</span>
    <span class="s2">&quot;And with loud clangor of his arms he fell.&quot;</span><span class="p">,</span>  <span class="c1"># Label: 0</span>
<span class="p">]</span>
<span class="n">predicted_scores</span> <span class="o">=</span> <span class="n">export_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>
<span class="n">predicted_labels</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">predicted_scores</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="k">for</span> <span class="nb">input</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">predicted_labels</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Question: &quot;</span><span class="p">,</span> <span class="nb">input</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Predicted label: &quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">.</span><span class="n">numpy</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Question:  Join&#39;d to th&#39; Ionians with their flowing robes,
Predicted label:  1
Question:  the allies, and his armour flashed about him so that he seemed to all
Predicted label:  2
Question:  And with loud clangor of his arms he fell.
Predicted label:  0
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="downloading-more-datasets-using-tensorflow-datasets-tfds">
<h2>Downloading more datasets using TensorFlow Datasets (TFDS)<a class="headerlink" href="#downloading-more-datasets-using-tensorflow-datasets-tfds" title="Permalink to this headline">¶</a></h2>
<p>You can download many more datasets from <a class="reference external" href="https://www.tensorflow.org/datasets/catalog/overview">TensorFlow Datasets</a>. As an example, you will download the <a class="reference external" href="https://www.tensorflow.org/datasets/catalog/imdb_reviews">IMDB Large Movie Review dataset</a>, and use it to train a model for sentiment classification.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train_ds</span> <span class="o">=</span> <span class="n">tfds</span><span class="o">.</span><span class="n">load</span><span class="p">(</span>
    <span class="s1">&#39;imdb_reviews&#39;</span><span class="p">,</span>
    <span class="n">split</span><span class="o">=</span><span class="s1">&#39;train&#39;</span><span class="p">,</span>
    <span class="n">batch_size</span><span class="o">=</span><span class="n">BATCH_SIZE</span><span class="p">,</span>
    <span class="n">shuffle_files</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">as_supervised</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">val_ds</span> <span class="o">=</span> <span class="n">tfds</span><span class="o">.</span><span class="n">load</span><span class="p">(</span>
    <span class="s1">&#39;imdb_reviews&#39;</span><span class="p">,</span>
    <span class="n">split</span><span class="o">=</span><span class="s1">&#39;train&#39;</span><span class="p">,</span>
    <span class="n">batch_size</span><span class="o">=</span><span class="n">BATCH_SIZE</span><span class="p">,</span>
    <span class="n">shuffle_files</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">as_supervised</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Print a few examples.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">review_batch</span><span class="p">,</span> <span class="n">label_batch</span> <span class="ow">in</span> <span class="n">val_ds</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Review: &quot;</span><span class="p">,</span> <span class="n">review_batch</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">numpy</span><span class="p">())</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Label: &quot;</span><span class="p">,</span> <span class="n">label_batch</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">numpy</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Review:  b&#39;This is the kind of film for a snowy Sunday afternoon when the rest of the world can go ahead with its own business as you descend into a big arm-chair and mellow for a couple of hours. Wonderful performances from Cher and Nicolas Cage (as always) gently row the plot along. There are no rapids to cross, no dangerous waters, just a warm and witty paddle through New York life at its best. A family film in every sense and one that deserves the praise it received.&#39;
Label:  1
Review:  b&quot;This is a film which should be seen by anybody interested in, effected by, or suffering from an eating disorder. It is an amazingly accurate and sensitive portrayal of bulimia in a teenage girl, its causes and its symptoms. The girl is played by one of the most brilliant young actresses working in cinema today, Alison Lohman, who was later so spectacular in &#39;Where the Truth Lies&#39;. I would recommend that this film be shown in all schools, as you will never see a better on this subject. Alison Lohman is absolutely outstanding, and one marvels at her ability to convey the anguish of a girl suffering from this compulsive disorder. If barometers tell us the air pressure, Alison Lohman tells us the emotional pressure with the same degree of accuracy. Her emotional range is so precise, each scene could be measured microscopically for its gradations of trauma, on a scale of rising hysteria and desperation which reaches unbearable intensity. Mare Winningham is the perfect choice to play her mother, and does so with immense sympathy and a range of emotions just as finely tuned as Lohman&#39;s. Together, they make a pair of sensitive emotional oscillators vibrating in resonance with one another. This film is really an astonishing achievement, and director Katt Shea should be proud of it. The only reason for not seeing it is if you are not interested in people. But even if you like nature films best, this is after all animal behaviour at the sharp edge. Bulimia is an extreme version of how a tormented soul can destroy her own body in a frenzy of despair. And if we don&#39;t sympathise with people suffering from the depths of despair, then we are dead inside.&quot;
Label:  1
Review:  b&#39;I really love the sexy action and sci-fi films of the sixties and its because of the actress\&#39;s that appeared in them. They found the sexiest women to be in these films and it didn\&#39;t matter if they could act (Remember &quot;Candy&quot;?). The reason I was disappointed by this film was because it wasn\&#39;t nostalgic enough. The story here has a European sci-fi film called &quot;Dragonfly&quot; being made and the director is fired. So the producers decide to let a young aspiring filmmaker (Jeremy Davies) to complete the picture. They\&#39;re is one real beautiful woman in the film who plays Dragonfly but she\&#39;s barely in it. Film is written and directed by Roman Coppola who uses some of his fathers exploits from his early days and puts it into the script. I wish the film could have been an homage to those early films. They could have lots of cameos by actors who appeared in them. There is one actor in this film who was popular from the sixties and its John Phillip Law (Barbarella). Gerard Depardieu, Giancarlo Giannini and Dean Stockwell appear as well. I guess I\&#39;m going to have to continue waiting for a director to make a good homage to the films of the sixties. If any are reading this, &quot;Make it as sexy as you can&quot;! I\&#39;ll be waiting!&#39;
Label:  0
Review:  b&#39;During a sleepless night, I was switching through the channels &amp; found this embarrassment of a movie. What were they thinking?&lt;br /&gt;&lt;br /&gt;If this is life after &quot;Remote Control&quot; for Kari (Wuhrer) Salin, no wonder she\&#39;s gone nowhere.&lt;br /&gt;&lt;br /&gt;And why did David Keith take this role? It\&#39;s pathetic!&lt;br /&gt;&lt;br /&gt;Anyway, I turned on the movie near the end, so I didn\&#39;t get much of the plot. But this must\&#39;ve been the best part. This nerdy college kid brings home this dominatrix-ish girl...this scene is straight out of the comic books -- or the cheap porn movies. She calls the mother anal retentive and kisses the father &quot;Oh, I didn\&#39;t expect tongue!&quot; Great lines!&lt;br /&gt;&lt;br /&gt;After this, I had to see how it ended..&lt;br /&gt;&lt;br /&gt;Well, of course, this bitch from hell has a helluva past, so the SWAT team is upstairs. And yes...they surround her! And YES YES! The kid blows her brains out!!!! AHAHHAHAHAHA!!&lt;br /&gt;&lt;br /&gt;This is must-see TV. &lt;br /&gt;&lt;br /&gt;&#39;
Label:  0
Review:  b&#39;Cute film about three lively sisters from Switzerland (often seen running about in matching outfits) who want to get their parents back together (seems mom is still carrying the torch for dad) - so they sail off to New York to stop the dad from marrying a blonde gold-digger he calls &quot;Precious&quot;. Dad hasn\&#39;t seen his daughters in ten years, they (oddly enough) don\&#39;t seem to mind and think he\&#39;s wonderful, and meanwhile Precious seems to lead a life mainly run by her overbearing mother (Alice Brady), a woman who just wants to see to it her daughter marries a rich man. The sisters get the idea of pushing Precious into the path of a drunken Hungarian count, tricking the two gold-digging women into thinking he is one of the richest men in Europe. But a case of mistaken identity makes the girls think the count is good-looking Ray Milland, who goes along with the scheme \&#39;cause he has a crush on sister Kay.&lt;br /&gt;&lt;br /&gt;This film is enjoyable, light fare. Barbara Read as Kay comes across as sweet and pretty, Ray Milland looks oh so young and handsome here (though, unfortunately, is given little to do), Alice Brady is quite good as the scheming mother - but it is Deanna Durbin, a real charmer and cute as a button playing youngest sister Penny, who pretty much steals the show. With absolutely beautiful vocals, she sings several songs throughout the film, though I actually would have liked to have seen them feature her even more in this. The plot in this film is a bit silly, but nevertheless, I found the film to be entertaining and fun.&#39;
Label:  1
</pre></div>
</div>
</div>
</div>
<p>You can now preprocess the data and train a model as before.</p>
<p>Note: You will use <code class="docutils literal notranslate"><span class="pre">losses.BinaryCrossentropy</span></code> instead of <code class="docutils literal notranslate"><span class="pre">losses.SparseCategoricalCrossentropy</span></code> for your model since this is a binary classification problem.</p>
<div class="section" id="id7">
<h3>Prepare the dataset for training<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">vectorize_layer</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">experimental</span><span class="o">.</span><span class="n">preprocessing</span><span class="o">.</span><span class="n">TextVectorization</span><span class="p">(</span>
    <span class="n">max_tokens</span><span class="o">=</span><span class="n">VOCAB_SIZE</span><span class="p">,</span>
    <span class="n">output_mode</span><span class="o">=</span><span class="s1">&#39;int&#39;</span><span class="p">,</span>
    <span class="n">output_sequence_length</span><span class="o">=</span><span class="n">MAX_SEQUENCE_LENGTH</span><span class="p">)</span>

<span class="c1"># Make a text-only dataset (without labels), then call adapt</span>
<span class="n">train_text</span> <span class="o">=</span> <span class="n">train_ds</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">text</span><span class="p">,</span> <span class="n">labels</span><span class="p">:</span> <span class="n">text</span><span class="p">)</span>
<span class="n">vectorize_layer</span><span class="o">.</span><span class="n">adapt</span><span class="p">(</span><span class="n">train_text</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">vectorize_text</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">label</span><span class="p">):</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">vectorize_layer</span><span class="p">(</span><span class="n">text</span><span class="p">),</span> <span class="n">label</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train_ds</span> <span class="o">=</span> <span class="n">train_ds</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">vectorize_text</span><span class="p">)</span>
<span class="n">val_ds</span> <span class="o">=</span> <span class="n">val_ds</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">vectorize_text</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Configure datasets for performance as before</span>
<span class="n">train_ds</span> <span class="o">=</span> <span class="n">configure_dataset</span><span class="p">(</span><span class="n">train_ds</span><span class="p">)</span>
<span class="n">val_ds</span> <span class="o">=</span> <span class="n">configure_dataset</span><span class="p">(</span><span class="n">val_ds</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="id8">
<h3>Train the model<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">create_model</span><span class="p">(</span><span class="n">vocab_size</span><span class="o">=</span><span class="n">VOCAB_SIZE</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">num_labels</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Model: &quot;sequential_5&quot;
_________________________________________________________________
Layer (type)                 Output Shape              Param #   
=================================================================
embedding_2 (Embedding)      (None, None, 64)          640064    
_________________________________________________________________
conv1d_2 (Conv1D)            (None, None, 64)          20544     
_________________________________________________________________
global_max_pooling1d_2 (Glob (None, 64)                0         
_________________________________________________________________
dense_3 (Dense)              (None, 1)                 65        
=================================================================
Total params: 660,673
Trainable params: 660,673
Non-trainable params: 0
_________________________________________________________________
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
    <span class="n">loss</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">losses</span><span class="o">.</span><span class="n">BinaryCrossentropy</span><span class="p">(</span><span class="n">from_logits</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
    <span class="n">optimizer</span><span class="o">=</span><span class="s1">&#39;adam&#39;</span><span class="p">,</span>
    <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;accuracy&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">history</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_ds</span><span class="p">,</span> <span class="n">validation_data</span><span class="o">=</span><span class="n">val_ds</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 1/3
391/391 [==============================] - 6s 15ms/step - loss: 0.6153 - accuracy: 0.5781 - val_loss: 0.3055 - val_accuracy: 0.8793
Epoch 2/3
391/391 [==============================] - 5s 12ms/step - loss: 0.3183 - accuracy: 0.8591 - val_loss: 0.1750 - val_accuracy: 0.9431
Epoch 3/3
391/391 [==============================] - 5s 12ms/step - loss: 0.1986 - accuracy: 0.9206 - val_loss: 0.0952 - val_accuracy: 0.9779
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">loss</span><span class="p">,</span> <span class="n">accuracy</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">val_ds</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Loss: &quot;</span><span class="p">,</span> <span class="n">loss</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Accuracy: </span><span class="si">{:2.2%}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">accuracy</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>391/391 [==============================] - 1s 2ms/step - loss: 0.0952 - accuracy: 0.9779
Loss:  0.09524407982826233
Accuracy: 97.79%
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="id9">
<h3>Export the model<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">export_model</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Sequential</span><span class="p">([</span>
    <span class="n">vectorize_layer</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Activation</span><span class="p">(</span><span class="s1">&#39;sigmoid&#39;</span><span class="p">)])</span>

<span class="n">export_model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
    <span class="n">loss</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">losses</span><span class="o">.</span><span class="n">SparseCategoricalCrossentropy</span><span class="p">(</span><span class="n">from_logits</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
    <span class="n">optimizer</span><span class="o">=</span><span class="s1">&#39;adam&#39;</span><span class="p">,</span>
    <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;accuracy&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 0 --&gt; negative review</span>
<span class="c1"># 1 --&gt; positive review</span>
<span class="n">inputs</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;This is a fantastic movie.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;This is a bad movie.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;This movie was so bad that it was good.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;I will never say yes to watching this movie.&quot;</span><span class="p">,</span>
<span class="p">]</span>
<span class="n">predicted_scores</span> <span class="o">=</span> <span class="n">export_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>
<span class="n">predicted_labels</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">predicted_scores</span><span class="p">]</span>
<span class="k">for</span> <span class="nb">input</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">predicted_labels</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Question: &quot;</span><span class="p">,</span> <span class="nb">input</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Predicted label: &quot;</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Question:  This is a fantastic movie.
Predicted label:  1
Question:  This is a bad movie.
Predicted label:  0
Question:  This movie was so bad that it was good.
Predicted label:  0
Question:  I will never say yes to watching this movie.
Predicted label:  0
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="conclusion">
<h2>Conclusion<a class="headerlink" href="#conclusion" title="Permalink to this headline">¶</a></h2>
<p>This tutorial demonstrated several ways to load and preprocess text. As a next step, you can explore additional tutorials on the website, or download new datasets from <a class="reference external" href="https://www.tensorflow.org/datasets/catalog/overview">TensorFlow Datasets</a>.</p>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./datascience/deep_learning"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
        <div class='prev-next-bottom'>
            
    <a class='left-prev' id="prev-link" href="tf2_beginner_pandas.html" title="previous page">Pandas</a>
    <a class='right-next' id="next-link" href="tf2_beginner_unicode.html" title="next page">Unicode</a>

        </div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By comafire<br/>
        
            &copy; Copyright 2015.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../../_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
<script async="" src="https://www.google-analytics.com/analytics.js"></script>
<script>
                        window.ga = window.ga || function () {
                            (ga.q = ga.q || []).push(arguments) };
                        ga.l = +new Date;
                        ga('create', 'UA-81648003-1', 'auto');
                        ga('set', 'anonymizeIp', true);
                        ga('send', 'pageview');
                    </script>

  </body>
</html>