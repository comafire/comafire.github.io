
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CSV &#8212; 데사견문록</title>
    
  <link href="../../_static/css/theme.css" rel="stylesheet" />
  <link href="../../_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/sphinx-book-theme.acff12b8f9c144ce68a297486a2fa670.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../../_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/togglebutton.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Numpy" href="tf2_beginner_numpy.html" />
    <link rel="prev" title="Images" href="tf2_beginner_images.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
      <img src="../../_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">데사견문록</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../readme.html">
   데이터사이언스견문록
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  End to End Data Science
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../e2eds/data_science.html">
   Data Science
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../e2eds/e2eds.html">
   End to End Data Science
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Episodes
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../episodes/tbc.html">
   TO BE CONTINUE…
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  skillsets
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="tf2.html">
   Tensorflow2
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="tf2_10mins.html">
     TF2 10mins
    </a>
   </li>
   <li class="toctree-l2 current active has-children">
    <a class="reference internal" href="tf2_beginner.html">
     TF2 Beginner
    </a>
    <input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
    <label for="toctree-checkbox-2">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul class="current">
     <li class="toctree-l3">
      <a class="reference internal" href="tf2_beginner_quickstart.html">
       Quickstart
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="tf2_beginner_image_classification.html">
       Image Classification
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="tf2_beginner_text_classification.html">
       Text Classification
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="tf2_beginner_hub_text_classification.html">
       Text Classification with Hub
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="tf2_beginner_regression.html">
       Regression
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="tf2_beginner_overfit_underfit.html">
       Overfit &amp; Underfit
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="tf2_beginner_save_load.html">
       Save &amp; Load
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="tf2_beginner_keras_tuner.html">
       Keras Tuner
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="tf2_beginner_images.html">
       Images
      </a>
     </li>
     <li class="toctree-l3 current active">
      <a class="current reference internal" href="#">
       CSV
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="tf2_beginner_numpy.html">
       Numpy
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="tf2_beginner_pandas.html">
       Pandas
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="tf2_beginner_text.html">
       Text
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="tf2_beginner_unicode.html">
       Unicode
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="tf2_beginner_tftext.html">
       TF.Text
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="tf2_beginner_subwords_tokenizer.html">
       Subword Tokenization
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="tf2_beginner_tfrecord.html">
       TFRecord and tf.train.Example
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="tf2_beginner_tfio.html">
       TF I/O
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="tf2_advanced.html">
     TF2 Advanced
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
    <label for="toctree-checkbox-3">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="tf2_advanced_quickstart.html">
       Quickstart
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="tf2_advanced_image_cnn.html">
       Image CNN
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="tf2_advanced_image_classification.html">
       Image Classification
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="tf2_advanced_transfer_learning.html">
       Transfer learning and fine-tuning
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="tf2_advanced_transfer_learning_with_hub.html">
       Transfer learning with TensorFlow Hub
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="tf2_advanced_data_augmentation.html">
       Data augmentation
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="tf2_advanced_image_segmentation.html">
       Image Segmentation
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../keras/keras.html">
   Keras
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../keras/keras_10mins.html">
     Keras 10mins
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../keras/keras_dnn_regression.html">
     DNN Regression
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../keras/keras_dnn_classification.html">
     DNN Classification
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../keras/keras_deepmf.html">
     Deep MF
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../sklearn/sklearn.html">
   Scikit-Learn
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../sklearn/sklearn_10mins.html">
     Scikit-Learn 10mins
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../sklearn/sklearn_datasets.html">
     Datasets
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../sklearn/sklearn_preprocessing.html">
     Preprocessing
    </a>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../sklearn/sklearn_regression.html">
     Regression
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
    <label for="toctree-checkbox-6">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../sklearn/sklearn_linear_regression.html">
       Linear Regression
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../sklearn/sklearn_polynomial_regression.html">
       Polynomial Regression
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../sklearn/sklearn_sgd_regression.html">
       SGD Regression
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../sklearn/sklearn_svm_regression.html">
       SVM Regression
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../sklearn/sklearn_nearest_neighbor_regression.html">
       Nearest Neighbors Regression
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../sklearn/sklearn_ensemble_regression.html">
       Ensemble Regression
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../sklearn/sklearn_eval_regression.html">
       Regression Evaluation
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../sklearn/sklearn_classification.html">
     Classification
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
    <label for="toctree-checkbox-7">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../sklearn/sklearn_logistic_regression.html">
       Logistic Regression
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../sklearn/sklearn_sgd_classification.html">
       SGD Classification
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../sklearn/sklearn_svm_classification.html">
       SVM Classification
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../sklearn/sklearn_nearest_neighbor_classification.html">
       Nearest Neighbors Classification
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../sklearn/sklearn_ensemble_classification.html">
       Ensemble Classification
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../sklearn/sklearn_eval_classification.html">
       Classification Evaluation
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../sklearn/sklearn_clustering.html">
     Clustering
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
    <label for="toctree-checkbox-8">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../sklearn/sklearn_kmeans.html">
       K-Means
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../sklearn/sklearn_mean_shift.html">
       Mean Shift
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../sklearn/sklearn_spectral_clustering.html">
       Spectral Clustering
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../sklearn/sklearn_eval_clustering.html">
       Clustering Evaluation
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../sklearn/sklearn_feature_selection.html">
     Feature Selection
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../sklearn/sklearn_feature_extraction.html">
     Feature Extraction
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../sklearn/sklearn_split_train_test.html">
     Train/Valid/Test Dataset
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../sklearn/sklearn_model_persistence.html">
     Model Persistence
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../sklearn/sklearn_hyper_parameter_tunning.html">
     Hyper Parameter Tunning
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../sklearn/sklearn_anomaly_detection.html">
     Anomaly Detection
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../dlib/dlib.html">
   Dlib
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/>
  <label for="toctree-checkbox-9">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../dlib/dlib_frontal_face_detector.html">
     Frontal Face Detector
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../surprise/surprise.html">
   Surprise
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/>
  <label for="toctree-checkbox-10">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../surprise/surprise_collaborative_filtering.html">
     Collaborative Filtering
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../imblearn/imblearn.html">
   Imblearn
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/>
  <label for="toctree-checkbox-11">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../imblearn/imblearn_imbalanced_class.html">
     Imbalanced Class
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../spark/spark.html">
   Spark
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" type="checkbox"/>
  <label for="toctree-checkbox-12">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../spark/spark_dataframe_10mins.html">
     Spark DataFrame 10mins
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../pandas/pandas.html">
   Pandas
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" type="checkbox"/>
  <label for="toctree-checkbox-13">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../pandas/pandas_10mins.html">
     Pandas 10mins
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../pandas/pandas_missing_value.html">
     Missing Value
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../pandas/pandas_data_description.html">
     Data Description
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../numpy/numpy.html">
   Numpy
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" type="checkbox"/>
  <label for="toctree-checkbox-14">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../numpy/numpy_10mins.html">
     Numpy 10mins
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../numpy/numpy_outlier.html">
     Outlier
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../jupyter/jupyter.html">
   Jupyter
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" type="checkbox"/>
  <label for="toctree-checkbox-15">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../jupyter/jupyter_cloud.html">
     Jupyter (Cloud)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../jupyter/jupyter_native_ubuntu.html">
     Jupyter (Ubuntu)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../jupyter/jupyter_native_macos_x86.html">
     Jupyter (macOS x86)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../jupyter/jupyter_docker.html">
     Jupyter (Docker)
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../skp/skp.html">
   St. Kilda Pier (SKP)
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" type="checkbox"/>
  <label for="toctree-checkbox-16">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../skp/skp_n4e_vscode.html">
     Native Visual Studio Code
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../skp/skp_n4e_jupyter.html">
     Native Jupyter
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../skp/skp_d4r_jupyter.html">
     Docker Jupyter
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../skp/skp_n4e_traefik.html">
     Native Traefik
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../ansible/ansible.html">
   Ansible
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" type="checkbox"/>
  <label for="toctree-checkbox-17">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../ansible/ansible_skp_ubuntu.html">
     ansible_skp_ubuntu
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../vagrant/vagrant_virtualbox.html">
   Vagrant &amp; Virtualbox
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-18" name="toctree-checkbox-18" type="checkbox"/>
  <label for="toctree-checkbox-18">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../vagrant/vagrant_skp_single.html">
     vagrant_skp_single
    </a>
   </li>
  </ul>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  devicesets
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../devicesets/computer.html">
   Computer
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../devicesets/network.html">
   Network
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../devicesets/gce_nested_vm.html">
   Google Computer Engine
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../_sources/skillsets/tf2/tf2_beginner_csv.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/comafire/comafire.github.io"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/comafire/comafire.github.io/issues/new?title=Issue%20on%20page%20%2Fskillsets/tf2/tf2_beginner_csv.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/comafire/comafire.github.io/master?urlpath=tree/skillsets/tf2/tf2_beginner_csv.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#copyright-2019-the-tensorflow-authors">
   Copyright 2019 The TensorFlow Authors.
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#load-csv-data">
   Load CSV data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#in-memory-data">
   In memory data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#basic-preprocessing">
   Basic preprocessing
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#mixed-data-types">
   Mixed data types
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#using-tf-data">
   Using tf.data
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#on-in-memory-data">
     On in memory data
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#from-a-single-file">
     From a single file
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#caching">
     Caching
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#multiple-files">
     Multiple files
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#optional-packing-fields">
       Optional: Packing fields
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#lower-level-functions">
   Lower level functions
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#tf-io-decode-csv">
     <code class="docutils literal notranslate">
      <span class="pre">
       tf.io.decode_csv
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#tf-data-experimental-csvdataset">
     <code class="docutils literal notranslate">
      <span class="pre">
       tf.data.experimental.CsvDataset
      </span>
     </code>
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id1">
       Multiple files
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#performance">
       Performance
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="csv">
<h1>CSV<a class="headerlink" href="#csv" title="Permalink to this headline">¶</a></h1>
<p>TensorFlow2 공식 홈페이지에 나와 있는 코드들을 수행해 보면서 빠르게 TensorFlow2를 익혀 봅니다.</p>
<p><a class="reference external" href="https://www.tensorflow.org/tutorials/load_data/csv">https://www.tensorflow.org/tutorials/load_data/csv</a></p>
<div class="section" id="copyright-2019-the-tensorflow-authors">
<h2>Copyright 2019 The TensorFlow Authors.<a class="headerlink" href="#copyright-2019-the-tensorflow-authors" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#@title Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<span class="c1"># you may not use this file except in compliance with the License.</span>
<span class="c1"># You may obtain a copy of the License at</span>
<span class="c1">#</span>
<span class="c1"># https://www.apache.org/licenses/LICENSE-2.0</span>
<span class="c1">#</span>
<span class="c1"># Unless required by applicable law or agreed to in writing, software</span>
<span class="c1"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span class="c1"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="c1"># See the License for the specific language governing permissions and</span>
<span class="c1"># limitations under the License.</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 경고 메시지 출력 끄기</span>
<span class="kn">import</span> <span class="nn">warnings</span> 
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="n">action</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>

<span class="c1"># 노트북 셀 표시를 브라우저 전체 폭 사용하기</span>
<span class="kn">from</span> <span class="nn">IPython.core.display</span> <span class="kn">import</span> <span class="n">display</span><span class="p">,</span> <span class="n">HTML</span>
<span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="s2">&quot;&lt;style&gt;.container { width:100% !important; }&lt;/style&gt;&quot;</span><span class="p">))</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">clear_output</span>

<span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">shutil</span><span class="o">,</span> <span class="nn">functools</span>
<span class="kn">import</span> <span class="nn">collections</span><span class="o">,</span> <span class="nn">pathlib</span><span class="o">,</span> <span class="nn">re</span><span class="o">,</span> <span class="nn">string</span>

<span class="n">rseed</span> <span class="o">=</span> <span class="mi">22</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">rseed</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">rseed</span><span class="p">)</span>
<span class="n">np</span><span class="o">.</span><span class="n">set_printoptions</span><span class="p">(</span><span class="n">precision</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">np</span><span class="o">.</span><span class="n">set_printoptions</span><span class="p">(</span><span class="n">formatter</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;float_kind&#39;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">{:.5f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">})</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.max_rows&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> 
<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.max_columns&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> 
<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.max_colwidth&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">float_format</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{:,.5f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span>

<span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
<span class="n">tf</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">set_seed</span><span class="p">(</span><span class="n">rseed</span><span class="p">)</span>
<span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">set_floatx</span><span class="p">(</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span> <span class="c1"># keras default float type 설정</span>

<span class="kn">import</span> <span class="nn">tensorflow_hub</span> <span class="k">as</span> <span class="nn">tfhub</span>
<span class="kn">import</span> <span class="nn">tensorflow_datasets</span> <span class="k">as</span> <span class="nn">tfds</span>
<span class="kn">import</span> <span class="nn">tensorflow_text</span> <span class="k">as</span> <span class="nn">tftext</span>

<span class="kn">import</span> <span class="nn">kerastuner</span> <span class="k">as</span> <span class="nn">kt</span>

<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>

<span class="kn">import</span> <span class="nn">PIL</span>
<span class="kn">import</span> <span class="nn">PIL.Image</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;python ver=</span><span class="si">{</span><span class="n">sys</span><span class="o">.</span><span class="n">version</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;pandas ver=</span><span class="si">{</span><span class="n">pd</span><span class="o">.</span><span class="n">__version__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;numpy ver=</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">__version__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;tensorflow ver=</span><span class="si">{</span><span class="n">tf</span><span class="o">.</span><span class="n">__version__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;tensorflow execuring eagerly=</span><span class="si">{</span><span class="n">tf</span><span class="o">.</span><span class="n">executing_eagerly</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;tensorflow GPU=</span><span class="si">{</span><span class="s1">&#39;True&#39;</span> <span class="k">if</span> <span class="n">tf</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">experimental</span><span class="o">.</span><span class="n">list_physical_devices</span><span class="p">(</span><span class="s1">&#39;GPU&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="s1">&#39;False&#39;</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;keras tuner ver=</span><span class="si">{</span><span class="n">kt</span><span class="o">.</span><span class="n">__version__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;senborn ver=</span><span class="si">{</span><span class="n">sns</span><span class="o">.</span><span class="n">__version__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;PIL ver=</span><span class="si">{</span><span class="n">PIL</span><span class="o">.</span><span class="n">__version__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>.container { width:100% !important; }</style></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>python ver=3.7.6 (default, Nov 21 2020, 22:51:13) 
[Clang 12.0.0 (clang-1200.0.32.27)]
pandas ver=1.0.5
numpy ver=1.19.5
tensorflow ver=2.4.1
tensorflow execuring eagerly=True
tensorflow GPU=False
keras tuner ver=1.0.2
senborn ver=0.10.0
PIL ver=7.1.2
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="load-csv-data">
<h2>Load CSV data<a class="headerlink" href="#load-csv-data" title="Permalink to this headline">¶</a></h2>
<table class="tfo-notebook-buttons" align="left">
  <td>
    <a target="_blank" href="https://www.tensorflow.org/tutorials/load_data/csv"><img src="https://www.tensorflow.org/images/tf_logo_32px.png" />View on TensorFlow.org</a>
  </td>
  <td>
    <a target="_blank" href="https://colab.research.google.com/github/tensorflow/docs/blob/master/site/en/tutorials/load_data/csv.ipynb"><img src="https://www.tensorflow.org/images/colab_logo_32px.png" />Run in Google Colab</a>
  </td>
  <td>
    <a target="_blank" href="https://github.com/tensorflow/docs/blob/master/site/en/tutorials/load_data/csv.ipynb"><img src="https://www.tensorflow.org/images/GitHub-Mark-32px.png" />View source on GitHub</a>
  </td>
  <td>
    <a href="https://storage.googleapis.com/tensorflow_docs/docs/site/en/tutorials/load_data/csv.ipynb"><img src="https://www.tensorflow.org/images/download_logo_32px.png" />Download notebook</a>
  </td>
</table>
*<hr class="docutils" />
<p>This tutorial provides examples of how to use CSV data with TensorFlow.</p>
<p>There are two main parts to this:</p>
<ol class="simple">
<li><p><strong>Loading the data off disk</strong></p></li>
<li><p><strong>Pre-processing it into a form suitable for training.</strong></p></li>
</ol>
<p>This tutorial focuses on the loading, and gives some quick examples of preprocessing. For a tutorial that focuses on the preprocessing aspect see the <a class="reference external" href="https://www.tensorflow.org/guide/keras/preprocessing_layers#quick_recipes">preprocessing layers guide</a> and <a class="reference external" href="https://www.tensorflow.org/tutorials/structured_data/preprocessing_layers">tutorial</a>.</p>
</div>
<div class="section" id="in-memory-data">
<h2>In memory data<a class="headerlink" href="#in-memory-data" title="Permalink to this headline">¶</a></h2>
<p>For any small CSV dataset the simplest way to train a TensorFlow model on it is to load it into memory as a pandas Dataframe or a NumPy array.</p>
<p>A relatively simple example is the <a class="reference external" href="https://archive.ics.uci.edu/ml/datasets/abalone">abalone dataset</a>.</p>
<ul class="simple">
<li><p>The dataset is small.</p></li>
<li><p>All the input features are all limited-range floating point values.</p></li>
</ul>
<p>Here is how to download the data into a <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.html">Pandas <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code></a>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">abalone_train</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
    <span class="s2">&quot;https://storage.googleapis.com/download.tensorflow.org/data/abalone_train.csv&quot;</span><span class="p">,</span>
    <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Length&quot;</span><span class="p">,</span> <span class="s2">&quot;Diameter&quot;</span><span class="p">,</span> <span class="s2">&quot;Height&quot;</span><span class="p">,</span> <span class="s2">&quot;Whole weight&quot;</span><span class="p">,</span> <span class="s2">&quot;Shucked weight&quot;</span><span class="p">,</span>
           <span class="s2">&quot;Viscera weight&quot;</span><span class="p">,</span> <span class="s2">&quot;Shell weight&quot;</span><span class="p">,</span> <span class="s2">&quot;Age&quot;</span><span class="p">])</span>

<span class="n">abalone_train</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Length</th>
      <th>Diameter</th>
      <th>Height</th>
      <th>Whole weight</th>
      <th>Shucked weight</th>
      <th>Viscera weight</th>
      <th>Shell weight</th>
      <th>Age</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.43500</td>
      <td>0.33500</td>
      <td>0.11000</td>
      <td>0.33400</td>
      <td>0.13550</td>
      <td>0.07750</td>
      <td>0.09650</td>
      <td>7</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.58500</td>
      <td>0.45000</td>
      <td>0.12500</td>
      <td>0.87400</td>
      <td>0.35450</td>
      <td>0.20750</td>
      <td>0.22500</td>
      <td>6</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.65500</td>
      <td>0.51000</td>
      <td>0.16000</td>
      <td>1.09200</td>
      <td>0.39600</td>
      <td>0.28250</td>
      <td>0.37000</td>
      <td>14</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.54500</td>
      <td>0.42500</td>
      <td>0.12500</td>
      <td>0.76800</td>
      <td>0.29400</td>
      <td>0.14950</td>
      <td>0.26000</td>
      <td>16</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.54500</td>
      <td>0.42000</td>
      <td>0.13000</td>
      <td>0.87900</td>
      <td>0.37400</td>
      <td>0.16950</td>
      <td>0.23000</td>
      <td>13</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>The dataset contains a set of measurements of <a class="reference external" href="https://en.wikipedia.org/wiki/Abalone">abalone</a>, a type of sea snail.</p>
<p><img alt="an abalone shell" src="https://tensorflow.org/images/abalone_shell.jpg" /></p>
<p><a class="reference external" href="https://www.flickr.com/photos/thenickster/16641048623/">“Abalone shell”</a> (by <a class="reference external" href="https://www.flickr.com/photos/thenickster/">Nicki Dugan Pogue</a>, CC BY-SA 2.0)</p>
<p>The nominal task for this dataset is to predict the age from the other measurements, so separate the features and labels for training:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">abalone_features</span> <span class="o">=</span> <span class="n">abalone_train</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">abalone_labels</span> <span class="o">=</span> <span class="n">abalone_features</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;Age&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;type: abalone_features=</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">abalone_features</span><span class="p">)</span><span class="si">}</span><span class="s2">, abalone_labels=</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">abalone_labels</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;dtypes: abalone_features=</span><span class="se">\n</span><span class="si">{</span><span class="n">abalone_features</span><span class="o">.</span><span class="n">dtypes</span><span class="si">}</span><span class="se">\n</span><span class="s2">abalone_labels=</span><span class="se">\n</span><span class="si">{</span><span class="n">abalone_labels</span><span class="o">.</span><span class="n">dtypes</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>type: abalone_features=&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;, abalone_labels=&lt;class &#39;pandas.core.series.Series&#39;&gt;

dtypes: abalone_features=
Length            float64
Diameter          float64
Height            float64
Whole weight      float64
Shucked weight    float64
Viscera weight    float64
Shell weight      float64
dtype: object
abalone_labels=
int64
</pre></div>
</div>
</div>
</div>
<blockquote>
<div><p>데이터가 모두 숫자형이라면, pandas dataframe 또는 numpy 형태의 데이터를 직접 모델에 input으로 넣어 학습이 가능합니다.
여기서는 feature 는 numpyt 로 변환하고 label 은 pandas dataframe 형태로 모델에 넣어 학습을 진행하는 예를 보여줍니다.</p>
</div></blockquote>
<p>For this dataset you will treat all features identically. Pack the features into a single NumPy array.:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">abalone_features</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">abalone_features</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;type: abalone_features=</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">abalone_features</span><span class="p">)</span><span class="si">}</span><span class="s2">, abalone_labels=</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">abalone_labels</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">abalone_features</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>type: abalone_features=&lt;class &#39;numpy.ndarray&#39;&gt;, abalone_labels=&lt;class &#39;pandas.core.series.Series&#39;&gt;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[0.43500, 0.33500, 0.11000, ..., 0.13550, 0.07750, 0.09650],
       [0.58500, 0.45000, 0.12500, ..., 0.35450, 0.20750, 0.22500],
       [0.65500, 0.51000, 0.16000, ..., 0.39600, 0.28250, 0.37000],
       ...,
       [0.53000, 0.42000, 0.13000, ..., 0.37450, 0.16700, 0.24900],
       [0.39500, 0.31500, 0.10500, ..., 0.11850, 0.09100, 0.11950],
       [0.45000, 0.35500, 0.12000, ..., 0.11450, 0.06650, 0.16000]])
</pre></div>
</div>
</div>
</div>
<p>Next make a regression model predict the age. Since there is only a single input tensor, a <code class="docutils literal notranslate"><span class="pre">keras.Sequential</span></code> model is sufficient here.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">abalone_model</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Sequential</span><span class="p">([</span>
  <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">64</span><span class="p">),</span>
  <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="p">])</span>

<span class="n">abalone_model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">loss</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">losses</span><span class="o">.</span><span class="n">MeanSquaredError</span><span class="p">(),</span>
                      <span class="n">optimizer</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">optimizers</span><span class="o">.</span><span class="n">Adam</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<p>To train that model, pass the features and labels to <code class="docutils literal notranslate"><span class="pre">Model.fit</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">abalone_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">abalone_features</span><span class="p">,</span> <span class="n">abalone_labels</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 1/10
104/104 [==============================] - 0s 567us/step - loss: 88.4131
Epoch 2/10
104/104 [==============================] - 0s 520us/step - loss: 16.5819
Epoch 3/10
104/104 [==============================] - 0s 523us/step - loss: 8.5056
Epoch 4/10
104/104 [==============================] - 0s 534us/step - loss: 7.7680
Epoch 5/10
104/104 [==============================] - 0s 510us/step - loss: 7.5117
Epoch 6/10
104/104 [==============================] - 0s 511us/step - loss: 6.8061
Epoch 7/10
104/104 [==============================] - 0s 527us/step - loss: 6.8201
Epoch 8/10
104/104 [==============================] - 0s 502us/step - loss: 6.7784
Epoch 9/10
104/104 [==============================] - 0s 511us/step - loss: 6.6292
Epoch 10/10
104/104 [==============================] - 0s 500us/step - loss: 7.1391
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;tensorflow.python.keras.callbacks.History at 0x1945aa8d0&gt;
</pre></div>
</div>
</div>
</div>
<p>You have just seen the most basic way to train a model using CSV data. Next, you will learn how to apply preprocessing to normalize numeric columns.</p>
</div>
<div class="section" id="basic-preprocessing">
<h2>Basic preprocessing<a class="headerlink" href="#basic-preprocessing" title="Permalink to this headline">¶</a></h2>
<p>It’s good practice to normalize the inputs to your model. The <code class="docutils literal notranslate"><span class="pre">experimental.preprocessing</span></code> layers provide a convenient way to build this normalization into your model.</p>
<p>The layer will precompute the mean and variance of each column, and use these to normalize the data.</p>
<blockquote>
<div><p>TF2 에서 권장하는 전처리를 모델 레이어에 포함하여 사용하는 방법을 보여줍니다.</p>
</div></blockquote>
<p>First you create the layer:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">normalize</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">experimental</span><span class="o">.</span><span class="n">preprocessing</span><span class="o">.</span><span class="n">Normalization</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Then you use the <code class="docutils literal notranslate"><span class="pre">Normalization.adapt()</span></code> method to adapt the normalization layer to your data.</p>
<p>Note: Only use your training data to <code class="docutils literal notranslate"><span class="pre">.adapt()</span></code> preprocessing layers. Do not use your validation or test data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">normalize</span><span class="o">.</span><span class="n">adapt</span><span class="p">(</span><span class="n">abalone_features</span><span class="p">)</span>

<span class="c1"># adapt 로 데이터를 전처리 레이어에 적용하고 나면 해당 데이터의 정보를 레이어가 가지고 있고 이를 기반으로 모델에서 데이터가 들어오면 전처리를 해줍니다.</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;preprocessing stat: mean=</span><span class="si">{</span><span class="n">normalize</span><span class="o">.</span><span class="n">mean</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>preprocessing stat: mean=[0.52269 0.40658 0.13927 0.82473 0.35770 0.18016 0.23792]
</pre></div>
</div>
</div>
</div>
<p>Then use the normalization layer in your model:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">norm_abalone_model</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Sequential</span><span class="p">([</span>
  <span class="n">normalize</span><span class="p">,</span>
  <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">64</span><span class="p">),</span>
  <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="p">])</span>

<span class="n">norm_abalone_model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">loss</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">losses</span><span class="o">.</span><span class="n">MeanSquaredError</span><span class="p">(),</span>
                           <span class="n">optimizer</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">optimizers</span><span class="o">.</span><span class="n">Adam</span><span class="p">())</span>

<span class="n">norm_abalone_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">abalone_features</span><span class="p">,</span> <span class="n">abalone_labels</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 1/10
104/104 [==============================] - 0s 548us/step - loss: 101.7134
Epoch 2/10
104/104 [==============================] - 0s 520us/step - loss: 66.9957
Epoch 3/10
104/104 [==============================] - 0s 512us/step - loss: 23.7168
Epoch 4/10
104/104 [==============================] - 0s 530us/step - loss: 6.3805
Epoch 5/10
104/104 [==============================] - 0s 538us/step - loss: 4.9331
Epoch 6/10
104/104 [==============================] - 0s 510us/step - loss: 4.7040
Epoch 7/10
104/104 [==============================] - 0s 516us/step - loss: 4.7777
Epoch 8/10
104/104 [==============================] - 0s 522us/step - loss: 5.1798
Epoch 9/10
104/104 [==============================] - 0s 519us/step - loss: 4.8763
Epoch 10/10
104/104 [==============================] - 0s 521us/step - loss: 5.4119
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;tensorflow.python.keras.callbacks.History at 0x195166890&gt;
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="mixed-data-types">
<h2>Mixed data types<a class="headerlink" href="#mixed-data-types" title="Permalink to this headline">¶</a></h2>
<p>The “Titanic” dataset contains information about the passengers on the Titanic. The nominal task on this dataset is to predict who survived.</p>
<p><img alt="The Titanic" src="https://www.tensorflow.org/tutorials/load_data/images/csv/Titanic.jpg" /></p>
<p>Image <a class="reference external" href="https://commons.wikimedia.org/wiki/File:RMS_Titanic_3.jpg">from Wikimedia</a></p>
<p>The raw data can easily be loaded as a Pandas <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>, but is not immediately usable as input to a TensorFlow model.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">titanic</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;https://storage.googleapis.com/tf-datasets/titanic/train.csv&quot;</span><span class="p">)</span>
<span class="n">titanic</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>survived</th>
      <th>sex</th>
      <th>age</th>
      <th>n_siblings_spouses</th>
      <th>parch</th>
      <th>fare</th>
      <th>class</th>
      <th>deck</th>
      <th>embark_town</th>
      <th>alone</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>male</td>
      <td>22.00000</td>
      <td>1</td>
      <td>0</td>
      <td>7.25000</td>
      <td>Third</td>
      <td>unknown</td>
      <td>Southampton</td>
      <td>n</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>female</td>
      <td>38.00000</td>
      <td>1</td>
      <td>0</td>
      <td>71.28330</td>
      <td>First</td>
      <td>C</td>
      <td>Cherbourg</td>
      <td>n</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1</td>
      <td>female</td>
      <td>26.00000</td>
      <td>0</td>
      <td>0</td>
      <td>7.92500</td>
      <td>Third</td>
      <td>unknown</td>
      <td>Southampton</td>
      <td>y</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1</td>
      <td>female</td>
      <td>35.00000</td>
      <td>1</td>
      <td>0</td>
      <td>53.10000</td>
      <td>First</td>
      <td>C</td>
      <td>Southampton</td>
      <td>n</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0</td>
      <td>male</td>
      <td>28.00000</td>
      <td>0</td>
      <td>0</td>
      <td>8.45830</td>
      <td>Third</td>
      <td>unknown</td>
      <td>Queenstown</td>
      <td>y</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<blockquote>
<div><p>데이터가 모두 숫자 형태인 경우는 간단하게 학습이 가능하지만 문자열(또는 Object)이 섞여 있을 경우 혼합된 데이터에 대한 전처리를 모델에서 지원하기 위해 난이도 있는 전처리 레이어를 작성해야 합니다.</p>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">titanic_features</span> <span class="o">=</span> <span class="n">titanic</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">titanic_labels</span> <span class="o">=</span> <span class="n">titanic_features</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;survived&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;dtypes: titanic_features=</span><span class="se">\n</span><span class="si">{</span><span class="n">titanic_features</span><span class="o">.</span><span class="n">dtypes</span><span class="si">}</span><span class="se">\n</span><span class="s2">titanic_labels=</span><span class="se">\n</span><span class="si">{</span><span class="n">titanic_labels</span><span class="o">.</span><span class="n">dtypes</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>dtypes: titanic_features=
sex                    object
age                   float64
n_siblings_spouses      int64
parch                   int64
fare                  float64
class                  object
deck                   object
embark_town            object
alone                  object
dtype: object
titanic_labels=
int64
</pre></div>
</div>
</div>
</div>
<p>Because of the different data types and ranges you can’t simply stack the features into  NumPy array and pass it to a <code class="docutils literal notranslate"><span class="pre">keras.Sequential</span></code> model. Each column needs to be handled individually.</p>
<p>As one option, you could preprocess your data offline (using any tool you like) to convert categorical columns to numeric columns, then pass the processed output to your TensorFlow model. The disadvantage to that approach is that if you save and export your model the preprocessing is not saved with it. The <code class="docutils literal notranslate"><span class="pre">experimental.preprocessing</span></code> layers avoid this problem because they’re part of the model.</p>
<p>In this example, you’ll build a model that implements the preprocessing logic using <a class="reference external" href="https://www.tensorflow.org/guide/keras/functional.ipynb">Keras functional API</a>. You could also do it by <a class="reference external" href="https://www.tensorflow.org/guide/keras/custom_layers_and_models">subclassing</a>.</p>
<p>The functional API operates on “symbolic” tensors. Normal “eager” tensors have a value. In contrast these “symbolic” tensors do not. Instead they keep track of which operations are run on them, and build representation of the calculation, that you can run later. Here’s a quick example:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create a symbolic input</span>
<span class="nb">input</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Input</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

<span class="c1"># Do a calculation using is</span>
<span class="n">result</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="nb">input</span> <span class="o">+</span> <span class="mi">1</span>

<span class="c1"># the result doesn&#39;t have a value</span>
<span class="n">result</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;KerasTensor: shape=(None,) dtype=float32 (created by layer &#39;tf.__operators__.add&#39;)&gt;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">calc</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="n">inputs</span><span class="o">=</span><span class="nb">input</span><span class="p">,</span> <span class="n">outputs</span><span class="o">=</span><span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">calc</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">numpy</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="n">calc</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">numpy</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>3.0
5.0
</pre></div>
</div>
</div>
</div>
<p>To build the preprocessing model, start by building a set of symbolic <code class="docutils literal notranslate"><span class="pre">keras.Input</span></code> objects, matching the names and data-types of the CSV columns.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">inputs</span> <span class="o">=</span> <span class="p">{}</span>

<span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">titanic_features</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">dtype</span> <span class="o">=</span> <span class="n">column</span><span class="o">.</span><span class="n">dtype</span>
    <span class="k">if</span> <span class="n">dtype</span> <span class="o">==</span> <span class="nb">object</span><span class="p">:</span>
        <span class="n">dtype</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">string</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">dtype</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">float32</span>

    <span class="n">inputs</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Input</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,),</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>

<span class="n">inputs</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;sex&#39;: &lt;KerasTensor: shape=(None, 1) dtype=string (created by layer &#39;sex&#39;)&gt;,
 &#39;age&#39;: &lt;KerasTensor: shape=(None, 1) dtype=float32 (created by layer &#39;age&#39;)&gt;,
 &#39;n_siblings_spouses&#39;: &lt;KerasTensor: shape=(None, 1) dtype=float32 (created by layer &#39;n_siblings_spouses&#39;)&gt;,
 &#39;parch&#39;: &lt;KerasTensor: shape=(None, 1) dtype=float32 (created by layer &#39;parch&#39;)&gt;,
 &#39;fare&#39;: &lt;KerasTensor: shape=(None, 1) dtype=float32 (created by layer &#39;fare&#39;)&gt;,
 &#39;class&#39;: &lt;KerasTensor: shape=(None, 1) dtype=string (created by layer &#39;class&#39;)&gt;,
 &#39;deck&#39;: &lt;KerasTensor: shape=(None, 1) dtype=string (created by layer &#39;deck&#39;)&gt;,
 &#39;embark_town&#39;: &lt;KerasTensor: shape=(None, 1) dtype=string (created by layer &#39;embark_town&#39;)&gt;,
 &#39;alone&#39;: &lt;KerasTensor: shape=(None, 1) dtype=string (created by layer &#39;alone&#39;)&gt;}
</pre></div>
</div>
</div>
</div>
<p>The first step in your preprocessing logic is to concatenate the numeric inputs together, and run them through a normalization layer:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">numeric_inputs</span> <span class="o">=</span> <span class="p">{</span><span class="n">name</span><span class="p">:</span><span class="nb">input</span> <span class="k">for</span> <span class="n">name</span><span class="p">,</span><span class="nb">input</span> <span class="ow">in</span> <span class="n">inputs</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                  <span class="k">if</span> <span class="nb">input</span><span class="o">.</span><span class="n">dtype</span><span class="o">==</span><span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">}</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;numeric_inputs: </span><span class="si">{</span><span class="n">numeric_inputs</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Concatenate</span><span class="p">()(</span><span class="nb">list</span><span class="p">(</span><span class="n">numeric_inputs</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
<span class="n">norm</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">experimental</span><span class="o">.</span><span class="n">preprocessing</span><span class="o">.</span><span class="n">Normalization</span><span class="p">()</span>
<span class="n">norm</span><span class="o">.</span><span class="n">adapt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">titanic</span><span class="p">[</span><span class="n">numeric_inputs</span><span class="o">.</span><span class="n">keys</span><span class="p">()]))</span>
<span class="n">all_numeric_inputs</span> <span class="o">=</span> <span class="n">norm</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;all_numeric_inputs: </span><span class="si">{</span><span class="n">all_numeric_inputs</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>numeric_inputs: {&#39;age&#39;: &lt;KerasTensor: shape=(None, 1) dtype=float32 (created by layer &#39;age&#39;)&gt;, &#39;n_siblings_spouses&#39;: &lt;KerasTensor: shape=(None, 1) dtype=float32 (created by layer &#39;n_siblings_spouses&#39;)&gt;, &#39;parch&#39;: &lt;KerasTensor: shape=(None, 1) dtype=float32 (created by layer &#39;parch&#39;)&gt;, &#39;fare&#39;: &lt;KerasTensor: shape=(None, 1) dtype=float32 (created by layer &#39;fare&#39;)&gt;}
all_numeric_inputs: KerasTensor(type_spec=TensorSpec(shape=(None, 4), dtype=tf.float32, name=None), name=&#39;normalization_1/truediv:0&#39;, description=&quot;created by layer &#39;normalization_1&#39;&quot;)
</pre></div>
</div>
</div>
</div>
<p>Collect all the symbolic preprocessing results, to concatenate them later.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">preprocessed_inputs</span> <span class="o">=</span> <span class="p">[</span><span class="n">all_numeric_inputs</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>For the string inputs use the <code class="docutils literal notranslate"><span class="pre">preprocessing.StringLookup</span></code> function to map from strings to integer indices in a vocabulary. Next, use <code class="docutils literal notranslate"><span class="pre">preprocessing.CategoryEncoding</span></code> to convert the indexes into <code class="docutils literal notranslate"><span class="pre">float32</span></code> data appropriate for the model.</p>
<p>The default settings for the <code class="docutils literal notranslate"><span class="pre">preprocessing.CategoryEncoding</span></code> layer create a one-hot vector for each input. A <code class="docutils literal notranslate"><span class="pre">layers.Embedding</span></code> would also work. See the <a class="reference external" href="https://www.tensorflow.org/guide/keras/preprocessing_layers#quick_recipes">preprocessing layers guide</a> and <a class="reference external" href="https://www.tensorflow.org/tutorials/structured_data/preprocessing_layers">tutorial</a> for more on this topic.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="nb">input</span> <span class="ow">in</span> <span class="n">inputs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="k">if</span> <span class="nb">input</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">:</span>
        <span class="k">continue</span>
  
    <span class="n">lookup</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">experimental</span><span class="o">.</span><span class="n">preprocessing</span><span class="o">.</span><span class="n">StringLookup</span><span class="p">(</span><span class="n">vocabulary</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">titanic_features</span><span class="p">[</span><span class="n">name</span><span class="p">]))</span>
    <span class="n">one_hot</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">experimental</span><span class="o">.</span><span class="n">preprocessing</span><span class="o">.</span><span class="n">CategoryEncoding</span><span class="p">(</span><span class="n">max_tokens</span><span class="o">=</span><span class="n">lookup</span><span class="o">.</span><span class="n">vocab_size</span><span class="p">())</span>

    <span class="n">x</span> <span class="o">=</span> <span class="n">lookup</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">one_hot</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">preprocessed_inputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>With the collection of <code class="docutils literal notranslate"><span class="pre">inputs</span></code> and <code class="docutils literal notranslate"><span class="pre">processed_inputs</span></code>, you can concatenate all the preprocessed inputs together, and build a model that handles the preprocessing:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">preprocessed_inputs_cat</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Concatenate</span><span class="p">()(</span><span class="n">preprocessed_inputs</span><span class="p">)</span>

<span class="n">titanic_preprocessing</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">preprocessed_inputs_cat</span><span class="p">)</span>

<span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">plot_model</span><span class="p">(</span><span class="n">model</span> <span class="o">=</span> <span class="n">titanic_preprocessing</span> <span class="p">,</span> <span class="n">to_file</span><span class="o">=</span><span class="s2">&quot;/tmp/model.png&quot;</span><span class="p">,</span> <span class="n">rankdir</span><span class="o">=</span><span class="s2">&quot;LR&quot;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">72</span><span class="p">,</span> <span class="n">show_shapes</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/tf2_beginner_csv_47_0.png" src="../../_images/tf2_beginner_csv_47_0.png" />
</div>
</div>
<p>This <code class="docutils literal notranslate"><span class="pre">model</span></code> just contains the input preprocessing. You can run it to see what it does to your data. Keras models don’t automatically convert Pandas <code class="docutils literal notranslate"><span class="pre">DataFrames</span></code> because it’s not clear if it should be converted to one tensor or to a dictionary of tensors. So convert it to a dictionary of tensors:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">titanic_features_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> 
                         <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">titanic_features</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
</pre></div>
</div>
</div>
</div>
<p>Slice out the first training example and pass it to this preprocessing model, you see the numeric features and string one-hots all concatenated together:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">features_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">name</span><span class="p">:</span><span class="n">values</span><span class="p">[:</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">titanic_features_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
<span class="n">titanic_preprocessing</span><span class="p">(</span><span class="n">features_dict</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;tf.Tensor: shape=(1, 33), dtype=float32, numpy=
array([[-0.61041, 0.39520, -0.47905, -0.49740, 0.00000, 0.00000, 0.00000,
        1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000,
        0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000,
        0.00000, 1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000,
        0.00000, 0.00000, 0.00000, 1.00000, 0.00000]], dtype=float32)&gt;
</pre></div>
</div>
</div>
</div>
<p>Now build the model on top of this:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">titanic_model</span><span class="p">(</span><span class="n">preprocessing_head</span><span class="p">,</span> <span class="n">inputs</span><span class="p">):</span>
    <span class="n">body</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Sequential</span><span class="p">([</span>
        <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">64</span><span class="p">),</span>
        <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="p">])</span>

    <span class="n">preprocessed_inputs</span> <span class="o">=</span> <span class="n">preprocessing_head</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">body</span><span class="p">(</span><span class="n">preprocessed_inputs</span><span class="p">)</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>

    <span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">losses</span><span class="o">.</span><span class="n">BinaryCrossentropy</span><span class="p">(</span><span class="n">from_logits</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
                <span class="n">optimizer</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">optimizers</span><span class="o">.</span><span class="n">Adam</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">model</span>

<span class="n">titanic_model</span> <span class="o">=</span> <span class="n">titanic_model</span><span class="p">(</span><span class="n">titanic_preprocessing</span><span class="p">,</span> <span class="n">inputs</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>When you train the model, pass the dictionary of features as <code class="docutils literal notranslate"><span class="pre">x</span></code>, and the label as <code class="docutils literal notranslate"><span class="pre">y</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">titanic_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">titanic_features_dict</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">titanic_labels</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 1/10
20/20 [==============================] - 0s 1ms/step - loss: 0.6529
Epoch 2/10
20/20 [==============================] - 0s 1ms/step - loss: 0.5334
Epoch 3/10
20/20 [==============================] - 0s 861us/step - loss: 0.4848
Epoch 4/10
20/20 [==============================] - 0s 903us/step - loss: 0.4608
Epoch 5/10
20/20 [==============================] - 0s 880us/step - loss: 0.4432
Epoch 6/10
20/20 [==============================] - 0s 917us/step - loss: 0.4100
Epoch 7/10
20/20 [==============================] - 0s 947us/step - loss: 0.4647
Epoch 8/10
20/20 [==============================] - 0s 905us/step - loss: 0.4254
Epoch 9/10
20/20 [==============================] - 0s 898us/step - loss: 0.4188
Epoch 10/10
20/20 [==============================] - 0s 928us/step - loss: 0.4680
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;tensorflow.python.keras.callbacks.History at 0x1952eb790&gt;
</pre></div>
</div>
</div>
</div>
<p>Since the preprocessing is part of the model, you can save the model and reload it somewhere else and get identical results:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">titanic_model</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s1">&#39;/tmp/test&#39;</span><span class="p">)</span>
<span class="n">reloaded</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">load_model</span><span class="p">(</span><span class="s1">&#39;/tmp/test&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:tensorflow:Assets written to: /tmp/test/assets
WARNING:tensorflow:5 out of the last 5 calls to &lt;function recreate_function.&lt;locals&gt;.restored_function_body at 0x194e96170&gt; triggered tf.function retracing. Tracing is expensive and the excessive number of tracings could be due to (1) creating @tf.function repeatedly in a loop, (2) passing tensors with different shapes, (3) passing Python objects instead of tensors. For (1), please define your @tf.function outside of the loop. For (2), @tf.function has experimental_relax_shapes=True option that relaxes argument shapes that can avoid unnecessary retracing. For (3), please refer to https://www.tensorflow.org/guide/function#controlling_retracing and https://www.tensorflow.org/api_docs/python/tf/function for  more details.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">features_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">name</span><span class="p">:</span><span class="n">values</span><span class="p">[:</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">titanic_features_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

<span class="n">before</span> <span class="o">=</span> <span class="n">titanic_model</span><span class="p">(</span><span class="n">features_dict</span><span class="p">)</span>
<span class="n">after</span> <span class="o">=</span> <span class="n">reloaded</span><span class="p">(</span><span class="n">features_dict</span><span class="p">)</span>
<span class="k">assert</span> <span class="p">(</span><span class="n">before</span><span class="o">-</span><span class="n">after</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">1e-3</span>
<span class="nb">print</span><span class="p">(</span><span class="n">before</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">after</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>tf.Tensor([[-1.84004]], shape=(1, 1), dtype=float32)
tf.Tensor([[-1.84004]], shape=(1, 1), dtype=float32)
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="using-tf-data">
<h2>Using tf.data<a class="headerlink" href="#using-tf-data" title="Permalink to this headline">¶</a></h2>
<p>In the previous section you relied on the model’s built-in data shuffling and batching while training the model.</p>
<p>If you need more control over the input data pipeline or need to use data that doesn’t easily fit into memory: use <code class="docutils literal notranslate"><span class="pre">tf.data</span></code>.</p>
<p>For more examples see the <span class="xref myst">tf.data guide</span>.</p>
<div class="section" id="on-in-memory-data">
<h3>On in memory data<a class="headerlink" href="#on-in-memory-data" title="Permalink to this headline">¶</a></h3>
<p>As a first example of applying <code class="docutils literal notranslate"><span class="pre">tf.data</span></code> to CSV data consider the following code to manually slice up the dictionary of features from the previous section. For each index, it takes that index for each feature:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">itertools</span>

<span class="k">def</span> <span class="nf">slices</span><span class="p">(</span><span class="n">features</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">count</span><span class="p">():</span>
        <span class="c1"># For each feature take index `i`</span>
        <span class="n">example</span> <span class="o">=</span> <span class="p">{</span><span class="n">name</span><span class="p">:</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">features</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        <span class="k">yield</span> <span class="n">example</span>
</pre></div>
</div>
</div>
</div>
<p>Run this and print the first example:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">example</span> <span class="ow">in</span> <span class="n">slices</span><span class="p">(</span><span class="n">titanic_features_dict</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">example</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">:</span><span class="s2">19s</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">break</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>sex                : male
age                : 22.0
n_siblings_spouses : 1
parch              : 0
fare               : 7.25
class              : Third
deck               : unknown
embark_town        : Southampton
alone              : n
</pre></div>
</div>
</div>
</div>
<p>The most basic <code class="docutils literal notranslate"><span class="pre">tf.data.Dataset</span></code> in memory data loader is the <code class="docutils literal notranslate"><span class="pre">Dataset.from_tensor_slices</span></code> constructor. This returns a <code class="docutils literal notranslate"><span class="pre">tf.data.Dataset</span></code> that implements a generalized version of the above <code class="docutils literal notranslate"><span class="pre">slices</span></code> function, in TensorFlow.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">features_ds</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">Dataset</span><span class="o">.</span><span class="n">from_tensor_slices</span><span class="p">(</span><span class="n">titanic_features_dict</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>You can iterate over a <code class="docutils literal notranslate"><span class="pre">tf.data.Dataset</span></code> like any other python iterable:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">example</span> <span class="ow">in</span> <span class="n">features_ds</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">example</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">:</span><span class="s2">19s</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">break</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>sex                : b&#39;male&#39;
age                : 22.0
n_siblings_spouses : 1
parch              : 0
fare               : 7.25
class              : b&#39;Third&#39;
deck               : b&#39;unknown&#39;
embark_town        : b&#39;Southampton&#39;
alone              : b&#39;n&#39;
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">from_tensor_slices</span></code> function can handle any structure of nested dictionaries or tuples. The following code makes a dataset of <code class="docutils literal notranslate"><span class="pre">(features_dict,</span> <span class="pre">labels)</span></code> pairs:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">titanic_ds</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">Dataset</span><span class="o">.</span><span class="n">from_tensor_slices</span><span class="p">((</span><span class="n">titanic_features_dict</span><span class="p">,</span> <span class="n">titanic_labels</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>To train a model using this <code class="docutils literal notranslate"><span class="pre">Dataset</span></code>, you’ll need to at least <code class="docutils literal notranslate"><span class="pre">shuffle</span></code> and <code class="docutils literal notranslate"><span class="pre">batch</span></code> the data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">titanic_batches</span> <span class="o">=</span> <span class="n">titanic_ds</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">titanic_labels</span><span class="p">))</span><span class="o">.</span><span class="n">batch</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Instead of passing <code class="docutils literal notranslate"><span class="pre">features</span></code> and <code class="docutils literal notranslate"><span class="pre">labels</span></code> to <code class="docutils literal notranslate"><span class="pre">Model.fit</span></code>, you pass the dataset:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">titanic_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">titanic_batches</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 1/5
20/20 [==============================] - 0s 2ms/step - loss: 0.4207
Epoch 2/5
20/20 [==============================] - 0s 2ms/step - loss: 0.4202
Epoch 3/5
20/20 [==============================] - 0s 2ms/step - loss: 0.4199
Epoch 4/5
20/20 [==============================] - 0s 2ms/step - loss: 0.4206
Epoch 5/5
20/20 [==============================] - 0s 2ms/step - loss: 0.4203
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;tensorflow.python.keras.callbacks.History at 0x194e0ccd0&gt;
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="from-a-single-file">
<h3>From a single file<a class="headerlink" href="#from-a-single-file" title="Permalink to this headline">¶</a></h3>
<p>So far this tutorial has worked with in-memory data. <code class="docutils literal notranslate"><span class="pre">tf.data</span></code> is a highly scalable toolkit for building data pipelines, and provides a few functions for dealing loading CSV files.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">titanic_file_path</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">get_file</span><span class="p">(</span><span class="s2">&quot;/tmp/train.csv&quot;</span><span class="p">,</span> <span class="s2">&quot;https://storage.googleapis.com/tf-datasets/titanic/train.csv&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now read the CSV data from the file and create a <code class="docutils literal notranslate"><span class="pre">tf.data.Dataset</span></code>.</p>
<p>(For the full documentation, see <code class="docutils literal notranslate"><span class="pre">tf.data.experimental.make_csv_dataset</span></code>)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">titanic_csv_ds</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">experimental</span><span class="o">.</span><span class="n">make_csv_dataset</span><span class="p">(</span>
    <span class="n">titanic_file_path</span><span class="p">,</span>
    <span class="n">batch_size</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="c1"># Artificially small to make examples easier to show.</span>
    <span class="n">label_name</span><span class="o">=</span><span class="s1">&#39;survived&#39;</span><span class="p">,</span>
    <span class="n">num_epochs</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">ignore_errors</span><span class="o">=</span><span class="kc">True</span><span class="p">,)</span>
</pre></div>
</div>
</div>
</div>
<p>This function includes many convenient features so the data is easy to work with. This includes:</p>
<ul class="simple">
<li><p>Using the column headers as dictionary keys.</p></li>
<li><p>Automatically determining the type of each column.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">batch</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">titanic_csv_ds</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">batch</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">:</span><span class="s2">20s</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;label&#39;</span><span class="si">:</span><span class="s2">20s</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>sex                 : [b&#39;male&#39; b&#39;male&#39; b&#39;male&#39; b&#39;male&#39; b&#39;male&#39;]
age                 : [28.00000 15.00000 28.00000 23.00000 31.00000]
n_siblings_spouses  : [0 1 1 0 0]
parch               : [0 1 0 0 0]
fare                : [8.05000 7.22920 24.15000 15.04580 13.00000]
class               : [b&#39;Third&#39; b&#39;Third&#39; b&#39;Third&#39; b&#39;Second&#39; b&#39;Second&#39;]
deck                : [b&#39;unknown&#39; b&#39;unknown&#39; b&#39;unknown&#39; b&#39;unknown&#39; b&#39;unknown&#39;]
embark_town         : [b&#39;Southampton&#39; b&#39;Cherbourg&#39; b&#39;Queenstown&#39; b&#39;Cherbourg&#39; b&#39;Southampton&#39;]
alone               : [b&#39;y&#39; b&#39;n&#39; b&#39;n&#39; b&#39;y&#39; b&#39;y&#39;]

label               : [0 0 0 0 1]
</pre></div>
</div>
</div>
</div>
<p>Note: if you run the above cell twice it will produce different results. The default settings for <code class="docutils literal notranslate"><span class="pre">make_csv_dataset</span></code> include <code class="docutils literal notranslate"><span class="pre">shuffle_buffer_size=1000</span></code>, which is more than sufficient for this small dataset, but may not be for a real-world dataset.</p>
<p>It can also decompress the data on the fly. Here’s a gzipped CSV file containing the <a class="reference external" href="https://archive.ics.uci.edu/ml/datasets/Metro+Interstate+Traffic+Volume">metro interstate traffic dataset</a></p>
<p><img alt="A traffic jam." src="https://www.tensorflow.org/tutorials/load_data/images/csv/traffic.jpg" /></p>
<p>Image <a class="reference external" href="https://commons.wikimedia.org/wiki/File:Trafficjam.jpg">from Wikimedia</a></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">traffic_volume_csv_gz</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">get_file</span><span class="p">(</span>
    <span class="s1">&#39;Metro_Interstate_Traffic_Volume.csv.gz&#39;</span><span class="p">,</span> 
    <span class="s2">&quot;https://archive.ics.uci.edu/ml/machine-learning-databases/00492/Metro_Interstate_Traffic_Volume.csv.gz&quot;</span><span class="p">,</span>
    <span class="n">cache_dir</span><span class="o">=</span><span class="s1">&#39;/tmp&#39;</span><span class="p">,</span> <span class="n">cache_subdir</span><span class="o">=</span><span class="s1">&#39;traffic&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Set the <code class="docutils literal notranslate"><span class="pre">compression_type</span></code> argument to read directly from the compressed file:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">traffic_volume_csv_gz_ds</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">experimental</span><span class="o">.</span><span class="n">make_csv_dataset</span><span class="p">(</span>
    <span class="n">traffic_volume_csv_gz</span><span class="p">,</span>
    <span class="n">batch_size</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span>
    <span class="n">label_name</span><span class="o">=</span><span class="s1">&#39;traffic_volume&#39;</span><span class="p">,</span>
    <span class="n">num_epochs</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">compression_type</span><span class="o">=</span><span class="s2">&quot;GZIP&quot;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">batch</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">traffic_volume_csv_gz_ds</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">batch</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">:</span><span class="s2">20s</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">value</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;label&#39;</span><span class="si">:</span><span class="s2">20s</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">label</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>holiday             : [b&#39;None&#39; b&#39;None&#39; b&#39;None&#39; b&#39;None&#39; b&#39;None&#39;]
temp                : [262.42001 263.87000 292.95001 279.35999 293.28000]
rain_1h             : [0.00000 0.00000 0.00000 0.00000 0.00000]
snow_1h             : [0.00000 0.00000 0.00000 0.00000 0.00000]
clouds_all          : [ 1 40 12  1 80]
weather_main        : [b&#39;Clear&#39; b&#39;Snow&#39; b&#39;Clouds&#39; b&#39;Clear&#39; b&#39;Rain&#39;]
weather_description : [b&#39;sky is clear&#39; b&#39;heavy snow&#39; b&#39;few clouds&#39; b&#39;sky is clear&#39; b&#39;light rain&#39;]
date_time           : [b&#39;2013-03-03 01:00:00&#39; b&#39;2012-12-30 15:00:00&#39; b&#39;2013-07-29 14:00:00&#39;
 b&#39;2013-03-29 18:00:00&#39; b&#39;2013-07-23 06:00:00&#39;]

label               : [ 795 3717 5356 4520 5971]
</pre></div>
</div>
</div>
</div>
<p>Note: If you need to parse those date-time strings in the <code class="docutils literal notranslate"><span class="pre">tf.data</span></code> pipeline you can use <code class="docutils literal notranslate"><span class="pre">tfa.text.parse_time</span></code>.</p>
</div>
<div class="section" id="caching">
<h3>Caching<a class="headerlink" href="#caching" title="Permalink to this headline">¶</a></h3>
<p>There is some overhead to parsing the csv data. For small models this can be the bottleneck in training.</p>
<p>Depending on your use case it may be a good idea to use <code class="docutils literal notranslate"><span class="pre">Dataset.cache</span></code> or <code class="docutils literal notranslate"><span class="pre">data.experimental.snapshot</span></code> so that the csv data is only parsed on the first epoch.</p>
<p>The main difference between the <code class="docutils literal notranslate"><span class="pre">cache</span></code> and <code class="docutils literal notranslate"><span class="pre">snapshot</span></code> methods is that <code class="docutils literal notranslate"><span class="pre">cache</span></code> files can only be used by the TensorFlow process that created them, but <code class="docutils literal notranslate"><span class="pre">snapshot</span></code> files can be read by other processes.</p>
<p>For example, iterating over the <code class="docutils literal notranslate"><span class="pre">traffic_volume_csv_gz_ds</span></code> 20 times, takes ~15 seconds without caching, or ~2s with caching.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">batch</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">traffic_volume_csv_gz_ds</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">20</span><span class="p">)):</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">40</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>...............................................................................................
CPU times: user 10.1 s, sys: 2.35 s, total: 12.5 s
Wall time: 8.4 s
</pre></div>
</div>
</div>
</div>
<p>Note: <code class="docutils literal notranslate"><span class="pre">Dataset.cache</span></code>  stores the data form the first epoch and replays it in order. So using <code class="docutils literal notranslate"><span class="pre">.cache</span></code> disables any shuffles earlier in the pipeline. Below the <code class="docutils literal notranslate"><span class="pre">.shuffle</span></code> is added back in after <code class="docutils literal notranslate"><span class="pre">.cache</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="n">caching</span> <span class="o">=</span> <span class="n">traffic_volume_csv_gz_ds</span><span class="o">.</span><span class="n">cache</span><span class="p">()</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">batch</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">caching</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">20</span><span class="p">)):</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">40</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>...............................................................................................
CPU times: user 1.18 s, sys: 162 ms, total: 1.34 s
Wall time: 1.14 s
</pre></div>
</div>
</div>
</div>
<p>Note: <code class="docutils literal notranslate"><span class="pre">snapshot</span></code> files are meant for <em>temporary</em> storage of a dataset while in use. This is <em>not</em> a format for long term storage. The file format is considered an internal detail, and not guaranteed between TensorFlow versions.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="n">snapshot</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">experimental</span><span class="o">.</span><span class="n">snapshot</span><span class="p">(</span><span class="s1">&#39;/tmp/titanic.tfsnap&#39;</span><span class="p">)</span>
<span class="n">snapshotting</span> <span class="o">=</span> <span class="n">traffic_volume_csv_gz_ds</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">snapshot</span><span class="p">)</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">batch</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">snapshotting</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">20</span><span class="p">)):</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">40</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>...............................................................................................
CPU times: user 1.72 s, sys: 352 ms, total: 2.07 s
Wall time: 1.46 s
</pre></div>
</div>
</div>
</div>
<p>If your data loading is slowed by loading csv files, and <code class="docutils literal notranslate"><span class="pre">cache</span></code> and <code class="docutils literal notranslate"><span class="pre">snapshot</span></code> are insufficient for your use case, consider re-encoding your data into a more streamlined format.</p>
</div>
<div class="section" id="multiple-files">
<h3>Multiple files<a class="headerlink" href="#multiple-files" title="Permalink to this headline">¶</a></h3>
<p>All the examples so far in this section could easily be done without <code class="docutils literal notranslate"><span class="pre">tf.data</span></code>. One place where <code class="docutils literal notranslate"><span class="pre">tf.data</span></code> can really simplify things is when dealing with collections of files.</p>
<p>For example, the <a class="reference external" href="https://archive.ics.uci.edu/ml/datasets/Character+Font+Images">character font images</a> dataset is distributed as a collection of csv files, one per font.</p>
<p><img alt="Fonts" src="https://www.tensorflow.org/tutorials/load_data/images/csv/fonts.jpg" /></p>
<p>Image by <a href="https://pixabay.com/users/wilhei-883152/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=705667">Willi Heidelbach</a> from <a href="https://pixabay.com/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=705667">Pixabay</a></p>
<p>Download the dataset, and have a look at the files inside:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fonts_zip</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">get_file</span><span class="p">(</span>
    <span class="s1">&#39;fonts.zip&#39;</span><span class="p">,</span>  <span class="s2">&quot;https://archive.ics.uci.edu/ml/machine-learning-databases/00417/fonts.zip&quot;</span><span class="p">,</span>
    <span class="n">cache_dir</span><span class="o">=</span><span class="s1">&#39;/tmp&#39;</span><span class="p">,</span> <span class="n">cache_subdir</span><span class="o">=</span><span class="s1">&#39;fonts&#39;</span><span class="p">,</span>
    <span class="n">extract</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pathlib</span>
<span class="n">font_csvs</span> <span class="o">=</span>  <span class="nb">sorted</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="s1">&#39;/tmp/fonts&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;*.csv&quot;</span><span class="p">))</span>

<span class="n">font_csvs</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;/tmp/fonts/AGENCY.csv&#39;,
 &#39;/tmp/fonts/ARIAL.csv&#39;,
 &#39;/tmp/fonts/BAITI.csv&#39;,
 &#39;/tmp/fonts/BANKGOTHIC.csv&#39;,
 &#39;/tmp/fonts/BASKERVILLE.csv&#39;,
 &#39;/tmp/fonts/BAUHAUS.csv&#39;,
 &#39;/tmp/fonts/BELL.csv&#39;,
 &#39;/tmp/fonts/BERLIN.csv&#39;,
 &#39;/tmp/fonts/BERNARD.csv&#39;,
 &#39;/tmp/fonts/BITSTREAMVERA.csv&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">font_csvs</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>153
</pre></div>
</div>
</div>
</div>
<p>When dealing with a bunch of files you can pass a glob-style <code class="docutils literal notranslate"><span class="pre">file_pattern</span></code> to the <code class="docutils literal notranslate"><span class="pre">experimental.make_csv_dataset</span></code> function. The order of the files is shuffled each iteration.</p>
<p>Use the <code class="docutils literal notranslate"><span class="pre">num_parallel_reads</span></code> argument to set how many files are read in parallel and interleaved together.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fonts_ds</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">experimental</span><span class="o">.</span><span class="n">make_csv_dataset</span><span class="p">(</span>
    <span class="n">file_pattern</span> <span class="o">=</span> <span class="s2">&quot;/tmp/fonts/*.csv&quot;</span><span class="p">,</span>
    <span class="n">batch_size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">num_epochs</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">num_parallel_reads</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
    <span class="n">shuffle_buffer_size</span><span class="o">=</span><span class="mi">10000</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>These csv files have the images flattened out into a single row. The column names are formatted <code class="docutils literal notranslate"><span class="pre">r{row}c{column}</span></code>. Here’s the first batch:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">features</span> <span class="ow">in</span> <span class="n">fonts_ds</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">features</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
        <span class="k">if</span> <span class="n">i</span><span class="o">&gt;</span><span class="mi">15</span><span class="p">:</span>
            <span class="k">break</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">:</span><span class="s2">20s</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;...&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[total: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">features</span><span class="p">)</span><span class="si">}</span><span class="s2"> features]&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>font                : [b&#39;FRANKLIN&#39; b&#39;FRANKLIN&#39; b&#39;ERAS&#39; b&#39;SIMPLEX&#39; b&#39;FRENCH&#39; b&#39;CURLZ&#39; b&#39;MISTRAL&#39;
 b&#39;FOOTLIGHT&#39; b&#39;CORBEL&#39; b&#39;CURLZ&#39;]
fontVariant         : [b&#39;FRANKLIN GOTHIC MEDIUM COND&#39; b&#39;FRANKLIN GOTHIC MEDIUM COND&#39;
 b&#39;ERAS MEDIUM ITC&#39; b&#39;SIMPLEX&#39; b&#39;FRENCH SCRIPT MT&#39; b&#39;CURLZ MT&#39; b&#39;MISTRAL&#39;
 b&#39;FOOTLIGHT MT LIGHT&#39; b&#39;CORBEL&#39; b&#39;CURLZ MT&#39;]
m_label             : [  268  1039    59   124    61   189 64258    73   926   381]
strength            : [0.40000 0.40000 0.40000 0.40000 0.40000 0.40000 0.40000 0.40000 0.40000
 0.40000]
italic              : [0 0 0 0 1 0 0 0 0 0]
orientation         : [0.00000 0.00000 0.00000 0.00000 0.00000 0.00000 0.00000 0.00000 0.00000
 0.00000]
m_top               : [27 39 47 29 53 44 31 35 40 33]
m_left              : [23 24 21 29 26 22 19 22 23 22]
originalH           : [58 55 40 75 16 48 67 42 44 56]
originalW           : [30 28 11  1 38 40 36 16 32 33]
h                   : [20 20 20 20 20 20 20 20 20 20]
w                   : [20 20 20 20 20 20 20 20 20 20]
r0c0                : [  1 255   1 255   1 128   1 243  96   1]
r0c1                : [  1 255   1 255   1 160   1 243 255   1]
r0c2                : [ 30 255   1 255   1  22   1 243 255   1]
r0c3                : [147 255   1 255 215  43   1 246 255   1]
...
[total: 412 features]
</pre></div>
</div>
</div>
</div>
<div class="section" id="optional-packing-fields">
<h4>Optional: Packing fields<a class="headerlink" href="#optional-packing-fields" title="Permalink to this headline">¶</a></h4>
<p>You probably don’t want to work with each pixel in separate columns like this. Before trying to use this dataset be sure to pack the pixels into an image-tensor.</p>
<p>Here is code that parses the column names to build images for each example:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">re</span>

<span class="k">def</span> <span class="nf">make_images</span><span class="p">(</span><span class="n">features</span><span class="p">):</span>
    <span class="n">image</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span><span class="o">*</span><span class="mi">400</span>
    <span class="n">new_feats</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">features</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s1">&#39;r(\d+)c(\d+)&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
            <span class="n">image</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="o">*</span><span class="mi">20</span><span class="o">+</span><span class="nb">int</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">))]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">new_feats</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

    <span class="n">image</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">image</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">new_feats</span><span class="p">[</span><span class="s1">&#39;image&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">image</span>

    <span class="k">return</span> <span class="n">new_feats</span>
</pre></div>
</div>
</div>
</div>
<p>Apply that function to each batch in the dataset:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fonts_image_ds</span> <span class="o">=</span> <span class="n">fonts_ds</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">make_images</span><span class="p">)</span>

<span class="k">for</span> <span class="n">features</span> <span class="ow">in</span> <span class="n">fonts_image_ds</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span>
    <span class="k">break</span>
</pre></div>
</div>
</div>
</div>
<p>Plot the resulting images:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">120</span><span class="p">)</span>

<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">9</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">features</span><span class="p">[</span><span class="s1">&#39;image&#39;</span><span class="p">][</span><span class="o">...</span><span class="p">,</span> <span class="n">n</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="n">features</span><span class="p">[</span><span class="s1">&#39;m_label&#39;</span><span class="p">][</span><span class="n">n</span><span class="p">]))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/tf2_beginner_csv_109_0.png" src="../../_images/tf2_beginner_csv_109_0.png" />
</div>
</div>
</div>
</div>
</div>
<div class="section" id="lower-level-functions">
<h2>Lower level functions<a class="headerlink" href="#lower-level-functions" title="Permalink to this headline">¶</a></h2>
<p>So far this tutorial has focused on the highest level utilities for reading csv data. There are other two APIs that may be helpful for advanced users if your use-case doesn’t fit the basic patterns.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">tf.io.decode_csv</span></code> - a function for parsing lines of text into a list of CSV column tensors.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tf.data.experimental.CsvDataset</span></code> - a lower level csv dataset constructor.</p></li>
</ul>
<p>This section recreates functionality provided by <code class="docutils literal notranslate"><span class="pre">make_csv_dataset</span></code>, to demonstrate how this lower level functionality can be used.</p>
<div class="section" id="tf-io-decode-csv">
<h3><code class="docutils literal notranslate"><span class="pre">tf.io.decode_csv</span></code><a class="headerlink" href="#tf-io-decode-csv" title="Permalink to this headline">¶</a></h3>
<p>This function decodes a string, or list of strings into a list of columns.</p>
<p>Unlike <code class="docutils literal notranslate"><span class="pre">make_csv_dataset</span></code> this function does not try to guess column data-types. You specify the column types by providing a list of <code class="docutils literal notranslate"><span class="pre">record_defaults</span></code> containing a value of the correct type, for each column.</p>
<p>To read the Titanic data <strong>as strings</strong> using <code class="docutils literal notranslate"><span class="pre">decode_csv</span></code> you would say:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">text</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">titanic_file_path</span><span class="p">)</span><span class="o">.</span><span class="n">read_text</span><span class="p">()</span>
<span class="n">lines</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

<span class="n">all_strings</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">()]</span><span class="o">*</span><span class="mi">10</span>
<span class="n">all_strings</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;&#39;, &#39;&#39;, &#39;&#39;, &#39;&#39;, &#39;&#39;, &#39;&#39;, &#39;&#39;, &#39;&#39;, &#39;&#39;, &#39;&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">features</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">decode_csv</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">record_defaults</span><span class="o">=</span><span class="n">all_strings</span><span class="p">)</span> 

<span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">features</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;type: </span><span class="si">{</span><span class="n">f</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">, shape: </span><span class="si">{</span><span class="n">f</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>type: string, shape: (627,)
type: string, shape: (627,)
type: string, shape: (627,)
type: string, shape: (627,)
type: string, shape: (627,)
type: string, shape: (627,)
type: string, shape: (627,)
type: string, shape: (627,)
type: string, shape: (627,)
type: string, shape: (627,)
</pre></div>
</div>
</div>
</div>
<p>To parse them with their actual types, create a list of <code class="docutils literal notranslate"><span class="pre">record_defaults</span></code> of the corresponding types:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0,male,22.0,1,0,7.25,Third,unknown,Southampton,n
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">titanic_types</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(),</span> <span class="nb">str</span><span class="p">(),</span> <span class="nb">float</span><span class="p">(),</span> <span class="nb">int</span><span class="p">(),</span> <span class="nb">int</span><span class="p">(),</span> <span class="nb">float</span><span class="p">(),</span> <span class="nb">str</span><span class="p">(),</span> <span class="nb">str</span><span class="p">(),</span> <span class="nb">str</span><span class="p">(),</span> <span class="nb">str</span><span class="p">()]</span>
<span class="n">titanic_types</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[0, &#39;&#39;, 0.0, 0, 0, 0.0, &#39;&#39;, &#39;&#39;, &#39;&#39;, &#39;&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">features</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">decode_csv</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">record_defaults</span><span class="o">=</span><span class="n">titanic_types</span><span class="p">)</span> 

<span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">features</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;type: </span><span class="si">{</span><span class="n">f</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">, shape: </span><span class="si">{</span><span class="n">f</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>type: int32, shape: (627,)
type: string, shape: (627,)
type: float32, shape: (627,)
type: int32, shape: (627,)
type: int32, shape: (627,)
type: float32, shape: (627,)
type: string, shape: (627,)
type: string, shape: (627,)
type: string, shape: (627,)
type: string, shape: (627,)
</pre></div>
</div>
</div>
</div>
<p>Note: it is more efficient to call <code class="docutils literal notranslate"><span class="pre">decode_csv</span></code> on large batches of lines than on individual lines of csv text.</p>
</div>
<div class="section" id="tf-data-experimental-csvdataset">
<h3><code class="docutils literal notranslate"><span class="pre">tf.data.experimental.CsvDataset</span></code><a class="headerlink" href="#tf-data-experimental-csvdataset" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">tf.data.experimental.CsvDataset</span></code> class provides a minimal CSV <code class="docutils literal notranslate"><span class="pre">Dataset</span></code> interface without the convenience features of the <code class="docutils literal notranslate"><span class="pre">make_csv_dataset</span></code> function: column header parsing, column type-inference, automatic shuffling, file interleaving.</p>
<p>This constructor follows uses <code class="docutils literal notranslate"><span class="pre">record_defaults</span></code> the same way as <code class="docutils literal notranslate"><span class="pre">io.parse_csv</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">simple_titanic</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">experimental</span><span class="o">.</span><span class="n">CsvDataset</span><span class="p">(</span><span class="n">titanic_file_path</span><span class="p">,</span> <span class="n">record_defaults</span><span class="o">=</span><span class="n">titanic_types</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="k">for</span> <span class="n">example</span> <span class="ow">in</span> <span class="n">simple_titanic</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">([</span><span class="n">e</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">example</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[0, b&#39;male&#39;, 22.0, 1, 0, 7.25, b&#39;Third&#39;, b&#39;unknown&#39;, b&#39;Southampton&#39;, b&#39;n&#39;]
</pre></div>
</div>
</div>
</div>
<p>The above code is basically equivalent to:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">decode_titanic_line</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">tf</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">decode_csv</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">titanic_types</span><span class="p">)</span>

<span class="n">manual_titanic</span> <span class="o">=</span> <span class="p">(</span>
    <span class="c1"># Load the lines of text</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">TextLineDataset</span><span class="p">(</span><span class="n">titanic_file_path</span><span class="p">)</span>
    <span class="c1"># Skip the header row.</span>
    <span class="o">.</span><span class="n">skip</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="c1"># Decode the line.</span>
    <span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">decode_titanic_line</span><span class="p">)</span>
<span class="p">)</span>

<span class="k">for</span> <span class="n">example</span> <span class="ow">in</span> <span class="n">manual_titanic</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">([</span><span class="n">e</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">example</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[0, b&#39;male&#39;, 22.0, 1, 0, 7.25, b&#39;Third&#39;, b&#39;unknown&#39;, b&#39;Southampton&#39;, b&#39;n&#39;]
</pre></div>
</div>
</div>
</div>
<div class="section" id="id1">
<h4>Multiple files<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h4>
<p>To parse the fonts dataset using <code class="docutils literal notranslate"><span class="pre">experimental.CsvDataset</span></code>, you first need to determine the column types for the <code class="docutils literal notranslate"><span class="pre">record_defaults</span></code>. Start by inspecting the first row of one file:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">font_line</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">font_csvs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">read_text</span><span class="p">()</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">font_line</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>AGENCY,AGENCY FB,64258,0.400000,0,0.000000,35,21,51,22,20,20,1,1,1,21,101,210,255,255,255,255,255,255,255,255,255,255,255,255,255,255,1,1,1,93,255,255,255,176,146,146,146,146,146,146,146,146,216,255,255,255,1,1,1,93,255,255,255,70,1,1,1,1,1,1,1,1,163,255,255,255,1,1,1,93,255,255,255,70,1,1,1,1,1,1,1,1,163,255,255,255,1,1,1,93,255,255,255,70,1,1,1,1,1,1,1,1,163,255,255,255,1,1,1,93,255,255,255,70,1,1,1,1,1,1,1,1,163,255,255,255,1,1,1,93,255,255,255,70,1,1,1,1,1,1,1,1,163,255,255,255,141,141,141,182,255,255,255,172,141,141,141,115,1,1,1,1,163,255,255,255,255,255,255,255,255,255,255,255,255,255,255,209,1,1,1,1,163,255,255,255,6,6,6,96,255,255,255,74,6,6,6,5,1,1,1,1,163,255,255,255,1,1,1,93,255,255,255,70,1,1,1,1,1,1,1,1,163,255,255,255,1,1,1,93,255,255,255,70,1,1,1,1,1,1,1,1,163,255,255,255,1,1,1,93,255,255,255,70,1,1,1,1,1,1,1,1,163,255,255,255,1,1,1,93,255,255,255,70,1,1,1,1,1,1,1,1,163,255,255,255,1,1,1,93,255,255,255,70,1,1,1,1,1,1,1,1,163,255,255,255,1,1,1,93,255,255,255,70,1,1,1,1,1,1,1,1,163,255,255,255,1,1,1,93,255,255,255,70,1,1,1,1,1,1,1,1,163,255,255,255,1,1,1,93,255,255,255,70,1,1,1,1,1,1,1,1,163,255,255,255,1,1,1,93,255,255,255,70,1,1,1,1,1,1,1,1,163,255,255,255,1,1,1,93,255,255,255,70,1,1,1,1,1,1,1,1,163,255,255,255
</pre></div>
</div>
</div>
</div>
<p>Only the first two fields are strings, the rest are ints or floats, and you can get the total number of features by counting the commas:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">num_font_features</span> <span class="o">=</span> <span class="n">font_line</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span>
<span class="n">font_column_types</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(),</span> <span class="nb">str</span><span class="p">()]</span> <span class="o">+</span> <span class="p">[</span><span class="nb">float</span><span class="p">()]</span><span class="o">*</span><span class="p">(</span><span class="n">num_font_features</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">CsvDatasaet</span></code> constructor can take a list of input files, but reads them sequentially. The first file in the list of CSVs is <code class="docutils literal notranslate"><span class="pre">AGENCY.csv</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">font_csvs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;/tmp/fonts/AGENCY.csv&#39;
</pre></div>
</div>
</div>
</div>
<p>So when you pass pass the list of files to <code class="docutils literal notranslate"><span class="pre">CsvDataaset</span></code> the records from <code class="docutils literal notranslate"><span class="pre">AGENCY.csv</span></code> are read first:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">simple_font_ds</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">experimental</span><span class="o">.</span><span class="n">CsvDataset</span><span class="p">(</span>
    <span class="n">font_csvs</span><span class="p">,</span> 
    <span class="n">record_defaults</span><span class="o">=</span><span class="n">font_column_types</span><span class="p">,</span> 
    <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">simple_font_ds</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">numpy</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>b&#39;AGENCY&#39;
b&#39;AGENCY&#39;
b&#39;AGENCY&#39;
b&#39;AGENCY&#39;
b&#39;AGENCY&#39;
b&#39;AGENCY&#39;
b&#39;AGENCY&#39;
b&#39;AGENCY&#39;
b&#39;AGENCY&#39;
b&#39;AGENCY&#39;
</pre></div>
</div>
</div>
</div>
<p>To interleave multiple files, use <code class="docutils literal notranslate"><span class="pre">Dataset.interleave</span></code>.</p>
<p>Here’s an initial dataset that contains the csv file names:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">font_files</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">Dataset</span><span class="o">.</span><span class="n">list_files</span><span class="p">(</span><span class="s2">&quot;/tmp/fonts/*.csv&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>This shuffles the file names each epoch:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Epoch 1:&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">font_files</span><span class="p">)[:</span><span class="mi">5</span><span class="p">]:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    &quot;</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">numpy</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;    ...&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Epoch 2:&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">font_files</span><span class="p">)[:</span><span class="mi">5</span><span class="p">]:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    &quot;</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">numpy</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;    ...&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 1:
     b&#39;/tmp/fonts/HARRINGTON.csv&#39;
     b&#39;/tmp/fonts/PALACE.csv&#39;
     b&#39;/tmp/fonts/HIMALAYA.csv&#39;
     b&#39;/tmp/fonts/BLACKADDER.csv&#39;
     b&#39;/tmp/fonts/PROXY.csv&#39;
    ...

Epoch 2:
     b&#39;/tmp/fonts/VINETA.csv&#39;
     b&#39;/tmp/fonts/TIMES.csv&#39;
     b&#39;/tmp/fonts/CONSTANTIA.csv&#39;
     b&#39;/tmp/fonts/RAGE.csv&#39;
     b&#39;/tmp/fonts/TREBUCHET.csv&#39;
    ...
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">interleave</span></code> method takes a <code class="docutils literal notranslate"><span class="pre">map_func</span></code> that creates a child-<code class="docutils literal notranslate"><span class="pre">Dataset</span></code> for each element of the parent-<code class="docutils literal notranslate"><span class="pre">Dataset</span></code>.</p>
<p>Here, you want to create a <code class="docutils literal notranslate"><span class="pre">CsvDataset</span></code> from each element of the dataset of files:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">make_font_csv_ds</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">tf</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">experimental</span><span class="o">.</span><span class="n">CsvDataset</span><span class="p">(</span>
        <span class="n">path</span><span class="p">,</span> 
        <span class="n">record_defaults</span><span class="o">=</span><span class="n">font_column_types</span><span class="p">,</span> 
        <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">Dataset</span></code> returned by interleave returns elements by cycling over a number of the child-<code class="docutils literal notranslate"><span class="pre">Dataset</span></code>s. Note, below, how the dataset cycles over <code class="docutils literal notranslate"><span class="pre">cycle_length)=3</span></code> three font files:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">font_rows</span> <span class="o">=</span> <span class="n">font_files</span><span class="o">.</span><span class="n">interleave</span><span class="p">(</span><span class="n">make_font_csv_ds</span><span class="p">,</span>
                                  <span class="n">cycle_length</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fonts_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;font_name&#39;</span><span class="p">:[],</span> <span class="s1">&#39;character&#39;</span><span class="p">:[]}</span>

<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">font_rows</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
    <span class="n">fonts_dict</span><span class="p">[</span><span class="s1">&#39;font_name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">())</span>
    <span class="n">fonts_dict</span><span class="p">[</span><span class="s1">&#39;character&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">numpy</span><span class="p">()))</span>

<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">fonts_dict</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>font_name</th>
      <th>character</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>VLADIMIR</td>
      <td></td>
    </tr>
    <tr>
      <th>1</th>
      <td>EUROROMAN</td>
      <td></td>
    </tr>
    <tr>
      <th>2</th>
      <td>E13B</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>VLADIMIR</td>
      <td></td>
    </tr>
    <tr>
      <th>4</th>
      <td>EUROROMAN</td>
      <td></td>
    </tr>
    <tr>
      <th>5</th>
      <td>E13B</td>
      <td>7</td>
    </tr>
    <tr>
      <th>6</th>
      <td>VLADIMIR</td>
      <td>◊</td>
    </tr>
    <tr>
      <th>7</th>
      <td>EUROROMAN</td>
      <td></td>
    </tr>
    <tr>
      <th>8</th>
      <td>E13B</td>
      <td>0</td>
    </tr>
    <tr>
      <th>9</th>
      <td>VLADIMIR</td>
      <td>≥</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
<div class="section" id="performance">
<h4>Performance<a class="headerlink" href="#performance" title="Permalink to this headline">¶</a></h4>
<p>Earlier, it was noted that <code class="docutils literal notranslate"><span class="pre">io.decode_csv</span></code> is more efficient when run on a batch of strings.</p>
<p>It is possible to take advantage of this fact, when using large batch sizes, to improve CSV loading performance (but try <a class="reference external" href="#caching">caching</a> first).</p>
<p>With the built-in loader 20, 2048-example batches take about 17s.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">BATCH_SIZE</span><span class="o">=</span><span class="mi">2048</span>
<span class="n">fonts_ds</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">experimental</span><span class="o">.</span><span class="n">make_csv_dataset</span><span class="p">(</span>
    <span class="n">file_pattern</span> <span class="o">=</span> <span class="s2">&quot;/tmp/fonts/*.csv&quot;</span><span class="p">,</span>
    <span class="n">batch_size</span><span class="o">=</span><span class="n">BATCH_SIZE</span><span class="p">,</span> <span class="n">num_epochs</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">num_parallel_reads</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">batch</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">fonts_ds</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="mi">20</span><span class="p">)):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span><span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>....................
CPU times: user 20 s, sys: 1.62 s, total: 21.6 s
Wall time: 8.41 s
</pre></div>
</div>
</div>
</div>
<p>Passing <strong>batches of text lines</strong> to<code class="docutils literal notranslate"><span class="pre">decode_csv</span></code> runs faster, in about 5s:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fonts_files</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">Dataset</span><span class="o">.</span><span class="n">list_files</span><span class="p">(</span><span class="s2">&quot;/tmp/fonts/*.csv&quot;</span><span class="p">)</span>
<span class="n">fonts_lines</span> <span class="o">=</span> <span class="n">fonts_files</span><span class="o">.</span><span class="n">interleave</span><span class="p">(</span>
    <span class="k">lambda</span> <span class="n">fname</span><span class="p">:</span><span class="n">tf</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">TextLineDataset</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span><span class="o">.</span><span class="n">skip</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> 
    <span class="n">cycle_length</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">batch</span><span class="p">(</span><span class="n">BATCH_SIZE</span><span class="p">)</span>

<span class="n">fonts_fast</span> <span class="o">=</span> <span class="n">fonts_lines</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">tf</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">decode_csv</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">record_defaults</span><span class="o">=</span><span class="n">font_column_types</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">batch</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">fonts_fast</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="mi">20</span><span class="p">)):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span><span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>....................
CPU times: user 2.52 s, sys: 43.4 ms, total: 2.56 s
Wall time: 1.82 s
</pre></div>
</div>
</div>
</div>
<p>For another example of increasing csv performance by using large batches see the <span class="xref myst">overfit and underfit tutorial</span>.</p>
<p>This sort of approach may work, but consider other options like <code class="docutils literal notranslate"><span class="pre">cache</span></code> and <code class="docutils literal notranslate"><span class="pre">snapshot</span></code>, or re-enncoding your data into a more streamlined format.</p>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./skillsets/tf2"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
        <div class='prev-next-bottom'>
            
    <a class='left-prev' id="prev-link" href="tf2_beginner_images.html" title="previous page">Images</a>
    <a class='right-next' id="next-link" href="tf2_beginner_numpy.html" title="next page">Numpy</a>

        </div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By comafire<br/>
        
            &copy; Copyright 2015.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../../_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
<script async="" src="https://www.google-analytics.com/analytics.js"></script>
<script>
                        window.ga = window.ga || function () {
                            (ga.q = ga.q || []).push(arguments) };
                        ga.l = +new Date;
                        ga('create', 'UA-81648003-1', 'auto');
                        ga('set', 'anonymizeIp', true);
                        ga('send', 'pageview');
                    </script>

  </body>
</html>