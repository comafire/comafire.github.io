<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#
" lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Machine Learning - Collaborative Filtering | Data Tech Lab</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/ipython.min.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/nikola_ipython.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" href="../../rss.xml">
<link rel="canonical" href="https://comafire.github.io/pages/ml-collaborative-filtering/">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><!-- Google Adsense --><script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script>
     (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-0670106451680512",
          enable_page_level_ads: true
     });
</script><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-81648003-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-81648003-1');
</script><meta name="naver-site-verification" content="92ad3daf42c3770f3ecb63db30979a8f35b0b01f">
<meta name="author" content="comafire">
<meta property="og:site_name" content="Data Tech Lab">
<meta property="og:title" content="Machine Learning - Collaborative Filtering">
<meta property="og:url" content="https://comafire.github.io/pages/ml-collaborative-filtering/">
<meta property="og:description" content="Collaborative Filtering (CF)¶협업필터링은 비슷한 성향을 가진 사용자는 비슷한 아이템을 선호 할 것이라는 가정에서 출발한 알고리즘입니다. 사용자가 아이템에 대해서 투표한 평점 로그 데이터를 이용하며, 사용자나 아이템을 기준으로 평점의 유사성을 살피는 Memory-based CF와 평점 데이터를 통해 모델을 만들고 평점을 예측하는 Mod">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2019-05-04T00:00:00+09:00">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-expand-md static-top mb-4
navbar-dark bg-dark
"><div class="container">
<!-- This keeps the margins nice -->
        <a class="navbar-brand" href="https://comafire.github.io/">

            <span id="blog-title">Data Tech Lab</span>
        </a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="bs-navbar">
            <ul class="navbar-nav mr-auto">
<li class="nav-item">
<a href="../../index.html" class="nav-link">Home</a>
            </li>
<li class="nav-item dropdown">
<a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Pages</a>
            <div class="dropdown-menu">
                    <a href="../data-technology-platform" class="dropdown-item">Data Technology Platform</a>
                    <a href="../data-science-data-engineering" class="dropdown-item">Data Science - Data Engineering</a>
                    <a href="../data-science-machine-learning" class="dropdown-item">Data Science - Machine Learning</a>
                    <a href="../data-science-statistics" class="dropdown-item">Data Science - Statistics</a>
                    <a href="../data-technology-project" class="dropdown-item">Data Technology Project</a>
            </div>
            </li>
<li class="nav-item dropdown">
<a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Posts</a>
            <div class="dropdown-menu">
                    <a href="../../posts" class="dropdown-item">Posts</a>
                    <a href="../../archive.html" class="dropdown-item">Archive</a>
                    <a href="../../categories/" class="dropdown-item">Tag</a>
                    <a href="../../rss.xml" class="dropdown-item">RSS</a>
            </div>
                </li>
<li class="nav-item">
<a href="https://github.com/comafire" class="nav-link">GitHub</a>

                
            </li>
</ul>
<!-- Google custom search --><form method="get" action="https://www.google.com/search" class="navbar-form navbar-right" role="search">
<div class="input-group">
  <input type="text" name="q" class="form-control" placeholder="Search"><input type="hidden" name="sitesearch" value="https://comafire.github.io/"><div class="input-group-append">
    <button class="btn btn-primary" type="submit">Go</button>
  </div>
</div>

</form>
<!-- End of custom search -->


            <ul class="navbar-nav navbar-right">
<li class="nav-item">
    <a href="index.ipynb" id="sourcelink" class="nav-link">Source</a>
    </li>


                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        
        
        
<article class="post-text storypage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">Machine Learning - Collaborative Filtering</a></h1>

        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Collaborative-Filtering-(CF)">Collaborative Filtering (CF)<a class="anchor-link" href="#Collaborative-Filtering-(CF)">¶</a>
</h2>
<p>협업필터링은 비슷한 성향을 가진 사용자는 비슷한 아이템을 선호 할 것이라는 가정에서 출발한 알고리즘입니다. 사용자가 아이템에 대해서 투표한 평점 로그 데이터를 이용하며, 사용자나 아이템을 기준으로 평점의 유사성을 살피는 Memory-based CF와 평점 데이터를 통해 모델을 만들고 평점을 예측하는 Model-based CF이 있습니다.</p>
<h3 id="Memory-based-CF">Memory-based CF<a class="anchor-link" href="#Memory-based-CF">¶</a>
</h3>
<p>평점 행렬을 기억하고 평점 예측을 위해 기억된 행렬 기반으로 유사도 계산을 진행하기 때문에 Memory-based CF라고 불립니다. 이 방법들은 평점 데이터가 충분히 있을 경우 간단하면서 좋은 성능을 나타내지만, 평점 데이터가 없는 새로운 유저 및 아이템 추가시 대응이 어렵다는 단점이 있습니다.</p>
<p><img src="https://buildingrecommenders.files.wordpress.com/2015/11/user-preferences.png" alt="matrix"></p>
<p>유사도 계산을 위해 surprise 패키지는 다음과 같은 유사도 기준을 제공합니다.</p>
<ul>
<li>평균제곱차이 유사도 ('msd': Mean Squared Difference Similarity)</li>
<li>코사인 유사도 ('cosine': Cosine Similarity)</li>
<li>피어슨 유사도 ('psearson': Pearson Similarity)</li>
<li>피어슨-베이스라인 유사도 ('pearson_baseline': Pearson-Baseline Similarity)</li>
</ul>
<h4 id="User-based-CF">User-based CF<a class="anchor-link" href="#User-based-CF">¶</a>
</h4>
<p>평점 행렬에서 사용자 평점 벡터 기준으로 유사한 사용자를 찾아서 이를 기반으로 원하는 아이템의 평점을 계산하는 방법</p>
<p><img src="https://buildingrecommenders.files.wordpress.com/2015/11/user-based-similarity-full.png" alt="matrix"><img src="https://buildingrecommenders.files.wordpress.com/2015/11/user-based-similarity-single-user.png" alt="matrix"><img src="https://buildingrecommenders.files.wordpress.com/2015/11/user-based-generation.png" alt="matrix"></p>
<h4 id="Item-based-CF">Item-based CF<a class="anchor-link" href="#Item-based-CF">¶</a>
</h4>
<ul>
<li>평점 행렬에서 아이템 평점 벡터 기준으로 유사한 아이템를 찾아서 이를 기반으로 원하는 사용지의 평점을 계산하는 방법</li>
</ul>
<p><img src="https://buildingrecommenders.files.wordpress.com/2015/11/item-based-similarity-full.png" alt="matrix"><img src="https://buildingrecommenders.files.wordpress.com/2015/11/item-based-similarity-single-user.png" alt="matrix"><img src="https://buildingrecommenders.files.wordpress.com/2015/11/item-based-generation.png" alt="matrix"></p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [1]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">"ignore"</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">math</span><span class="o">,</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">datasets</span><span class="p">,</span> <span class="n">preprocessing</span><span class="p">,</span> <span class="n">model_selection</span><span class="p">,</span> <span class="n">metrics</span>
<span class="kn">import</span> <span class="nn">surprise</span> <span class="k">as</span> <span class="nn">sp</span>

<span class="n">seed</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>

<span class="c1"># 데이터</span>
<span class="n">sp_data</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">Dataset</span><span class="o">.</span><span class="n">load_builtin</span><span class="p">(</span><span class="s1">'ml-100k'</span><span class="p">)</span>
<span class="n">df_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">sp_data</span><span class="o">.</span><span class="n">raw_ratings</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">"user_id"</span><span class="p">,</span> <span class="s2">"item_id"</span><span class="p">,</span> <span class="s2">"rating"</span><span class="p">,</span> <span class="s2">"timestamp"</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"df_data.shape=</span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">df_data</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df_data</span><span class="o">.</span><span class="n">dtypes</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df_data</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df_data</span><span class="o">.</span><span class="n">describe</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="s1">'all'</span><span class="p">))</span>

<span class="n">df_train</span><span class="p">,</span> <span class="n">df_test</span> <span class="o">=</span> <span class="n">model_selection</span><span class="o">.</span><span class="n">train_test_split</span><span class="p">(</span><span class="n">df_data</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df_data</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">df_train</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">df_test</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="c1"># 전처리 </span>
<span class="c1"># A reader is still needed but only the rating_scale param is requiered.</span>
<span class="n">reader</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">Reader</span><span class="p">(</span><span class="n">rating_scale</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">sp_data</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">Dataset</span><span class="o">.</span><span class="n">load_from_df</span><span class="p">(</span><span class="n">df_train</span><span class="p">[[</span><span class="s1">'user_id'</span><span class="p">,</span> <span class="s1">'item_id'</span><span class="p">,</span> <span class="s1">'rating'</span><span class="p">]],</span> <span class="n">reader</span><span class="p">)</span>
<span class="c1"># surprise model.test 의 input shape =&gt; [(user_id, item_id, rating)]</span>
<span class="n">sp_test</span> <span class="o">=</span> <span class="p">[(</span><span class="n">row</span><span class="p">[</span><span class="s1">'user_id'</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s1">'item_id'</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s1">'rating'</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df_test</span><span class="o">.</span><span class="n">iterrows</span><span class="p">()]</span>

<span class="c1"># 모델</span>
<span class="n">models</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">sp</span><span class="o">.</span><span class="n">KNNBasic</span><span class="p">(</span><span class="n">sim_options</span><span class="o">=</span><span class="p">{</span><span class="s1">'name'</span> <span class="p">:</span> <span class="s1">'msd'</span><span class="p">}),</span> 
    <span class="n">sp</span><span class="o">.</span><span class="n">KNNBasic</span><span class="p">(</span><span class="n">sim_options</span><span class="o">=</span><span class="p">{</span><span class="s1">'name'</span> <span class="p">:</span> <span class="s1">'cosine'</span><span class="p">}),</span>
    <span class="n">sp</span><span class="o">.</span><span class="n">KNNBasic</span><span class="p">(</span><span class="n">sim_options</span><span class="o">=</span><span class="p">{</span><span class="s1">'name'</span> <span class="p">:</span> <span class="s1">'pearson'</span><span class="p">}),</span>
    <span class="n">sp</span><span class="o">.</span><span class="n">KNNBasic</span><span class="p">(</span><span class="n">sim_options</span><span class="o">=</span><span class="p">{</span><span class="s1">'name'</span> <span class="p">:</span> <span class="s1">'msd'</span><span class="p">,</span> <span class="s1">'user_based'</span><span class="p">:</span> <span class="kc">False</span><span class="p">}),</span>
    <span class="n">sp</span><span class="o">.</span><span class="n">KNNBasic</span><span class="p">(</span><span class="n">sim_options</span><span class="o">=</span><span class="p">{</span><span class="s1">'name'</span> <span class="p">:</span> <span class="s1">'cosine'</span><span class="p">,</span> <span class="s1">'user_based'</span><span class="p">:</span> <span class="kc">False</span><span class="p">}),</span>
    <span class="n">sp</span><span class="o">.</span><span class="n">KNNBasic</span><span class="p">(</span><span class="n">sim_options</span><span class="o">=</span><span class="p">{</span><span class="s1">'name'</span> <span class="p">:</span> <span class="s1">'pearson'</span><span class="p">,</span> <span class="s1">'user_based'</span><span class="p">:</span> <span class="kc">False</span><span class="p">})</span>    
<span class="p">]</span>

<span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">models</span><span class="p">:</span>
    <span class="c1"># 학습</span>
    <span class="n">sp</span><span class="o">.</span><span class="n">model_selection</span><span class="o">.</span><span class="n">cross_validate</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">sp_data</span><span class="p">,</span> <span class="n">measures</span><span class="o">=</span><span class="p">[</span><span class="s1">'RMSE'</span><span class="p">,</span> <span class="s1">'MAE'</span><span class="p">],</span> <span class="n">cv</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    
    <span class="c1"># 평가</span>
    <span class="n">sp_pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">test</span><span class="p">(</span><span class="n">sp_test</span><span class="p">)</span>
    <span class="n">rmse</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">accuracy</span><span class="o">.</span><span class="n">rmse</span><span class="p">(</span><span class="n">sp_pred</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"Test RMSE=</span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rmse</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>df_data.shape=(100000, 4)
user_id       object
item_id       object
rating       float64
timestamp     object
dtype: object
  user_id item_id  rating  timestamp
0     196     242     3.0  881250949
1     186     302     3.0  891717742
2      22     377     1.0  878887116
3     244      51     2.0  880606923
4     166     346     1.0  886397596
       user_id item_id         rating  timestamp
count   100000  100000  100000.000000     100000
unique     943    1682            NaN      49282
top        405      50            NaN  891033606
freq       737     583            NaN         12
mean       NaN     NaN       3.529860        NaN
std        NaN     NaN       1.125674        NaN
min        NaN     NaN       1.000000        NaN
25%        NaN     NaN       3.000000        NaN
50%        NaN     NaN       4.000000        NaN
75%        NaN     NaN       4.000000        NaN
max        NaN     NaN       5.000000        NaN
(100000, 4) (90000, 4) (10000, 4)
Computing the msd similarity matrix...
Done computing similarity matrix.
Computing the msd similarity matrix...
Done computing similarity matrix.
Computing the msd similarity matrix...
Done computing similarity matrix.
Evaluating RMSE, MAE of algorithm KNNBasic on 3 split(s).

                  Fold 1  Fold 2  Fold 3  Mean    Std     
RMSE (testset)    0.9920  0.9944  0.9936  0.9933  0.0010  
MAE (testset)     0.7832  0.7878  0.7859  0.7856  0.0019  
Fit time          0.18    0.21    0.20    0.20    0.01    
Test time         5.75    5.76    5.82    5.78    0.03    
Test RMSE=0.9919432379164125
Computing the cosine similarity matrix...
Done computing similarity matrix.
Computing the cosine similarity matrix...
Done computing similarity matrix.
Computing the cosine similarity matrix...
Done computing similarity matrix.
Evaluating RMSE, MAE of algorithm KNNBasic on 3 split(s).

                  Fold 1  Fold 2  Fold 3  Mean    Std     
RMSE (testset)    1.0238  1.0268  1.0199  1.0235  0.0028  
MAE (testset)     0.8117  0.8131  0.8078  0.8108  0.0023  
Fit time          0.92    0.92    0.92    0.92    0.00    
Test time         5.69    6.00    5.65    5.78    0.15    
Test RMSE=1.0224081647696446
Computing the pearson similarity matrix...
Done computing similarity matrix.
Computing the pearson similarity matrix...
Done computing similarity matrix.
Computing the pearson similarity matrix...
Done computing similarity matrix.
Evaluating RMSE, MAE of algorithm KNNBasic on 3 split(s).

                  Fold 1  Fold 2  Fold 3  Mean    Std     
RMSE (testset)    1.0219  1.0219  1.0286  1.0241  0.0032  
MAE (testset)     0.8114  0.8102  0.8172  0.8129  0.0031  
Fit time          1.42    1.45    1.42    1.43    0.01    
Test time         5.74    5.62    5.96    5.77    0.14    
Test RMSE=1.0245770389211275
Computing the msd similarity matrix...
Done computing similarity matrix.
Computing the msd similarity matrix...
Done computing similarity matrix.
Computing the msd similarity matrix...
Done computing similarity matrix.
Evaluating RMSE, MAE of algorithm KNNBasic on 3 split(s).

                  Fold 1  Fold 2  Fold 3  Mean    Std     
RMSE (testset)    0.9887  0.9978  0.9883  0.9916  0.0044  
MAE (testset)     0.7847  0.7917  0.7826  0.7863  0.0039  
Fit time          0.29    0.33    0.27    0.30    0.03    
Test time         7.37    7.08    6.76    7.07    0.25    
Test RMSE=0.9876095694171025
Computing the cosine similarity matrix...
Done computing similarity matrix.
Computing the cosine similarity matrix...
Done computing similarity matrix.
Computing the cosine similarity matrix...
Done computing similarity matrix.
Evaluating RMSE, MAE of algorithm KNNBasic on 3 split(s).

                  Fold 1  Fold 2  Fold 3  Mean    Std     
RMSE (testset)    1.0435  1.0395  1.0430  1.0420  0.0018  
MAE (testset)     0.8285  0.8282  0.8278  0.8282  0.0003  
Fit time          1.69    1.68    1.65    1.67    0.02    
Test time         6.92    6.76    7.29    6.99    0.22    
Test RMSE=1.0401501772737274
Computing the pearson similarity matrix...
Done computing similarity matrix.
Computing the pearson similarity matrix...
Done computing similarity matrix.
Computing the pearson similarity matrix...
Done computing similarity matrix.
Evaluating RMSE, MAE of algorithm KNNBasic on 3 split(s).

                  Fold 1  Fold 2  Fold 3  Mean    Std     
RMSE (testset)    1.0542  1.0525  1.0548  1.0539  0.0010  
MAE (testset)     0.8447  0.8396  0.8426  0.8423  0.0021  
Fit time          2.52    2.54    2.68    2.58    0.07    
Test time         6.67    6.46    6.81    6.65    0.14    
Test RMSE=1.051538692275093
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>predict() 함수를 통해 한 데이터 셋에 대해서 예측 평점을 구할 수 있으며, Top-N 개의 비슷한 아이템이나, 사용자를 찾을 수 있습니다.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [2]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># 평가: by predict</span>
<span class="n">tests</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">preds</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">sp_test</span><span class="p">:</span>
    <span class="n">tests</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">preds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pred</span><span class="o">.</span><span class="n">est</span><span class="p">)</span>

<span class="n">rmse</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">metrics</span><span class="o">.</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">tests</span><span class="p">,</span> <span class="n">preds</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Test RMSE=</span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rmse</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>Test RMSE=1.051538692275093
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [3]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">"Top-N Similar Users"</span><span class="p">)</span>
<span class="n">user_model</span> <span class="o">=</span> <span class="n">models</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># sp.KNNBasic(sim_options={'name' : 'msd'})</span>
<span class="n">raw_uid</span> <span class="o">=</span> <span class="s1">'22'</span>
<span class="n">inner_uid</span> <span class="o">=</span> <span class="n">user_model</span><span class="o">.</span><span class="n">trainset</span><span class="o">.</span><span class="n">to_inner_uid</span><span class="p">(</span><span class="n">raw_uid</span><span class="p">)</span>
<span class="n">raw_uid</span> <span class="o">=</span> <span class="n">user_model</span><span class="o">.</span><span class="n">trainset</span><span class="o">.</span><span class="n">to_raw_uid</span><span class="p">(</span><span class="n">inner_uid</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"raw_uid:</span><span class="si">{}</span><span class="s2"> == inner_uid:</span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">raw_uid</span><span class="p">,</span> <span class="n">inner_uid</span><span class="p">))</span>

<span class="n">top_inner_uids</span> <span class="o">=</span> <span class="n">user_model</span><span class="o">.</span><span class="n">get_neighbors</span><span class="p">(</span><span class="n">inner_uid</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"top-5 inner_uids: </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">top_inner_uids</span><span class="p">))</span>
<span class="n">top_raw_uids</span> <span class="o">=</span> <span class="p">[</span><span class="n">user_model</span><span class="o">.</span><span class="n">trainset</span><span class="o">.</span><span class="n">to_raw_uid</span><span class="p">(</span><span class="n">top_inner_uid</span><span class="p">)</span> <span class="k">for</span> <span class="n">top_inner_uid</span> <span class="ow">in</span> <span class="n">top_inner_uids</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"top-5 raw_uids: </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">top_raw_uids</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">Top-N Similar Items"</span><span class="p">)</span>
<span class="n">item_model</span> <span class="o">=</span> <span class="n">models</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="c1"># sp.KNNBasic(sim_options={'name' : 'msd', 'user_based': False})</span>
<span class="n">raw_iid</span> <span class="o">=</span> <span class="s1">'377'</span>
<span class="n">inner_iid</span> <span class="o">=</span> <span class="n">item_model</span><span class="o">.</span><span class="n">trainset</span><span class="o">.</span><span class="n">to_inner_iid</span><span class="p">(</span><span class="n">raw_iid</span><span class="p">)</span>
<span class="n">raw_iid</span> <span class="o">=</span> <span class="n">item_model</span><span class="o">.</span><span class="n">trainset</span><span class="o">.</span><span class="n">to_raw_iid</span><span class="p">(</span><span class="n">inner_iid</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"raw_iid:</span><span class="si">{}</span><span class="s2"> == inner_iid:</span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">raw_iid</span><span class="p">,</span> <span class="n">inner_iid</span><span class="p">))</span>

<span class="n">top_inner_iids</span> <span class="o">=</span> <span class="n">item_model</span><span class="o">.</span><span class="n">get_neighbors</span><span class="p">(</span><span class="n">inner_iid</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"top-5 inner_iids: </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">top_inner_iids</span><span class="p">))</span>
<span class="n">top_raw_iids</span> <span class="o">=</span> <span class="p">[</span><span class="n">item_model</span><span class="o">.</span><span class="n">trainset</span><span class="o">.</span><span class="n">to_raw_iid</span><span class="p">(</span><span class="n">top_inner_iid</span><span class="p">)</span> <span class="k">for</span> <span class="n">top_inner_iid</span> <span class="ow">in</span> <span class="n">top_inner_iids</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"top-5 raw_iids: </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">top_raw_iids</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>Top-N Similar Users
raw_uid:22 == inner_uid:493
top-5 inner_uids: [3, 32, 85, 100, 174]
top-5 raw_uids: ['803', '703', '494', '787', '802']

Top-N Similar Items
raw_iid:377 == inner_iid:610
top-5 inner_iids: [1, 15, 30, 47, 56]
top-5 raw_iids: ['597', '402', '356', '365', '406']
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Model-based-CF">Model-based CF<a class="anchor-link" href="#Model-based-CF">¶</a>
</h3>
<h4 id="SVD(Singular-Value-Decomposition)">SVD(Singular Value Decomposition)<a class="anchor-link" href="#SVD(Singular-Value-Decomposition)">¶</a>
</h4>
<p>평점 데이터를 통해 모델을 만드는 방법은 다양한 접근이 가능하지만, 그 중 행렬의 연산을 이용하여 특징벡터를 추출하여 사용하는 Matrix Factorization을 많이 사용합니다. Matrix Factorization 문제에 대한 해를 찾는 방법은 여러가지가 있지만 그 중에서도 일반적으로 SVD(Singular Value Decomposition)방법을 사용합니다.</p>
<p><img src="https://buildingrecommenders.files.wordpress.com/2015/11/matrix-factorisation.png" alt="SVD"></p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [4]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">"ignore"</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">datasets</span><span class="p">,</span> <span class="n">preprocessing</span><span class="p">,</span> <span class="n">model_selection</span><span class="p">,</span> <span class="n">metrics</span>
<span class="kn">import</span> <span class="nn">surprise</span> <span class="k">as</span> <span class="nn">sp</span>

<span class="c1"># 데이터</span>
<span class="n">sp_data</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">Dataset</span><span class="o">.</span><span class="n">load_builtin</span><span class="p">(</span><span class="s1">'ml-100k'</span><span class="p">)</span>
<span class="n">df_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">sp_data</span><span class="o">.</span><span class="n">raw_ratings</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">"user_id"</span><span class="p">,</span> <span class="s2">"item_id"</span><span class="p">,</span> <span class="s2">"rating"</span><span class="p">,</span> <span class="s2">"timestamp"</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"df_data.shape=</span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">df_data</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df_data</span><span class="o">.</span><span class="n">dtypes</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df_data</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df_data</span><span class="o">.</span><span class="n">describe</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="s1">'all'</span><span class="p">))</span>

<span class="n">df_train</span><span class="p">,</span> <span class="n">df_test</span> <span class="o">=</span> <span class="n">model_selection</span><span class="o">.</span><span class="n">train_test_split</span><span class="p">(</span><span class="n">df_data</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df_data</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">df_train</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">df_test</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="c1"># 전처리 </span>
<span class="c1"># A reader is still needed but only the rating_scale param is requiered.</span>
<span class="n">reader</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">Reader</span><span class="p">(</span><span class="n">rating_scale</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">sp_data</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">Dataset</span><span class="o">.</span><span class="n">load_from_df</span><span class="p">(</span><span class="n">df_train</span><span class="p">[[</span><span class="s1">'user_id'</span><span class="p">,</span> <span class="s1">'item_id'</span><span class="p">,</span> <span class="s1">'rating'</span><span class="p">]],</span> <span class="n">reader</span><span class="p">)</span>
<span class="c1"># surprise model.test 의 input shape =&gt; [(user_id, item_id, rating)]</span>
<span class="n">sp_test</span> <span class="o">=</span> <span class="p">[(</span><span class="n">row</span><span class="p">[</span><span class="s1">'user_id'</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s1">'item_id'</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s1">'rating'</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df_test</span><span class="o">.</span><span class="n">iterrows</span><span class="p">()]</span>

<span class="c1"># 모델</span>
<span class="n">models</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">sp</span><span class="o">.</span><span class="n">SVD</span><span class="p">(</span><span class="n">n_factors</span><span class="o">=</span><span class="mi">10</span><span class="p">),</span>    
<span class="p">]</span>

<span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">models</span><span class="p">:</span>
    <span class="c1"># 학습</span>
    <span class="n">sp</span><span class="o">.</span><span class="n">model_selection</span><span class="o">.</span><span class="n">cross_validate</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">sp_data</span><span class="p">,</span> <span class="n">measures</span><span class="o">=</span><span class="p">[</span><span class="s1">'RMSE'</span><span class="p">,</span> <span class="s1">'MAE'</span><span class="p">],</span> <span class="n">cv</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    
    <span class="c1"># 평가</span>
    <span class="n">sp_pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">test</span><span class="p">(</span><span class="n">sp_test</span><span class="p">)</span>
    <span class="n">rmse</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">accuracy</span><span class="o">.</span><span class="n">rmse</span><span class="p">(</span><span class="n">sp_pred</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"Test RMSE=</span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rmse</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>df_data.shape=(100000, 4)
user_id       object
item_id       object
rating       float64
timestamp     object
dtype: object
  user_id item_id  rating  timestamp
0     196     242     3.0  881250949
1     186     302     3.0  891717742
2      22     377     1.0  878887116
3     244      51     2.0  880606923
4     166     346     1.0  886397596
       user_id item_id         rating  timestamp
count   100000  100000  100000.000000     100000
unique     943    1682            NaN      49282
top        405      50            NaN  891033606
freq       737     583            NaN         12
mean       NaN     NaN       3.529860        NaN
std        NaN     NaN       1.125674        NaN
min        NaN     NaN       1.000000        NaN
25%        NaN     NaN       3.000000        NaN
50%        NaN     NaN       4.000000        NaN
75%        NaN     NaN       4.000000        NaN
max        NaN     NaN       5.000000        NaN
(100000, 4) (90000, 4) (10000, 4)
Evaluating RMSE, MAE of algorithm SVD on 3 split(s).

                  Fold 1  Fold 2  Fold 3  Mean    Std     
RMSE (testset)    0.9493  0.9445  0.9438  0.9459  0.0024  
MAE (testset)     0.7494  0.7454  0.7470  0.7473  0.0016  
Fit time          1.63    1.68    1.67    1.66    0.02    
Test time         0.35    0.35    0.35    0.35    0.00    
Test RMSE=0.9463626341382563
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>predict() 함수를 통해 한 데이터 셋에 대해서 예측 평점을 구할 수 있습니다.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [5]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># 평가: by predict</span>
<span class="n">tests</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">preds</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">sp_test</span><span class="p">:</span>
    <span class="n">tests</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">preds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pred</span><span class="o">.</span><span class="n">est</span><span class="p">)</span>

<span class="n">rmse</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">metrics</span><span class="o">.</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">tests</span><span class="p">,</span> <span class="n">preds</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Test RMSE=</span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rmse</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>Test RMSE=0.9463626341382563
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Deep-MF">Deep MF<a class="anchor-link" href="#Deep-MF">¶</a>
</h4>
<p>Matrix Factorization 문제에 대한 해를 찾기 위해 SVD(Singular Value Decomposition)방법 많이 사용하지만, 데이터가 희소(Sparse) 하기 때문에 유저 및 아이템의 수가 굉장히 많은 경우는 메모리 문제가 생긴다는 단점이 있습니다. DeepMF 는 이 문제를 Embedding 방식의 차원 축소로 해결한 방식 입니다.</p>
<p><img src="https://d3ansictanv2wj.cloudfront.net/mf_dmf_comparison-a4a7b8e2e3d075dc9c57897d9058ef52.png" alt="DeepMF"></p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [6]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">"ignore"</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">math</span><span class="o">,</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">datasets</span><span class="p">,</span> <span class="n">preprocessing</span><span class="p">,</span> <span class="n">model_selection</span><span class="p">,</span> <span class="n">metrics</span><span class="p">,</span> <span class="n">dummy</span>
<span class="kn">import</span> <span class="nn">surprise</span> <span class="k">as</span> <span class="nn">sp</span>
<span class="kn">from</span> <span class="nn">keras</span> <span class="kn">import</span> <span class="n">models</span><span class="p">,</span> <span class="n">layers</span><span class="p">,</span> <span class="n">optimizers</span><span class="p">,</span> <span class="n">utils</span>

<span class="n">seed</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>

<span class="c1"># 데이터</span>
<span class="n">sp_data</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">Dataset</span><span class="o">.</span><span class="n">load_builtin</span><span class="p">(</span><span class="s1">'ml-100k'</span><span class="p">)</span>
<span class="n">df_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">sp_data</span><span class="o">.</span><span class="n">raw_ratings</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">"user_id"</span><span class="p">,</span> <span class="s2">"item_id"</span><span class="p">,</span> <span class="s2">"rating"</span><span class="p">,</span> <span class="s2">"timestamp"</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"df_data.shape=</span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">df_data</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df_data</span><span class="o">.</span><span class="n">dtypes</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df_data</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df_data</span><span class="o">.</span><span class="n">describe</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="s1">'all'</span><span class="p">))</span>

<span class="c1"># user_id = df_data.user_id.astype('category').cat.codes.values</span>
<span class="c1"># item_id = df_data.item_id.astype('category').cat.codes.values</span>
<span class="c1"># print(user_id.shape)</span>

<span class="n">np_data_xs</span> <span class="o">=</span> <span class="n">df_data</span><span class="p">[[</span><span class="s2">"user_id"</span><span class="p">,</span> <span class="s2">"item_id"</span><span class="p">]]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">'category'</span><span class="p">)</span><span class="o">.</span><span class="n">values</span>
<span class="n">np_data_ys</span> <span class="o">=</span> <span class="n">df_data</span><span class="p">[</span><span class="s2">"rating"</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"np_data_xs.shape=</span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np_data_xs</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"np_data_ys.shape=</span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np_data_ys</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>

<span class="n">n_users</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">np_data_xs</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]))</span>
<span class="n">n_items</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">np_data_xs</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]))</span>
<span class="n">n_factors</span> <span class="o">=</span> <span class="mi">3</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"n_users=</span><span class="si">{}</span><span class="s2">, n_items=</span><span class="si">{}</span><span class="s2">, n_factors=</span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">n_users</span><span class="p">,</span> <span class="n">n_items</span><span class="p">,</span> <span class="n">n_factors</span><span class="p">))</span>

<span class="n">np_train_xs</span><span class="p">,</span> <span class="n">np_test_xs</span><span class="p">,</span> <span class="n">np_train_ys</span><span class="p">,</span> <span class="n">np_test_ys</span> <span class="o">=</span> <span class="n">model_selection</span><span class="o">.</span><span class="n">train_test_split</span><span class="p">(</span>
    <span class="n">np_data_xs</span><span class="p">,</span> <span class="n">np_data_ys</span><span class="p">,</span> 
    <span class="n">test_size</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"train shape: np_train_xs=</span><span class="si">{}</span><span class="s2">, np_train_ys=</span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np_train_xs</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">np_train_ys</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"test shape: np_test_xs=</span><span class="si">{}</span><span class="s2">, np_test_ys=</span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np_test_xs</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">np_test_ys</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>

<span class="n">np_train_x_user_ids</span> <span class="o">=</span> <span class="n">np_train_xs</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">np_train_x_item_ids</span> <span class="o">=</span> <span class="n">np_train_xs</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"np_train_x_user_ids.shape=</span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np_train_x_user_ids</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"np_train_x_item_ids.shape=</span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np_train_x_item_ids</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>

<span class="n">np_test_x_user_ids</span> <span class="o">=</span> <span class="n">np_test_xs</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">np_test_x_item_ids</span> <span class="o">=</span> <span class="n">np_test_xs</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"np_train_x_user_ids.shape=</span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np_test_x_user_ids</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"np_train_x_item_ids.shape=</span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np_test_x_item_ids</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>

<span class="c1"># 모델</span>
<span class="k">class</span> <span class="nc">DeepMF</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_users</span><span class="p">,</span> <span class="n">n_items</span><span class="p">,</span> <span class="n">n_factors</span><span class="p">):</span>
        <span class="c1"># multi input/output 을 위해서는 name 지정이 필요</span>
        <span class="n">user_input</span> <span class="o">=</span> <span class="n">layers</span><span class="o">.</span><span class="n">Input</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="s1">'user_input'</span><span class="p">)</span>
        <span class="n">user_embed</span> <span class="o">=</span> <span class="n">layers</span><span class="o">.</span><span class="n">Embedding</span><span class="p">(</span><span class="n">n_users</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_factors</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">'user_embed'</span><span class="p">)(</span><span class="n">user_input</span><span class="p">)</span>
        <span class="n">user_vec</span> <span class="o">=</span> <span class="n">layers</span><span class="o">.</span><span class="n">Flatten</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">'user_vec'</span><span class="p">)(</span><span class="n">user_embed</span><span class="p">)</span>
        
        <span class="n">item_input</span> <span class="o">=</span> <span class="n">layers</span><span class="o">.</span><span class="n">Input</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="s1">'item_input'</span><span class="p">)</span>
        <span class="n">item_embed</span> <span class="o">=</span> <span class="n">layers</span><span class="o">.</span><span class="n">Embedding</span><span class="p">(</span><span class="n">n_items</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_factors</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">'item_embed'</span><span class="p">)(</span><span class="n">item_input</span><span class="p">)</span>
        <span class="n">item_vec</span> <span class="o">=</span> <span class="n">layers</span><span class="o">.</span><span class="n">Flatten</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">'item_vec'</span><span class="p">)(</span><span class="n">item_embed</span><span class="p">)</span>
        
        <span class="n">dot_vec</span> <span class="o">=</span> <span class="n">layers</span><span class="o">.</span><span class="n">dot</span><span class="p">([</span><span class="n">user_vec</span><span class="p">,</span> <span class="n">item_vec</span><span class="p">],</span> <span class="n">axes</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">'dot_vec'</span><span class="p">)</span>
        
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">inputs</span><span class="o">=</span><span class="p">[</span><span class="n">user_input</span><span class="p">,</span> <span class="n">item_input</span><span class="p">],</span> <span class="n">outputs</span><span class="o">=</span><span class="p">[</span><span class="n">dot_vec</span><span class="p">])</span>
        <span class="n">sgd</span> <span class="o">=</span> <span class="n">optimizers</span><span class="o">.</span><span class="n">SGD</span><span class="p">(</span><span class="n">lr</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">decay</span><span class="o">=</span><span class="mf">1e-6</span><span class="p">,</span> <span class="n">momentum</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">nesterov</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">optimizer</span><span class="o">=</span><span class="n">sgd</span><span class="p">,</span> <span class="n">loss</span><span class="o">=</span><span class="s1">'mean_squared_error'</span><span class="p">,</span> <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="s1">'mse'</span><span class="p">,</span> <span class="s1">'mae'</span><span class="p">])</span>


<span class="n">models</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">dummy</span><span class="o">.</span><span class="n">DummyRegressor</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s1">'mean'</span><span class="p">),</span>  
    <span class="n">DeepMF</span><span class="p">(</span><span class="n">n_users</span> <span class="o">=</span> <span class="n">n_users</span><span class="p">,</span> <span class="n">n_items</span> <span class="o">=</span> <span class="n">n_items</span><span class="p">,</span> <span class="n">n_factors</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>    
<span class="p">]</span>

<span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">models</span><span class="p">:</span>
    <span class="c1"># 학습</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">model"</span><span class="p">)</span>
    <span class="n">model_type</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">model</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">model_type</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">"DummyRegressor"</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">np_train_xs</span><span class="p">,</span> <span class="n">np_train_ys</span><span class="p">)</span>
        <span class="c1"># 평가</span>
        <span class="n">np_pred_ys</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">np_test_xs</span><span class="p">)</span>        
    <span class="k">else</span><span class="p">:</span>
        <span class="n">model</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>

        <span class="n">history</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">([</span><span class="n">np_train_x_user_ids</span><span class="p">,</span> <span class="n">np_train_x_item_ids</span><span class="p">],</span> <span class="n">np_train_ys</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">history</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="s1">'loss'</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">'loss'</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>    

        <span class="c1"># 평가</span>
        <span class="n">np_pred_ys</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">([</span><span class="n">np_test_x_user_ids</span><span class="p">,</span> <span class="n">np_test_x_item_ids</span><span class="p">])</span>

    <span class="n">rmse</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">metrics</span><span class="o">.</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">np_test_ys</span><span class="p">,</span> <span class="n">np_pred_ys</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"Test RMSE=</span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rmse</span><span class="p">))</span>        
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stderr output_text">
<pre>Using TensorFlow backend.
</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>df_data.shape=(100000, 4)
user_id       object
item_id       object
rating       float64
timestamp     object
dtype: object
  user_id item_id  rating  timestamp
0     196     242     3.0  881250949
1     186     302     3.0  891717742
2      22     377     1.0  878887116
3     244      51     2.0  880606923
4     166     346     1.0  886397596
       user_id item_id         rating  timestamp
count   100000  100000  100000.000000     100000
unique     943    1682            NaN      49282
top        405      50            NaN  891033606
freq       737     583            NaN         12
mean       NaN     NaN       3.529860        NaN
std        NaN     NaN       1.125674        NaN
min        NaN     NaN       1.000000        NaN
25%        NaN     NaN       3.000000        NaN
50%        NaN     NaN       4.000000        NaN
75%        NaN     NaN       4.000000        NaN
max        NaN     NaN       5.000000        NaN
np_data_xs.shape=(100000, 2)
np_data_ys.shape=(100000,)
n_users=943, n_items=1682, n_factors=3
train shape: np_train_xs=(70000, 2), np_train_ys=(70000,)
test shape: np_test_xs=(30000, 2), np_test_ys=(30000,)
np_train_x_user_ids.shape=(70000,)
np_train_x_item_ids.shape=(70000,)
np_train_x_user_ids.shape=(30000,)
np_train_x_item_ids.shape=(30000,)

model
Test RMSE=1.1220312873819274

model
__________________________________________________________________________________________________
Layer (type)                    Output Shape         Param #     Connected to                     
==================================================================================================
user_input (InputLayer)         (None, 1)            0                                            
__________________________________________________________________________________________________
item_input (InputLayer)         (None, 1)            0                                            
__________________________________________________________________________________________________
user_embed (Embedding)          (None, 1, 3)         2832        user_input[0][0]                 
__________________________________________________________________________________________________
item_embed (Embedding)          (None, 1, 3)         5049        item_input[0][0]                 
__________________________________________________________________________________________________
user_vec (Flatten)              (None, 3)            0           user_embed[0][0]                 
__________________________________________________________________________________________________
item_vec (Flatten)              (None, 3)            0           item_embed[0][0]                 
__________________________________________________________________________________________________
dot_vec (Dot)                   (None, 1)            0           user_vec[0][0]                   
                                                                 item_vec[0][0]                   
==================================================================================================
Total params: 7,881
Trainable params: 7,881
Non-trainable params: 0
__________________________________________________________________________________________________
</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt"></div>




<div class="output_png output_subarea ">
<img src="data:image/png;base64,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">
</div>

</div>

<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>Test RMSE=0.9425726584024547
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
</div>
    </div>
        <section class="comments"><h2>Comments</h2>
        
        
        <div id="disqus_thread"></div>
        <script>
        var disqus_shortname ="comafire",
            disqus_url="https://comafire.github.io/pages/ml-collaborative-filtering/",
        disqus_title="Machine Learning - Collaborative Filtering",
        disqus_identifier="cache/pages/ml-collaborative-filtering.html",
        disqus_config = function () {
            this.language = "en";
        };
        (function() {
            var dsq = document.createElement('script'); dsq.async = true;
            dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript>
    <a href="https://disqus.com" class="dsq-brlink" rel="nofollow">Comments powered by <span class="logo-disqus">Disqus</span></a>


        </section><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML" integrity="sha384-3lJUsx1TJHt7BA4udB5KPnDrlkO8T6J6v/op7ui0BbCjvZ9WqV4Xm6DTP6kQ/iBH" crossorigin="anonymous"></script><script type="text/x-mathjax-config">
        MathJax.Hub.Config({tex2jax: {inlineMath: [['$latex ','$'], ['\\(','\\)']]}});
        </script></article><!--End of body content--><footer id="footer">
            Contents © 2020         <a href="mailto:comafire@gmail.com">comafire</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         
            
            
        </footer>
</div>
</div>


        <script src="../../assets/js/all-nocdn.js"></script><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script>
</body>
</html>
