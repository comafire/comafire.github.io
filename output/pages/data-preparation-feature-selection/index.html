<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#
" lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Feature Selection | Comafire's Lab</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/ipython.min.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/nikola_ipython.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" href="../../rss.xml">
<link rel="canonical" href="https://comafire.github.io/pages/data-preparation-feature-selection/">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><!-- Google Adsense --><script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script>
     (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-0670106451680512",
          enable_page_level_ads: true
     });
</script><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-81648003-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-81648003-1');
</script><meta name="author" content="comafire">
<meta property="og:site_name" content="Comafire's Lab">
<meta property="og:title" content="Feature Selection">
<meta property="og:url" content="https://comafire.github.io/pages/data-preparation-feature-selection/">
<meta property="og:description" content="Feature Selection¶Feature Selection은 주어진 고차원 데이터 분석 시에 모델링에 사용할 변수를 선택하거나 제거하는 방법입니다.
변수 자체의 Variance Threshold 를 통한 변수 제거¶Feature Selection의 가장 기본적인 접근방법으로, Variance 가 Threshold 보다 작은 변수를 제거합니다. Vari">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2019-02-24T00:00:00+09:00">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-expand-md static-top mb-4
navbar-dark bg-dark
"><div class="container">
<!-- This keeps the margins nice -->
        <a class="navbar-brand" href="https://comafire.github.io/">

            <span id="blog-title">Comafire's Lab</span>
        </a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="bs-navbar">
            <ul class="navbar-nav mr-auto">
<li class="nav-item">
<a href="../../index.html" class="nav-link">Home</a>
            </li>
<li class="nav-item dropdown">
<a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Pages</a>
            <div class="dropdown-menu">
                    <a href="../st-kilda-pier" class="dropdown-item">St. Kilda Pier</a>
                    <a href="../notebooks-skp" class="dropdown-item">Notebooks for St. Kilda Pier</a>
                    <a href="../data-science-cookbook" class="dropdown-item">Data Science Cookbook</a>
                    <a href="../data-engineering-cookbook" class="dropdown-item">Data Engineering Cookbook</a>
            </div>
            </li>
<li class="nav-item dropdown">
<a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Posts</a>
            <div class="dropdown-menu">
                    <a href="../../posts" class="dropdown-item">Posts</a>
                    <a href="../../archive.html" class="dropdown-item">Archive</a>
                    <a href="../../categories/" class="dropdown-item">Tag</a>
                    <a href="../../rss.xml" class="dropdown-item">RSS</a>
            </div>
                </li>
<li class="nav-item">
<a href="https://github.com/comafire" class="nav-link">GitHub</a>

                
            </li>
</ul>
<!-- Google custom search --><form method="get" action="https://www.google.com/search" class="navbar-form navbar-right" role="search">
<div class="input-group">
  <input type="text" name="q" class="form-control" placeholder="Search"><input type="hidden" name="sitesearch" value="https://comafire.github.io/"><div class="input-group-append">
    <button class="btn btn-primary" type="submit">Go</button>
  </div>
</div>

</form>
<!-- End of custom search -->


            <ul class="navbar-nav navbar-right">
<li class="nav-item">
    <a href="index.ipynb" id="sourcelink" class="nav-link">Source</a>
    </li>


                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        
        
<article class="post-text storypage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">Feature Selection</a></h1>

        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Feature-Selection">Feature Selection<a class="anchor-link" href="#Feature-Selection">¶</a>
</h2>
<p>Feature Selection은 주어진 고차원 데이터 분석 시에 모델링에 사용할 변수를 선택하거나 제거하는 방법입니다.</p>
<h3 id="변수-자체의-Variance-Threshold-를-통한-변수-제거">변수 자체의 Variance Threshold 를 통한 변수 제거<a class="anchor-link" href="#%EB%B3%80%EC%88%98-%EC%9E%90%EC%B2%B4%EC%9D%98-Variance-Threshold-%EB%A5%BC-%ED%86%B5%ED%95%9C-%EB%B3%80%EC%88%98-%EC%A0%9C%EA%B1%B0">¶</a>
</h3>
<p>Feature Selection의 가장 기본적인 접근방법으로, Variance 가 Threshold 보다 작은 변수를 제거합니다. Variance 가 낮다는 것은 변수 안에 같은 값의 데이터가 많다는 의미입니다. 예를 들면 변수의 데이터의 다수가 0 으로 채워져 있는 경우입니다.</p>
<p>Variance Threshold 는 Independent Variable(독립변수, x)와 Dependent Variable(종속변수, y)간의 관계를 고려하지 않기 때문에 분석 차원에서 제거시 이 부분을 고려해봐야 합니다.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [1]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">sklearn.feature_selection</span> <span class="k">import</span> <span class="n">VarianceThreshold</span>

<span class="n">np_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
    <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
     <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
     <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]]</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">np_x</span><span class="p">)</span>

<span class="n">selector</span> <span class="o">=</span> <span class="n">VarianceThreshold</span><span class="p">()</span>
<span class="n">fit</span> <span class="o">=</span> <span class="n">selector</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">np_x</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">fit</span><span class="o">.</span><span class="n">variances_</span><span class="p">)</span>

<span class="n">np_x_selected</span> <span class="o">=</span> <span class="n">selector</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">np_x</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">np_x_selected</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">np_x_selected</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>[[0 2 0 3]
 [0 1 4 3]
 [0 1 1 3]]
[0.         0.22222222 2.88888889 0.        ]
(3, 2)
[[2 0]
 [1 4]
 [1 1]]
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Independet-Variable와-Dependent-Variable간의-관계를-통해-변수-제거">Independet Variable와 Dependent Variable간의 관계를 통해 변수 제거<a class="anchor-link" href="#Independet-Variable%EC%99%80-Dependent-Variable%EA%B0%84%EC%9D%98-%EA%B4%80%EA%B3%84%EB%A5%BC-%ED%86%B5%ED%95%B4-%EB%B3%80%EC%88%98-%EC%A0%9C%EA%B1%B0">¶</a>
</h3>
<p>주어진 고차원 Independent Variable 각각을 Dependent Variable와의 관계를 계산하여 그 중 모델의 성능에 영향을 줄수 있는 독립변수를 우선적으로 선택합니다. 독립변수와 종속변수간의 관계가 강한 Top-K 변수를 선택함으로써 아래와 같은 이점을 얻을 수 있습니다.</p>
<ul>
<li>Overfitting 감소</li>
<li>모델 성능 향상</li>
<li>모델 훈련 시간 감소</li>
</ul>
<p>Scikit-learn 에서는 단변량 통계 (Univariate Statistics)를 이용한 선택 방법 및 종속 변수의 범주에 따른 분석 방법이 Regression, Classification 이냐에 따라 다른 특징 선택 방법을 제공합니다.</p>
<p>변수 선택 방법</p>
<ul>
<li>SelectKBest: 가장 높은 점수를 받은 K 개 변수외의 변수를 제거</li>
<li>SelectPercentile: 가장 높은 점수순으로 사용자가 제공한 Percent 를 제외한 변수를 제거</li>
<li>SelectFpr: False Positve Rate를 통해 변수를 제거</li>
<li>SelectFdr: False Discovery Rate를 통해 변수를 제거</li>
<li>SelectFwe: Family Wise Error를 통해 변수를 제거</li>
</ul>
<p>종속 변수 분석 방법</p>
<ul>
<li>Regression: f_regression, mutual_info_regression</li>
<li>Classification: chi2, f_classif, mutual_info_classif</li>
</ul>
<p>Regression 문제에 Classification 특징 선택 함수를 쓸 경우에는 잘못된 결과를 얻을 수 있기 때문에 주의해야 합니다. 한가지 더 생각해보아야 할 점은 종속변수와 관계가 약한 독립변수의 제거에 있습니다. 많은 특징 데이터를 학습하여 복잡한 모델을 만들게 되는 딥러닝 기법에서는 약한 관계에 있는 변수들도 사용 시에 도움이 될 수 있기에 Top-K 변수를 사용하는 것 보다는 전혀 관계가 없는 변수만을 제거해 분석 차원 축소의 의미로 사용하는 것을 생각해보아야 합니다.</p>
<h4 id="Regression">Regression<a class="anchor-link" href="#Regression">¶</a>
</h4>
<p>Scikit-learn 에서 제공하는 샘플 데이터 셋에서 Regression 에 적합한 데이터 셋에 대해서 특징 선택을 수행해봅니다. 데이터 셋 로딩 함수의 도움말을 통해 데이터 컬럼 정보를 확인해 봅니다.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [2]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.datasets</span> <span class="k">import</span> <span class="n">load_boston</span>

load_boston<span class="o">?</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>




<div class="output_text output_subarea ">
<pre><span class="ansi-red-fg">Signature:</span> load_boston<span class="ansi-blue-fg">(</span>return_X_y<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">False</span><span class="ansi-blue-fg">)</span>
<span class="ansi-red-fg">Docstring:</span>
Load and return the boston house-prices dataset (regression).

==============     ==============
Samples total                 506
Dimensionality                 13
Features           real, positive
Targets             real 5. - 50.
==============     ==============

Read more in the :ref:`User Guide &lt;boston_dataset&gt;`.

Parameters
----------
return_X_y : boolean, default=False.
    If True, returns ``(data, target)`` instead of a Bunch object.
    See below for more information about the `data` and `target` object.

    .. versionadded:: 0.18

Returns
-------
data : Bunch
    Dictionary-like object, the interesting attributes are:
    'data', the data to learn, 'target', the regression targets,
    'DESCR', the full description of the dataset,
    and 'filename', the physical location of boston
    csv dataset (added in version `0.20`).

(data, target) : tuple if ``return_X_y`` is True

    .. versionadded:: 0.18

Notes
-----
    .. versionchanged:: 0.20
        Fixed a wrong data point at [445, 0].

Examples
--------
&gt;&gt;&gt; from sklearn.datasets import load_boston
&gt;&gt;&gt; boston = load_boston()
&gt;&gt;&gt; print(boston.data.shape)
(506, 13)
<span class="ansi-red-fg">File:</span>      /usr/local/lib/python3.5/dist-packages/sklearn/datasets/base.py
<span class="ansi-red-fg">Type:</span>      function
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>전체 13개의 변수 중에 5개의 특징을 선택해 보도록 하겠습니다.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [3]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="n">pd</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">float_format</span> <span class="o">=</span> <span class="s1">'</span><span class="si">{:.15f}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">sklearn.datasets</span> <span class="k">import</span> <span class="n">load_boston</span>
<span class="kn">from</span> <span class="nn">sklearn.feature_selection</span> <span class="k">import</span> <span class="n">SelectKBest</span>
<span class="kn">from</span> <span class="nn">sklearn.feature_selection</span> <span class="k">import</span> <span class="n">f_regression</span>

<span class="n">np_x</span><span class="p">,</span> <span class="n">np_y</span> <span class="o">=</span> <span class="n">load_boston</span><span class="p">(</span><span class="n">return_X_y</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"np_x.shape=</span><span class="si">{}</span><span class="s2">, np_y.shape=</span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np_x</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">np_y</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>

<span class="n">selector</span> <span class="o">=</span> <span class="n">SelectKBest</span><span class="p">(</span><span class="n">score_func</span> <span class="o">=</span> <span class="n">f_regression</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="s1">'all'</span><span class="p">)</span>
<span class="n">fit</span> <span class="o">=</span> <span class="n">selector</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">np_x</span><span class="p">,</span> <span class="n">np_y</span><span class="p">)</span>

<span class="c1"># Display score</span>
<span class="n">df_columns</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np_x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
<span class="n">df_scores</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">fit</span><span class="o">.</span><span class="n">scores_</span><span class="p">)</span>
<span class="n">df_feature_scores</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df_columns</span><span class="p">,</span> <span class="n">df_scores</span><span class="p">],</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">df_feature_scores</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'column'</span><span class="p">,</span> <span class="s1">'score'</span><span class="p">]</span>
<span class="n">display</span><span class="p">(</span><span class="n">df_feature_scores</span><span class="p">)</span>

<span class="c1"># Select Top-N score</span>
<span class="n">display</span><span class="p">(</span><span class="n">df_feature_scores</span><span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="s1">'score'</span><span class="p">))</span>

<span class="n">index</span> <span class="o">=</span>  <span class="n">df_feature_scores</span><span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="s1">'score'</span><span class="p">)[</span><span class="s1">'column'</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">display</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>

<span class="n">np_x_selected</span> <span class="o">=</span> <span class="n">np_x</span><span class="p">[:,</span> <span class="n">index</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">np_x_selected</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">np_x_selected</span><span class="p">[:</span><span class="mi">5</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>np_x.shape=(506, 13), np_y.shape=(506,)
</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead><tr style="text-align: right;">
<th></th>
      <th>column</th>
      <th>score</th>
    </tr></thead>
<tbody>
<tr>
<th>0</th>
      <td>0</td>
      <td>89.486114757681179</td>
    </tr>
<tr>
<th>1</th>
      <td>1</td>
      <td>75.257642298954011</td>
    </tr>
<tr>
<th>2</th>
      <td>2</td>
      <td>153.954883136110595</td>
    </tr>
<tr>
<th>3</th>
      <td>3</td>
      <td>15.971512420371932</td>
    </tr>
<tr>
<th>4</th>
      <td>4</td>
      <td>112.591480279706715</td>
    </tr>
<tr>
<th>5</th>
      <td>5</td>
      <td>471.846739876478978</td>
    </tr>
<tr>
<th>6</th>
      <td>6</td>
      <td>83.477459219237133</td>
    </tr>
<tr>
<th>7</th>
      <td>7</td>
      <td>33.579570325905010</td>
    </tr>
<tr>
<th>8</th>
      <td>8</td>
      <td>85.914277669840885</td>
    </tr>
<tr>
<th>9</th>
      <td>9</td>
      <td>141.761356577424152</td>
    </tr>
<tr>
<th>10</th>
      <td>10</td>
      <td>175.105542875713638</td>
    </tr>
<tr>
<th>11</th>
      <td>11</td>
      <td>63.054229112487491</td>
    </tr>
<tr>
<th>12</th>
      <td>12</td>
      <td>601.617871109907583</td>
    </tr>
</tbody>
</table>
</div>
</div>

</div>

<div class="output_area">

    <div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead><tr style="text-align: right;">
<th></th>
      <th>column</th>
      <th>score</th>
    </tr></thead>
<tbody>
<tr>
<th>12</th>
      <td>12</td>
      <td>601.617871109907583</td>
    </tr>
<tr>
<th>5</th>
      <td>5</td>
      <td>471.846739876478978</td>
    </tr>
<tr>
<th>10</th>
      <td>10</td>
      <td>175.105542875713638</td>
    </tr>
<tr>
<th>2</th>
      <td>2</td>
      <td>153.954883136110595</td>
    </tr>
<tr>
<th>9</th>
      <td>9</td>
      <td>141.761356577424152</td>
    </tr>
</tbody>
</table>
</div>
</div>

</div>

<div class="output_area">

    <div class="prompt"></div>




<div class="output_text output_subarea ">
<pre>array([12,  5, 10,  2,  9])</pre>
</div>

</div>

<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>(506, 5)
</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt"></div>




<div class="output_text output_subarea ">
<pre>array([[  4.98 ,   6.575,  15.3  ,   2.31 , 296.   ],
       [  9.14 ,   6.421,  17.8  ,   7.07 , 242.   ],
       [  4.03 ,   7.185,  17.8  ,   7.07 , 242.   ],
       [  2.94 ,   6.998,  18.7  ,   2.18 , 222.   ],
       [  5.33 ,   7.147,  18.7  ,   2.18 , 222.   ]])</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Classification">Classification<a class="anchor-link" href="#Classification">¶</a>
</h4>
<p>Scikit-learn 에서 제공하는 샘플 데이터 셋에서 Classication 에 적합한 데이터 셋에 대해서 특징 선택을 수행해봅니다. 데이터 셋 로딩 함수의 도움말을 통해 데이터 컬럼 정보를 확인해 봅니다.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [4]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.datasets</span> <span class="k">import</span> <span class="n">load_wine</span>

load_wine<span class="o">?</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>




<div class="output_text output_subarea ">
<pre><span class="ansi-red-fg">Signature:</span> load_wine<span class="ansi-blue-fg">(</span>return_X_y<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">False</span><span class="ansi-blue-fg">)</span>
<span class="ansi-red-fg">Docstring:</span>
Load and return the wine dataset (classification).

.. versionadded:: 0.18

The wine dataset is a classic and very easy multi-class classification
dataset.

=================   ==============
Classes                          3
Samples per class        [59,71,48]
Samples total                  178
Dimensionality                  13
Features            real, positive
=================   ==============

Read more in the :ref:`User Guide &lt;wine_dataset&gt;`.

Parameters
----------
return_X_y : boolean, default=False.
    If True, returns ``(data, target)`` instead of a Bunch object.
    See below for more information about the `data` and `target` object.

Returns
-------
data : Bunch
    Dictionary-like object, the interesting attributes are: 'data', the
    data to learn, 'target', the classification labels, 'target_names', the
    meaning of the labels, 'feature_names', the meaning of the features,
    and 'DESCR', the full description of the dataset.

(data, target) : tuple if ``return_X_y`` is True

The copy of UCI ML Wine Data Set dataset is downloaded and modified to fit
standard format from:
https://archive.ics.uci.edu/ml/machine-learning-databases/wine/wine.data

Examples
--------
Let's say you are interested in the samples 10, 80, and 140, and want to
know their class name.

&gt;&gt;&gt; from sklearn.datasets import load_wine
&gt;&gt;&gt; data = load_wine()
&gt;&gt;&gt; data.target[[10, 80, 140]]
array([0, 1, 2])
&gt;&gt;&gt; list(data.target_names)
['class_0', 'class_1', 'class_2']
<span class="ansi-red-fg">File:</span>      /usr/local/lib/python3.5/dist-packages/sklearn/datasets/base.py
<span class="ansi-red-fg">Type:</span>      function
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>전체 13개의 변수 중에 5개의 특징을 선택해 보도록 하겠습니다.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [5]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="n">pd</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">float_format</span> <span class="o">=</span> <span class="s1">'</span><span class="si">{:.15f}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">sklearn.datasets</span> <span class="k">import</span> <span class="n">load_wine</span>
<span class="kn">from</span> <span class="nn">sklearn.feature_selection</span> <span class="k">import</span> <span class="n">SelectKBest</span>
<span class="kn">from</span> <span class="nn">sklearn.feature_selection</span> <span class="k">import</span> <span class="n">f_classif</span>

<span class="n">np_x</span><span class="p">,</span> <span class="n">np_y</span> <span class="o">=</span> <span class="n">load_wine</span><span class="p">(</span><span class="n">return_X_y</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"np_x.shape=</span><span class="si">{}</span><span class="s2">, np_y.shape=</span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np_x</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">np_y</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>

<span class="n">selector</span> <span class="o">=</span> <span class="n">SelectKBest</span><span class="p">(</span><span class="n">score_func</span> <span class="o">=</span> <span class="n">f_classif</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="s1">'all'</span><span class="p">)</span>
<span class="n">fs_fit</span> <span class="o">=</span> <span class="n">selector</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">np_x</span><span class="p">,</span> <span class="n">np_y</span><span class="p">)</span>

<span class="c1"># Display score</span>
<span class="n">df_columns</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np_x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
<span class="n">df_scores</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">fit</span><span class="o">.</span><span class="n">scores_</span><span class="p">)</span>
<span class="n">df_feature_scores</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df_columns</span><span class="p">,</span> <span class="n">df_scores</span><span class="p">],</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">df_feature_scores</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'column'</span><span class="p">,</span> <span class="s1">'score'</span><span class="p">]</span>
<span class="n">display</span><span class="p">(</span><span class="n">df_feature_scores</span><span class="p">)</span>

<span class="c1"># Select Top-N score</span>
<span class="n">display</span><span class="p">(</span><span class="n">df_feature_scores</span><span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="s1">'score'</span><span class="p">))</span>

<span class="n">index</span> <span class="o">=</span>  <span class="n">df_feature_scores</span><span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="s1">'score'</span><span class="p">)[</span><span class="s1">'column'</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">display</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>

<span class="n">np_x_selected</span> <span class="o">=</span> <span class="n">np_x</span><span class="p">[:,</span> <span class="n">index</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">np_x_selected</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">np_x_selected</span><span class="p">[:</span><span class="mi">5</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>np_x.shape=(178, 13), np_y.shape=(178,)
</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead><tr style="text-align: right;">
<th></th>
      <th>column</th>
      <th>score</th>
    </tr></thead>
<tbody>
<tr>
<th>0</th>
      <td>0</td>
      <td>89.486114757681179</td>
    </tr>
<tr>
<th>1</th>
      <td>1</td>
      <td>75.257642298954011</td>
    </tr>
<tr>
<th>2</th>
      <td>2</td>
      <td>153.954883136110595</td>
    </tr>
<tr>
<th>3</th>
      <td>3</td>
      <td>15.971512420371932</td>
    </tr>
<tr>
<th>4</th>
      <td>4</td>
      <td>112.591480279706715</td>
    </tr>
<tr>
<th>5</th>
      <td>5</td>
      <td>471.846739876478978</td>
    </tr>
<tr>
<th>6</th>
      <td>6</td>
      <td>83.477459219237133</td>
    </tr>
<tr>
<th>7</th>
      <td>7</td>
      <td>33.579570325905010</td>
    </tr>
<tr>
<th>8</th>
      <td>8</td>
      <td>85.914277669840885</td>
    </tr>
<tr>
<th>9</th>
      <td>9</td>
      <td>141.761356577424152</td>
    </tr>
<tr>
<th>10</th>
      <td>10</td>
      <td>175.105542875713638</td>
    </tr>
<tr>
<th>11</th>
      <td>11</td>
      <td>63.054229112487491</td>
    </tr>
<tr>
<th>12</th>
      <td>12</td>
      <td>601.617871109907583</td>
    </tr>
</tbody>
</table>
</div>
</div>

</div>

<div class="output_area">

    <div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead><tr style="text-align: right;">
<th></th>
      <th>column</th>
      <th>score</th>
    </tr></thead>
<tbody>
<tr>
<th>12</th>
      <td>12</td>
      <td>601.617871109907583</td>
    </tr>
<tr>
<th>5</th>
      <td>5</td>
      <td>471.846739876478978</td>
    </tr>
<tr>
<th>10</th>
      <td>10</td>
      <td>175.105542875713638</td>
    </tr>
<tr>
<th>2</th>
      <td>2</td>
      <td>153.954883136110595</td>
    </tr>
<tr>
<th>9</th>
      <td>9</td>
      <td>141.761356577424152</td>
    </tr>
</tbody>
</table>
</div>
</div>

</div>

<div class="output_area">

    <div class="prompt"></div>




<div class="output_text output_subarea ">
<pre>array([12,  5, 10,  2,  9])</pre>
</div>

</div>

<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>(178, 5)
</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt"></div>




<div class="output_text output_subarea ">
<pre>array([[1.065e+03, 2.800e+00, 1.040e+00, 2.430e+00, 5.640e+00],
       [1.050e+03, 2.650e+00, 1.050e+00, 2.140e+00, 4.380e+00],
       [1.185e+03, 2.800e+00, 1.030e+00, 2.670e+00, 5.680e+00],
       [1.480e+03, 3.850e+00, 8.600e-01, 2.500e+00, 7.800e+00],
       [7.350e+02, 2.800e+00, 1.040e+00, 2.870e+00, 4.320e+00]])</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Recursive-한-변수-조합-평가를-통한-변수-제거">Recursive 한 변수 조합 평가를 통한 변수 제거<a class="anchor-link" href="#Recursive-%ED%95%9C-%EB%B3%80%EC%88%98-%EC%A1%B0%ED%95%A9-%ED%8F%89%EA%B0%80%EB%A5%BC-%ED%86%B5%ED%95%9C-%EB%B3%80%EC%88%98-%EC%A0%9C%EA%B1%B0">¶</a>
</h3>
<p>이 방법은 전체 종속 변수에 대한 서브셋을 만들고 그중 가장 나쁜 성능을 나타내는 변수 조합을 제거하는 방법입니다. 예를 들어 5개의 변수 중 3개의 변수를 선택한다고 하면, 재귀적으로 표현 가능한 변수의 조합 셋을 만들고, n-1 조합에서 가장 좋은 셋을 찾고 그 셋에서 n-2 조합 중에 가장 좋은 셋을 찾는 식입니다. 평가에 사용하는 함수는 원하는 모델 함수를 파라미터로 선택하여 이용할 수 있습니다. 이 방법은 변수의 수가 많은 고차원 데이터 셋에서는 많은 시간이 들기 때문에 고차원 데이터라면 추천되지는 않습니다.</p>
<h4 id="Regression">Regression<a class="anchor-link" href="#Regression">¶</a>
</h4>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [6]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="n">pd</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">float_format</span> <span class="o">=</span> <span class="s1">'</span><span class="si">{:.15f}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">sklearn.datasets</span> <span class="k">import</span> <span class="n">load_boston</span>
<span class="kn">from</span> <span class="nn">sklearn.feature_selection</span> <span class="k">import</span> <span class="n">RFE</span>
<span class="kn">from</span> <span class="nn">sklearn.svm</span> <span class="k">import</span> <span class="n">SVR</span>

<span class="n">np_x</span><span class="p">,</span> <span class="n">np_y</span> <span class="o">=</span> <span class="n">load_boston</span><span class="p">(</span><span class="n">return_X_y</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"np_x.shape=</span><span class="si">{}</span><span class="s2">, np_y.shape=</span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np_x</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">np_y</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>

<span class="n">estimator</span> <span class="o">=</span> <span class="n">SVR</span><span class="p">(</span><span class="n">kernel</span><span class="o">=</span><span class="s2">"linear"</span><span class="p">)</span>
<span class="n">selector</span> <span class="o">=</span> <span class="n">RFE</span><span class="p">(</span><span class="n">estimator</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="o">%</span><span class="k">time</span> fit = selector.fit(np_x, np_y)

<span class="c1"># Display score</span>
<span class="n">df_columns</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np_x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
<span class="n">df_ranks</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">fit</span><span class="o">.</span><span class="n">ranking_</span><span class="p">)</span>
<span class="n">df_feature_ranks</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df_columns</span><span class="p">,</span> <span class="n">df_ranks</span><span class="p">],</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">df_feature_ranks</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'column'</span><span class="p">,</span> <span class="s1">'rank'</span><span class="p">]</span>
<span class="n">display</span><span class="p">(</span><span class="n">df_feature_ranks</span><span class="p">)</span>

<span class="c1"># Select Top-N score</span>
<span class="n">index</span> <span class="o">=</span> <span class="n">fit</span><span class="o">.</span><span class="n">support_</span>
<span class="n">display</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>

<span class="n">np_x_selected</span> <span class="o">=</span> <span class="n">np_x</span><span class="p">[:,</span> <span class="n">index</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">np_x_selected</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">np_x_selected</span><span class="p">[:</span><span class="mi">5</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>np_x.shape=(506, 13), np_y.shape=(506,)
CPU times: user 5.9 s, sys: 0 ns, total: 5.9 s
Wall time: 5.89 s
</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead><tr style="text-align: right;">
<th></th>
      <th>column</th>
      <th>rank</th>
    </tr></thead>
<tbody>
<tr>
<th>0</th>
      <td>0</td>
      <td>3</td>
    </tr>
<tr>
<th>1</th>
      <td>1</td>
      <td>5</td>
    </tr>
<tr>
<th>2</th>
      <td>2</td>
      <td>4</td>
    </tr>
<tr>
<th>3</th>
      <td>3</td>
      <td>1</td>
    </tr>
<tr>
<th>4</th>
      <td>4</td>
      <td>1</td>
    </tr>
<tr>
<th>5</th>
      <td>5</td>
      <td>1</td>
    </tr>
<tr>
<th>6</th>
      <td>6</td>
      <td>6</td>
    </tr>
<tr>
<th>7</th>
      <td>7</td>
      <td>2</td>
    </tr>
<tr>
<th>8</th>
      <td>8</td>
      <td>8</td>
    </tr>
<tr>
<th>9</th>
      <td>9</td>
      <td>9</td>
    </tr>
<tr>
<th>10</th>
      <td>10</td>
      <td>1</td>
    </tr>
<tr>
<th>11</th>
      <td>11</td>
      <td>7</td>
    </tr>
<tr>
<th>12</th>
      <td>12</td>
      <td>1</td>
    </tr>
</tbody>
</table>
</div>
</div>

</div>

<div class="output_area">

    <div class="prompt"></div>




<div class="output_text output_subarea ">
<pre>array([False, False, False,  True,  True,  True, False, False, False,
       False,  True, False,  True])</pre>
</div>

</div>

<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>(506, 5)
</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt"></div>




<div class="output_text output_subarea ">
<pre>array([[ 0.   ,  0.538,  6.575, 15.3  ,  4.98 ],
       [ 0.   ,  0.469,  6.421, 17.8  ,  9.14 ],
       [ 0.   ,  0.469,  7.185, 17.8  ,  4.03 ],
       [ 0.   ,  0.458,  6.998, 18.7  ,  2.94 ],
       [ 0.   ,  0.458,  7.147, 18.7  ,  5.33 ]])</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Classification">Classification<a class="anchor-link" href="#Classification">¶</a>
</h4>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [7]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="n">pd</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">float_format</span> <span class="o">=</span> <span class="s1">'</span><span class="si">{:.15f}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">sklearn.datasets</span> <span class="k">import</span> <span class="n">load_wine</span>
<span class="kn">from</span> <span class="nn">sklearn.feature_selection</span> <span class="k">import</span> <span class="n">RFE</span>
<span class="kn">from</span> <span class="nn">sklearn.svm</span> <span class="k">import</span> <span class="n">SVC</span>

<span class="n">np_x</span><span class="p">,</span> <span class="n">np_y</span> <span class="o">=</span> <span class="n">load_wine</span><span class="p">(</span><span class="n">return_X_y</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"np_x.shape=</span><span class="si">{}</span><span class="s2">, np_y.shape=</span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np_x</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">np_y</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>

<span class="n">estimator</span> <span class="o">=</span> <span class="n">SVC</span><span class="p">(</span><span class="n">kernel</span><span class="o">=</span><span class="s2">"linear"</span><span class="p">)</span>
<span class="n">selector</span> <span class="o">=</span> <span class="n">RFE</span><span class="p">(</span><span class="n">estimator</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="o">%</span><span class="k">time</span> fit = selector.fit(np_x, np_y)

<span class="c1"># Display score</span>
<span class="n">df_columns</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np_x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
<span class="n">df_ranks</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">fit</span><span class="o">.</span><span class="n">ranking_</span><span class="p">)</span>
<span class="n">df_feature_ranks</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df_columns</span><span class="p">,</span> <span class="n">df_ranks</span><span class="p">],</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">df_feature_ranks</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'column'</span><span class="p">,</span> <span class="s1">'rank'</span><span class="p">]</span>
<span class="n">display</span><span class="p">(</span><span class="n">df_feature_ranks</span><span class="p">)</span>

<span class="c1"># Select Top-N score</span>
<span class="n">index</span> <span class="o">=</span> <span class="n">fit</span><span class="o">.</span><span class="n">support_</span>
<span class="n">display</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>

<span class="n">np_x_selected</span> <span class="o">=</span> <span class="n">np_x</span><span class="p">[:,</span> <span class="n">index</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">np_x_selected</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">np_x_selected</span><span class="p">[:</span><span class="mi">5</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>np_x.shape=(178, 13), np_y.shape=(178,)
CPU times: user 71.9 ms, sys: 0 ns, total: 71.9 ms
Wall time: 71.6 ms
</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead><tr style="text-align: right;">
<th></th>
      <th>column</th>
      <th>rank</th>
    </tr></thead>
<tbody>
<tr>
<th>0</th>
      <td>0</td>
      <td>1</td>
    </tr>
<tr>
<th>1</th>
      <td>1</td>
      <td>4</td>
    </tr>
<tr>
<th>2</th>
      <td>2</td>
      <td>1</td>
    </tr>
<tr>
<th>3</th>
      <td>3</td>
      <td>5</td>
    </tr>
<tr>
<th>4</th>
      <td>4</td>
      <td>8</td>
    </tr>
<tr>
<th>5</th>
      <td>5</td>
      <td>3</td>
    </tr>
<tr>
<th>6</th>
      <td>6</td>
      <td>1</td>
    </tr>
<tr>
<th>7</th>
      <td>7</td>
      <td>1</td>
    </tr>
<tr>
<th>8</th>
      <td>8</td>
      <td>6</td>
    </tr>
<tr>
<th>9</th>
      <td>9</td>
      <td>2</td>
    </tr>
<tr>
<th>10</th>
      <td>10</td>
      <td>7</td>
    </tr>
<tr>
<th>11</th>
      <td>11</td>
      <td>1</td>
    </tr>
<tr>
<th>12</th>
      <td>12</td>
      <td>9</td>
    </tr>
</tbody>
</table>
</div>
</div>

</div>

<div class="output_area">

    <div class="prompt"></div>




<div class="output_text output_subarea ">
<pre>array([ True, False,  True, False, False, False,  True,  True, False,
       False, False,  True, False])</pre>
</div>

</div>

<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>(178, 5)
</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt"></div>




<div class="output_text output_subarea ">
<pre>array([[14.23,  2.43,  3.06,  0.28,  3.92],
       [13.2 ,  2.14,  2.76,  0.26,  3.4 ],
       [13.16,  2.67,  3.24,  0.3 ,  3.17],
       [14.37,  2.5 ,  3.49,  0.24,  3.45],
       [13.24,  2.87,  2.69,  0.39,  2.93]])</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Modeling-을-통한-Feature-selection">Modeling 을 통한 Feature selection<a class="anchor-link" href="#Modeling-%EC%9D%84-%ED%86%B5%ED%95%9C-Feature-selection">¶</a>
</h3>
<p>이 방법은 모델 알고리즘 중에 훈련시에 변수의 중요도가 뽑혀저 나오는 알고리즘을 이용하여 중요도에 따라서 Feature를 선택하는 방법입니다. 이 방법의 장점은 Feature 선택과 동시에 Baseline 모델로도 활용할 수 있다는 것입니다.</p>
<h4 id="Regression">Regression<a class="anchor-link" href="#Regression">¶</a>
</h4>
<p>estimator로 LinearRegression을 사용해도 되지만 좀 더 좋은 선택을 위해 Lasso Regression를 사용해봅니다. Lasso는 L1 Regularization 을 통해 모델의 복잡성을 줄이면서 Overfit 을 방지하는 Regression 알고리즘입니다. 이 알고리즘을 통해 모델을 훈련시킬때 사용되는 coefficient 를 통해 변수를 선택합니다. 사용할 수 있는 다른 estimator는 LogisticRegression(linear_model.LogisticRegression), LinearSVM(svm.LinearSVC) 이 있습니다.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [8]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="n">pd</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">float_format</span> <span class="o">=</span> <span class="s1">'</span><span class="si">{:.15f}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">sklearn.datasets</span> <span class="k">import</span> <span class="n">load_boston</span>
<span class="kn">from</span> <span class="nn">sklearn.feature_selection</span> <span class="k">import</span> <span class="n">SelectFromModel</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="k">import</span> <span class="n">LassoCV</span>

<span class="n">np_x</span><span class="p">,</span> <span class="n">np_y</span> <span class="o">=</span> <span class="n">load_boston</span><span class="p">(</span><span class="n">return_X_y</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"np_x.shape=</span><span class="si">{}</span><span class="s2">, np_y.shape=</span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np_x</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">np_y</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>

<span class="n">estimator</span> <span class="o">=</span> <span class="n">LassoCV</span><span class="p">(</span><span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span> <span class="c1"># cv: cross validation</span>
<span class="n">selector</span> <span class="o">=</span> <span class="n">SelectFromModel</span><span class="p">(</span><span class="n">estimator</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>
<span class="o">%</span><span class="k">time</span> fit = selector.fit(np_x, np_y)

<span class="n">np_x_seleted</span> <span class="o">=</span> <span class="n">fit</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">np_x</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"np_x_seleted.shape=</span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np_x_seleted</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>np_x.shape=(506, 13), np_y.shape=(506,)
CPU times: user 34.6 ms, sys: 213 µs, total: 34.8 ms
Wall time: 34.2 ms
np_x_seleted.shape=(506, 5)
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Classification">Classification<a class="anchor-link" href="#Classification">¶</a>
</h4>
<p>estimator로 Tree 기반 알고리즘인 RandomForest를 사용해봅니다.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [9]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="n">pd</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">float_format</span> <span class="o">=</span> <span class="s1">'</span><span class="si">{:.15f}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">sklearn.datasets</span> <span class="k">import</span> <span class="n">load_wine</span>
<span class="kn">from</span> <span class="nn">sklearn.feature_selection</span> <span class="k">import</span> <span class="n">SelectFromModel</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="k">import</span> <span class="n">RandomForestClassifier</span>

<span class="n">np_x</span><span class="p">,</span> <span class="n">np_y</span> <span class="o">=</span> <span class="n">load_wine</span><span class="p">(</span><span class="n">return_X_y</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"np_x.shape=</span><span class="si">{}</span><span class="s2">, np_y.shape=</span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np_x</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">np_y</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>

<span class="n">estimator</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="n">selector</span> <span class="o">=</span> <span class="n">SelectFromModel</span><span class="p">(</span><span class="n">estimator</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="s1">'1.25*median'</span><span class="p">)</span>
<span class="o">%</span><span class="k">time</span> fit = selector.fit(np_x, np_y)

<span class="n">np_x_seleted</span> <span class="o">=</span> <span class="n">fit</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">np_x</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"np_x_seleted.shape=</span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np_x_seleted</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>np_x.shape=(178, 13), np_y.shape=(178,)
CPU times: user 60.2 ms, sys: 5 µs, total: 60.2 ms
Wall time: 59.7 ms
np_x_seleted.shape=(178, 5)
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
</div>
    </div>
        <section class="comments"><h2>Comments</h2>
        
        
        <div id="disqus_thread"></div>
        <script>
        var disqus_shortname ="comafire",
            disqus_url="https://comafire.github.io/pages/data-preparation-feature-selection/",
        disqus_title="Feature Selection",
        disqus_identifier="cache/pages/data-preparation-feature-selection.html",
        disqus_config = function () {
            this.language = "en";
        };
        (function() {
            var dsq = document.createElement('script'); dsq.async = true;
            dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript>
    <a href="https://disqus.com" class="dsq-brlink" rel="nofollow">Comments powered by <span class="logo-disqus">Disqus</span></a>


        </section><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML" integrity="sha256-SDRP1VVYu+tgAGKhddBSl5+ezofHKZeI+OzxakbIe/Y=" crossorigin="anonymous"></script><script type="text/x-mathjax-config">
        MathJax.Hub.Config({tex2jax: {inlineMath: [['$latex ','$'], ['\\(','\\)']]}});
        </script></article><!--End of body content--><footer id="footer">
            Contents © 2019         <a href="mailto:comafire@gmail.com">comafire</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         
            
        </footer>
</div>
</div>


        <script src="../../assets/js/all-nocdn.js"></script><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script>
</body>
</html>
