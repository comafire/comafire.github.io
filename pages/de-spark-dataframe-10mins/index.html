<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#
" lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Data Engineering - Apache Spark Dataframe 10분만에 훑어보기 | Data Tech Lab</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/ipython.min.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/nikola_ipython.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" href="../../rss.xml">
<link rel="canonical" href="https://comafire.github.io/pages/de-spark-dataframe-10mins/">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><!-- Google Adsense --><script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script>
     (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-0670106451680512",
          enable_page_level_ads: true
     });
</script><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-81648003-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-81648003-1');
</script><meta name="naver-site-verification" content="92ad3daf42c3770f3ecb63db30979a8f35b0b01f">
<meta name="author" content="comafire">
<meta property="og:site_name" content="Data Tech Lab">
<meta property="og:title" content="Data Engineering - Apache Spark Dataframe 10분만에 훑어보기">
<meta property="og:url" content="https://comafire.github.io/pages/de-spark-dataframe-10mins/">
<meta property="og:description" content="Spark DataFrame¶참조

PySpark DataFrame/SQL Chear Sheet







In [1]:

    
import os
from pyspark.sql import SparkSession

# Python Version Mismatch Error 일 경우, os.environ 으로 직접 설정 후 실행
# Exception: P">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2019-03-01T00:00:00+09:00">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-expand-md static-top mb-4
navbar-dark bg-dark
"><div class="container">
<!-- This keeps the margins nice -->
        <a class="navbar-brand" href="https://comafire.github.io/">

            <span id="blog-title">Data Tech Lab</span>
        </a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="bs-navbar">
            <ul class="navbar-nav mr-auto">
<li class="nav-item">
<a href="../../index.html" class="nav-link">Home</a>
            </li>
<li class="nav-item dropdown">
<a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Pages</a>
            <div class="dropdown-menu">
                    <a href="../data-technology-platform" class="dropdown-item">Data Technology Platform</a>
                    <a href="../data-science-data-engineering" class="dropdown-item">Data Science - Data Engineering</a>
                    <a href="../data-science-machine-learning" class="dropdown-item">Data Science - Machine Learning</a>
                    <a href="../data-science-statistics" class="dropdown-item">Data Science - Statistics</a>
                    <a href="../data-technology-project" class="dropdown-item">Data Technology Project</a>
            </div>
            </li>
<li class="nav-item dropdown">
<a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Posts</a>
            <div class="dropdown-menu">
                    <a href="../../posts" class="dropdown-item">Posts</a>
                    <a href="../../archive.html" class="dropdown-item">Archive</a>
                    <a href="../../categories/" class="dropdown-item">Tag</a>
                    <a href="../../rss.xml" class="dropdown-item">RSS</a>
            </div>
                </li>
<li class="nav-item">
<a href="https://github.com/comafire" class="nav-link">GitHub</a>

                
            </li>
</ul>
<!-- Google custom search --><form method="get" action="https://www.google.com/search" class="navbar-form navbar-right" role="search">
<div class="input-group">
  <input type="text" name="q" class="form-control" placeholder="Search"><input type="hidden" name="sitesearch" value="https://comafire.github.io/"><div class="input-group-append">
    <button class="btn btn-primary" type="submit">Go</button>
  </div>
</div>

</form>
<!-- End of custom search -->


            <ul class="navbar-nav navbar-right">
<li class="nav-item">
    <a href="index.ipynb" id="sourcelink" class="nav-link">Source</a>
    </li>


                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        
        
        
<article class="post-text storypage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">Data Engineering - Apache Spark Dataframe 10분만에 훑어보기</a></h1>

        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Spark-DataFrame">Spark DataFrame<a class="anchor-link" href="#Spark-DataFrame">¶</a>
</h2>
<p>참조</p>
<ul>
<li><a href="https://www.datacamp.com/community/blog/pyspark-sql-cheat-sheet">PySpark DataFrame/SQL Chear Sheet</a></li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [1]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">pyspark.sql</span> <span class="kn">import</span> <span class="n">SparkSession</span>

<span class="c1"># Python Version Mismatch Error 일 경우, os.environ 으로 직접 설정 후 실행</span>
<span class="c1"># Exception: Python in worker has different version 2.7 than that in driver 3.5, </span>
<span class="c1"># PySpark cannot run with different minor versions.Please check environment variables </span>
<span class="c1"># PYSPARK_PYTHON and PYSPARK_DRIVER_PYTHON are correctly set.</span>

<span class="c1"># os.environ["PYSPARK_PYTHON"] = "/usr/bin/python3"</span>
<span class="c1"># os.environ["PYSPARK_DRIVER_PYTHON"] = "/usr/bin/python3"</span>

<span class="n">spark_home</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'SPARK_HOME'</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">spark_home</span><span class="p">)</span>

<span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSession</span><span class="o">.</span><span class="n">builder</span><span class="o">.</span><span class="n">master</span><span class="p">(</span><span class="s2">"local[*]"</span><span class="p">)</span><span class="o">.</span><span class="n">appName</span><span class="p">(</span><span class="s2">"spark"</span><span class="p">)</span>
<span class="n">spark</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="s2">"spark.driver.memory"</span><span class="p">,</span> <span class="s2">"8g"</span><span class="p">)</span>
<span class="n">spark</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="s2">"spark.executor.memory"</span><span class="p">,</span> <span class="s2">"8g"</span><span class="p">)</span>
<span class="n">spark</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="s2">"spark.python.worker.memory"</span><span class="p">,</span> <span class="s2">"8g"</span><span class="p">)</span>
<span class="n">spark</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">getOrCreate</span><span class="p">()</span>

<span class="n">sc</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">sparkContext</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>/Users/comafire/LocalDrive/macos-jupyter/usr/local/spark
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="DataFrame-생성">DataFrame 생성<a class="anchor-link" href="#DataFrame-%EC%83%9D%EC%84%B1">¶</a>
</h2>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [2]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># import pyspark class</span>
<span class="kn">from</span> <span class="nn">pyspark.sql</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">pyspark.sql</span> <span class="kn">import</span> <span class="n">functions</span> <span class="k">as</span> <span class="n">f</span>
<span class="kn">from</span> <span class="nn">pyspark.sql</span> <span class="kn">import</span> <span class="n">types</span> <span class="k">as</span> <span class="n">t</span>


<span class="c1"># SparkContext 를 이용해 생성</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">parallelize</span><span class="p">([</span>
      <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">'MacBook Pro'</span><span class="p">,</span> <span class="mi">2015</span><span class="p">,</span> <span class="s1">'15"'</span><span class="p">,</span> <span class="s1">'16GB'</span><span class="p">,</span> <span class="s1">'512GB SSD'</span><span class="p">,</span> <span class="mf">13.75</span><span class="p">,</span> <span class="mf">9.48</span><span class="p">,</span> <span class="mf">0.61</span><span class="p">,</span> <span class="mf">4.02</span><span class="p">)</span>
    <span class="p">,</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">'MacBook'</span><span class="p">,</span> <span class="mi">2016</span><span class="p">,</span> <span class="s1">'12"'</span><span class="p">,</span> <span class="s1">'8GB'</span><span class="p">,</span> <span class="s1">'256GB SSD'</span><span class="p">,</span> <span class="mf">11.04</span><span class="p">,</span> <span class="mf">7.74</span><span class="p">,</span> <span class="mf">0.52</span><span class="p">,</span> <span class="mf">2.03</span><span class="p">)</span>
    <span class="p">,</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s1">'MacBook Air'</span><span class="p">,</span> <span class="mi">2016</span><span class="p">,</span> <span class="s1">'13.3"'</span><span class="p">,</span> <span class="s1">'8GB'</span><span class="p">,</span> <span class="s1">'128GB SSD'</span><span class="p">,</span> <span class="mf">12.8</span><span class="p">,</span> <span class="mf">8.94</span><span class="p">,</span> <span class="mf">0.68</span><span class="p">,</span> <span class="mf">2.96</span><span class="p">)</span>
    <span class="p">,</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="s1">'iMac'</span><span class="p">,</span> <span class="mi">2017</span><span class="p">,</span> <span class="s1">'27"'</span><span class="p">,</span> <span class="s1">'64GB'</span><span class="p">,</span> <span class="s1">'1TB SSD'</span><span class="p">,</span> <span class="mf">25.6</span><span class="p">,</span> <span class="mf">8.0</span><span class="p">,</span> <span class="mf">20.3</span><span class="p">,</span> <span class="mf">20.8</span><span class="p">)</span>
<span class="p">])</span>

<span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'Id'</span><span class="p">,</span> <span class="s1">'Model'</span><span class="p">,</span> <span class="s1">'Year'</span><span class="p">,</span> <span class="s1">'ScreenSize'</span><span class="p">,</span> <span class="s1">'RAM'</span><span class="p">,</span> <span class="s1">'HDD'</span><span class="p">,</span> <span class="s1">'W'</span><span class="p">,</span> <span class="s1">'D'</span><span class="p">,</span> <span class="s1">'H'</span><span class="p">,</span> <span class="s1">'Weight'</span><span class="p">]</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">columns</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>+---+-----------+----+----------+----+---------+-----+----+----+------+
| Id|      Model|Year|ScreenSize| RAM|      HDD|    W|   D|   H|Weight|
+---+-----------+----+----------+----+---------+-----+----+----+------+
|  1|MacBook Pro|2015|       15"|16GB|512GB SSD|13.75|9.48|0.61|  4.02|
|  2|    MacBook|2016|       12"| 8GB|256GB SSD|11.04|7.74|0.52|  2.03|
|  3|MacBook Air|2016|     13.3"| 8GB|128GB SSD| 12.8|8.94|0.68|  2.96|
|  4|       iMac|2017|       27"|64GB|  1TB SSD| 25.6| 8.0|20.3|  20.8|
+---+-----------+----+----------+----+---------+-----+----+----+------+

</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [3]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># 직접 Row 클래스를 사용해서 행 생성</span>
<span class="n">department1</span> <span class="o">=</span> <span class="n">Row</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s1">'123456'</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">'Computer Science'</span><span class="p">)</span>
<span class="n">department2</span> <span class="o">=</span> <span class="n">Row</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s1">'789012'</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">'Mechanical Engineering'</span><span class="p">)</span>
<span class="n">department3</span> <span class="o">=</span> <span class="n">Row</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s1">'345678'</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">'Theater and Drama'</span><span class="p">)</span>
<span class="n">department4</span> <span class="o">=</span> <span class="n">Row</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s1">'901234'</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">'Indoor Recreation'</span><span class="p">)</span>

<span class="c1"># Class 를 사용해서 행 생성</span>
<span class="n">Employee</span> <span class="o">=</span> <span class="n">Row</span><span class="p">(</span><span class="s2">"firstName"</span><span class="p">,</span> <span class="s2">"lastName"</span><span class="p">,</span> <span class="s2">"email"</span><span class="p">,</span> <span class="s2">"salary"</span><span class="p">)</span>
<span class="n">employee1</span> <span class="o">=</span> <span class="n">Employee</span><span class="p">(</span><span class="s1">'michael'</span><span class="p">,</span> <span class="s1">'armbrust'</span><span class="p">,</span> <span class="s1">'no-reply@berkeley.edu'</span><span class="p">,</span> <span class="mi">100000</span><span class="p">)</span>
<span class="n">employee2</span> <span class="o">=</span> <span class="n">Employee</span><span class="p">(</span><span class="s1">'xiangrui'</span><span class="p">,</span> <span class="s1">'meng'</span><span class="p">,</span> <span class="s1">'no-reply@stanford.edu'</span><span class="p">,</span> <span class="mi">120000</span><span class="p">)</span>
<span class="n">employee3</span> <span class="o">=</span> <span class="n">Employee</span><span class="p">(</span><span class="s1">'matei'</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">'no-reply@waterloo.edu'</span><span class="p">,</span> <span class="mi">140000</span><span class="p">)</span>
<span class="n">employee4</span> <span class="o">=</span> <span class="n">Employee</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s1">'wendell'</span><span class="p">,</span> <span class="s1">'no-reply@berkeley.edu'</span><span class="p">,</span> <span class="mi">160000</span><span class="p">)</span>

<span class="c1"># Create the DepartmentWithEmployees instances from Departments and Employees</span>
<span class="n">Group</span> <span class="o">=</span> <span class="n">Row</span><span class="p">(</span><span class="s2">"department"</span><span class="p">,</span> <span class="s2">"employees"</span><span class="p">)</span>
<span class="n">group1</span> <span class="o">=</span> <span class="n">Group</span><span class="p">(</span><span class="n">department1</span><span class="p">,</span> <span class="p">[</span><span class="n">employee1</span><span class="p">,</span> <span class="n">employee2</span><span class="p">])</span>
<span class="n">group2</span> <span class="o">=</span> <span class="n">Group</span><span class="p">(</span><span class="n">department2</span><span class="p">,</span> <span class="p">[</span><span class="n">employee3</span><span class="p">,</span> <span class="n">employee4</span><span class="p">])</span>

<span class="n">group3</span> <span class="o">=</span> <span class="n">Row</span><span class="p">(</span><span class="n">department</span><span class="o">=</span><span class="n">department3</span><span class="p">,</span> <span class="n">employees</span><span class="o">=</span><span class="p">[</span><span class="n">employee1</span><span class="p">,</span> <span class="n">employee4</span><span class="p">])</span>
<span class="n">group4</span> <span class="o">=</span> <span class="n">Row</span><span class="p">(</span><span class="n">department</span><span class="o">=</span><span class="n">department4</span><span class="p">,</span> <span class="n">employees</span><span class="o">=</span><span class="p">[</span><span class="n">employee2</span><span class="p">,</span> <span class="n">employee3</span><span class="p">])</span>

<span class="nb">print</span><span class="p">(</span><span class="n">department1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">employee1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">group1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">group3</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>Row(id='123456', name='Computer Science')
Row(firstName='michael', lastName='armbrust', email='no-reply@berkeley.edu', salary=100000)
Row(department=Row(id='123456', name='Computer Science'), employees=[Row(firstName='michael', lastName='armbrust', email='no-reply@berkeley.edu', salary=100000), Row(firstName='xiangrui', lastName='meng', email='no-reply@stanford.edu', salary=120000)])
Row(department=Row(id='345678', name='Theater and Drama'), employees=[Row(firstName='michael', lastName='armbrust', email='no-reply@berkeley.edu', salary=100000), Row(firstName=None, lastName='wendell', email='no-reply@berkeley.edu', salary=160000)])
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [4]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">s1</span> <span class="o">=</span> <span class="p">[</span><span class="n">group1</span><span class="p">,</span> <span class="n">group2</span><span class="p">]</span>
<span class="n">df1</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span><span class="n">s1</span><span class="p">)</span>
<span class="n">df1</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">s2</span> <span class="o">=</span> <span class="p">[</span><span class="n">group3</span><span class="p">,</span> <span class="n">group4</span><span class="p">]</span>
<span class="n">df2</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span><span class="n">s2</span><span class="p">)</span>
<span class="n">df2</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">df2</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="kc">False</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>+--------------------+--------------------+
|          department|           employees|
+--------------------+--------------------+
|[123456, Computer...|[[michael, armbru...|
|[789012, Mechanic...|[[matei,, no-repl...|
+--------------------+--------------------+

+---------------------------+------------------------------------------------------------------------------------------------+
|department                 |employees                                                                                       |
+---------------------------+------------------------------------------------------------------------------------------------+
|[345678, Theater and Drama]|[[michael, armbrust, no-reply@berkeley.edu, 100000], [, wendell, no-reply@berkeley.edu, 160000]]|
|[901234, Indoor Recreation]|[[xiangrui, meng, no-reply@stanford.edu, 120000], [matei,, no-reply@waterloo.edu, 140000]]      |
+---------------------------+------------------------------------------------------------------------------------------------+

</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [5]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df_union</span> <span class="o">=</span> <span class="n">df1</span><span class="o">.</span><span class="n">unionAll</span><span class="p">(</span><span class="n">df2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df_union</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">df_union</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="kc">False</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>+--------------------------------+-----------------------------------------------------------------------------------------------------+
|department                      |employees                                                                                            |
+--------------------------------+-----------------------------------------------------------------------------------------------------+
|[123456, Computer Science]      |[[michael, armbrust, no-reply@berkeley.edu, 100000], [xiangrui, meng, no-reply@stanford.edu, 120000]]|
|[789012, Mechanical Engineering]|[[matei,, no-reply@waterloo.edu, 140000], [, wendell, no-reply@berkeley.edu, 160000]]                |
|[345678, Theater and Drama]     |[[michael, armbrust, no-reply@berkeley.edu, 100000], [, wendell, no-reply@berkeley.edu, 160000]]     |
|[901234, Indoor Recreation]     |[[xiangrui, meng, no-reply@stanford.edu, 120000], [matei,, no-reply@waterloo.edu, 140000]]           |
+--------------------------------+-----------------------------------------------------------------------------------------------------+

None
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [6]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df_explode</span> <span class="o">=</span> <span class="n">df_union</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">"department"</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">"d"</span><span class="p">),</span> <span class="n">f</span><span class="o">.</span><span class="n">explode</span><span class="p">(</span><span class="s2">"employees"</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">"e"</span><span class="p">))</span>
<span class="n">df_explode</span> <span class="o">=</span> <span class="n">df_explode</span><span class="o">.</span><span class="n">selectExpr</span><span class="p">(</span><span class="s2">"d.id"</span><span class="p">,</span> <span class="s2">"d.name as departmentName"</span><span class="p">,</span> <span class="s2">"e.firstName"</span><span class="p">,</span> <span class="s2">"e.lastName"</span><span class="p">,</span> <span class="s2">"e.email"</span><span class="p">,</span> <span class="s2">"e.salary"</span><span class="p">)</span>
<span class="c1">#df_explode = df_explode.select(f.col("d.id"), f.col("d.name").alias("departmentName"), f.col("e.firstName"), f.col("e.lastName"), f.col("e.email"), f.col("e.salary"))</span>

<span class="n">df_explode</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>+------+--------------------+---------+--------+--------------------+------+
|    id|      departmentName|firstName|lastName|               email|salary|
+------+--------------------+---------+--------+--------------------+------+
|123456|    Computer Science|  michael|armbrust|no-reply@berkeley...|100000|
|123456|    Computer Science| xiangrui|    meng|no-reply@stanford...|120000|
|789012|Mechanical Engine...|    matei|    null|no-reply@waterloo...|140000|
+------+--------------------+---------+--------+--------------------+------+
only showing top 3 rows

</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Read/Write-Parquet">Read/Write Parquet<a class="anchor-link" href="#Read/Write-Parquet">¶</a>
</h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [7]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># https://docs.databricks.com/spark/latest/data-sources/read-parquet.html</span>

<span class="n">path_explode</span> <span class="o">=</span> <span class="s2">"/tmp/df_explode.parquet"</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df_explode</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">repartition</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">write</span><span class="o">.</span><span class="n">mode</span><span class="p">(</span><span class="s1">'overwrite'</span><span class="p">)</span><span class="o">.</span><span class="n">parquet</span><span class="p">(</span><span class="n">path_explode</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">parquet</span><span class="p">(</span><span class="n">path_explode</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

<span class="c1"># explode를 사용할 때, explode 대상이 되는 값이 빈 리스트([])라면, 해당 Row 는 제거됩니다. </span>
<span class="c1"># 만약 Row 는 유지하고 값만 null 로 처리하려면 Spark 2.2+ 부터 지원하는 explode_outer 함수를 사용하면 됩니다.</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>+------+--------------------+---------+--------+--------------------+------+
|    id|      departmentName|firstName|lastName|               email|salary|
+------+--------------------+---------+--------+--------------------+------+
|123456|    Computer Science|  michael|armbrust|no-reply@berkeley...|100000|
|123456|    Computer Science| xiangrui|    meng|no-reply@stanford...|120000|
|789012|Mechanical Engine...|    matei|    null|no-reply@waterloo...|140000|
+------+--------------------+---------+--------+--------------------+------+
only showing top 3 rows

</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Read/Write-CSV">Read/Write CSV<a class="anchor-link" href="#Read/Write-CSV">¶</a>
</h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [8]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># https://docs.databricks.com/spark/latest/data-sources/read-csv.html</span>

<span class="n">path_explode</span> <span class="o">=</span> <span class="s2">"/tmp/df_explode.csv"</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df_explode</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">repartition</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">write</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">"csv"</span><span class="p">)</span><span class="o">.</span><span class="n">mode</span><span class="p">(</span><span class="s1">'overwrite'</span><span class="p">)</span><span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s2">"header"</span><span class="p">,</span> <span class="s2">"true"</span><span class="p">)</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">path_explode</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">"csv"</span><span class="p">)</span><span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s2">"header"</span><span class="p">,</span> <span class="s2">"true"</span><span class="p">)</span><span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s2">"inferSchema"</span><span class="p">,</span> <span class="s2">"true"</span><span class="p">)</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">path_explode</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>+------+--------------------+---------+--------+--------------------+------+
|    id|      departmentName|firstName|lastName|               email|salary|
+------+--------------------+---------+--------+--------------------+------+
|123456|    Computer Science|  michael|armbrust|no-reply@berkeley...|100000|
|123456|    Computer Science| xiangrui|    meng|no-reply@stanford...|120000|
|789012|Mechanical Engine...|    matei|    null|no-reply@waterloo...|140000|
+------+--------------------+---------+--------+--------------------+------+
only showing top 3 rows

</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Read/Write-JSON">Read/Write JSON<a class="anchor-link" href="#Read/Write-JSON">¶</a>
</h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [9]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#https://docs.databricks.com/spark/latest/data-sources/read-json.html</span>
  
<span class="n">path_explode</span> <span class="o">=</span> <span class="s2">"/tmp/df_explode.json"</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df_explode</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">repartition</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">write</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">"json"</span><span class="p">)</span><span class="o">.</span><span class="n">mode</span><span class="p">(</span><span class="s1">'overwrite'</span><span class="p">)</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">path_explode</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">"json"</span><span class="p">)</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">path_explode</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>+--------------------+--------------------+---------+------+--------+------+
|      departmentName|               email|firstName|    id|lastName|salary|
+--------------------+--------------------+---------+------+--------+------+
|    Computer Science|no-reply@berkeley...|  michael|123456|armbrust|100000|
|    Computer Science|no-reply@stanford...| xiangrui|123456|    meng|120000|
|Mechanical Engine...|no-reply@waterloo...|    matei|789012|    null|140000|
+--------------------+--------------------+---------+------+--------+------+
only showing top 3 rows

</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Convert-to-Pandas">Convert to Pandas<a class="anchor-link" href="#Convert-to-Pandas">¶</a>
</h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [10]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="n">df_pandas</span> <span class="o">=</span> <span class="n">df_explode</span><span class="o">.</span><span class="n">toPandas</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df_pandas</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>

<span class="n">df_spark</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span><span class="n">df_pandas</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df_spark</span><span class="o">.</span><span class="n">show</span><span class="p">())</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>       id          departmentName firstName  lastName                  email  \
0  123456        Computer Science   michael  armbrust  no-reply@berkeley.edu   
1  123456        Computer Science  xiangrui      meng  no-reply@stanford.edu   
2  789012  Mechanical Engineering     matei      None  no-reply@waterloo.edu   
3  789012  Mechanical Engineering      None   wendell  no-reply@berkeley.edu   
4  345678       Theater and Drama   michael  armbrust  no-reply@berkeley.edu   

   salary  
0  100000  
1  120000  
2  140000  
3  160000  
4  100000  
+------+--------------------+---------+--------+--------------------+------+
|    id|      departmentName|firstName|lastName|               email|salary|
+------+--------------------+---------+--------+--------------------+------+
|123456|    Computer Science|  michael|armbrust|no-reply@berkeley...|100000|
|123456|    Computer Science| xiangrui|    meng|no-reply@stanford...|120000|
|789012|Mechanical Engine...|    matei|    null|no-reply@waterloo...|140000|
|789012|Mechanical Engine...|     null| wendell|no-reply@berkeley...|160000|
|345678|   Theater and Drama|  michael|armbrust|no-reply@berkeley...|100000|
|345678|   Theater and Drama|     null| wendell|no-reply@berkeley...|160000|
|901234|   Indoor Recreation| xiangrui|    meng|no-reply@stanford...|120000|
|901234|   Indoor Recreation|    matei|    null|no-reply@waterloo...|140000|
+------+--------------------+---------+--------+--------------------+------+

None
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="DataFrame-정보보기">DataFrame 정보보기<a class="anchor-link" href="#DataFrame-%EC%A0%95%EB%B3%B4%EB%B3%B4%EA%B8%B0">¶</a>
</h2>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [11]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">df_explode</span>

<span class="c1"># DataFrame 컬럼 정보 살펴보기</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">printSchema</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">schema</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">dtypes</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>root
 |-- id: string (nullable = true)
 |-- departmentName: string (nullable = true)
 |-- firstName: string (nullable = true)
 |-- lastName: string (nullable = true)
 |-- email: string (nullable = true)
 |-- salary: long (nullable = true)

None
StructType(List(StructField(id,StringType,true),StructField(departmentName,StringType,true),StructField(firstName,StringType,true),StructField(lastName,StringType,true),StructField(email,StringType,true),StructField(salary,LongType,true)))
['id', 'departmentName', 'firstName', 'lastName', 'email', 'salary']
[('id', 'string'), ('departmentName', 'string'), ('firstName', 'string'), ('lastName', 'string'), ('email', 'string'), ('salary', 'bigint')]
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [12]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">first</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">count</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">"id"</span><span class="p">)</span><span class="o">.</span><span class="n">distinct</span><span class="p">()</span><span class="o">.</span><span class="n">show</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">"id"</span><span class="p">)</span><span class="o">.</span><span class="n">distinct</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">())</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>+------+--------------------+---------+--------+--------------------+------+
|    id|      departmentName|firstName|lastName|               email|salary|
+------+--------------------+---------+--------+--------------------+------+
|123456|    Computer Science|  michael|armbrust|no-reply@berkeley...|100000|
|123456|    Computer Science| xiangrui|    meng|no-reply@stanford...|120000|
|789012|Mechanical Engine...|    matei|    null|no-reply@waterloo...|140000|
+------+--------------------+---------+--------+--------------------+------+
only showing top 3 rows

+------+----------------------+---------+--------+---------------------+------+
|id    |departmentName        |firstName|lastName|email                |salary|
+------+----------------------+---------+--------+---------------------+------+
|123456|Computer Science      |michael  |armbrust|no-reply@berkeley.edu|100000|
|123456|Computer Science      |xiangrui |meng    |no-reply@stanford.edu|120000|
|789012|Mechanical Engineering|matei    |null    |no-reply@waterloo.edu|140000|
+------+----------------------+---------+--------+---------------------+------+
only showing top 3 rows

Row(id='123456', departmentName='Computer Science', firstName='michael', lastName='armbrust', email='no-reply@berkeley.edu', salary=100000)
[Row(id='123456', departmentName='Computer Science', firstName='michael', lastName='armbrust', email='no-reply@berkeley.edu', salary=100000), Row(id='123456', departmentName='Computer Science', firstName='xiangrui', lastName='meng', email='no-reply@stanford.edu', salary=120000)]
[Row(id='123456', departmentName='Computer Science', firstName='michael', lastName='armbrust', email='no-reply@berkeley.edu', salary=100000), Row(id='123456', departmentName='Computer Science', firstName='xiangrui', lastName='meng', email='no-reply@stanford.edu', salary=120000)]
8
+------+
|    id|
+------+
|123456|
|789012|
|901234|
|345678|
+------+

None
4
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="DataFrame-조작하기">DataFrame 조작하기<a class="anchor-link" href="#DataFrame-%EC%A1%B0%EC%9E%91%ED%95%98%EA%B8%B0">¶</a>
</h2>
<h3 id="Selection">Selection<a class="anchor-link" href="#Selection">¶</a>
</h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [13]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># 열 선택</span>
<span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">"id"</span><span class="p">,</span> <span class="s2">"departmentName"</span><span class="p">,</span> <span class="s2">"firstName"</span><span class="p">,</span> <span class="s2">"salary"</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># 중복 제거</span>
<span class="n">df</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'firstName'</span><span class="p">])</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>+------+--------------------+---------+------+
|    id|      departmentName|firstName|salary|
+------+--------------------+---------+------+
|123456|    Computer Science|  michael|100000|
|123456|    Computer Science| xiangrui|120000|
|789012|Mechanical Engine...|    matei|140000|
|789012|Mechanical Engine...|     null|160000|
|345678|   Theater and Drama|  michael|100000|
|345678|   Theater and Drama|     null|160000|
|901234|   Indoor Recreation| xiangrui|120000|
|901234|   Indoor Recreation|    matei|140000|
+------+--------------------+---------+------+

+------+--------------------+---------+--------+--------------------+------+
|    id|      departmentName|firstName|lastName|               email|salary|
+------+--------------------+---------+--------+--------------------+------+
|789012|Mechanical Engine...|     null| wendell|no-reply@berkeley...|160000|
|123456|    Computer Science| xiangrui|    meng|no-reply@stanford...|120000|
|789012|Mechanical Engine...|    matei|    null|no-reply@waterloo...|140000|
|123456|    Computer Science|  michael|armbrust|no-reply@berkeley...|100000|
+------+--------------------+---------+--------+--------------------+------+

</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [14]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># 조건을 통한 선택</span>
<span class="c1"># Where, Filter</span>
<span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">"id"</span><span class="p">,</span> <span class="s2">"salary"</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">"salary"</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">140000</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">"id"</span><span class="p">,</span> <span class="s2">"salary"</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">"salary"</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">140000</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Between</span>
<span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">"id"</span><span class="p">,</span> <span class="s2">"salary"</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">"salary"</span><span class="p">]</span><span class="o">.</span><span class="n">between</span><span class="p">(</span><span class="mi">10000</span><span class="p">,</span> <span class="mi">140000</span><span class="p">))</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>+------+------+
|    id|salary|
+------+------+
|789012|160000|
|345678|160000|
+------+------+

+------+------+
|    id|salary|
+------+------+
|789012|160000|
|345678|160000|
+------+------+

+------+------+
|    id|salary|
+------+------+
|123456|100000|
|123456|120000|
|789012|140000|
|345678|100000|
|901234|120000|
|901234|140000|
+------+------+

</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [15]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Like</span>
<span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">"id"</span><span class="p">,</span> <span class="s2">"departmentName"</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">'departmentName'</span><span class="p">]</span><span class="o">.</span><span class="n">like</span><span class="p">(</span><span class="s2">"%Com%"</span><span class="p">))</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Startswith, endswith</span>
<span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">"id"</span><span class="p">,</span> <span class="s2">"departmentName"</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">'departmentName'</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">"Indoor"</span><span class="p">))</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">"id"</span><span class="p">,</span> <span class="s2">"departmentName"</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">'departmentName'</span><span class="p">]</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">"Drama"</span><span class="p">))</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># isin</span>
<span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">"id"</span><span class="p">,</span> <span class="s2">"departmentName"</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">"departmentName"</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="s2">"Computer Science"</span><span class="p">,</span> <span class="s2">"Indoor Recreation"</span><span class="p">))</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>+------+----------------+
|    id|  departmentName|
+------+----------------+
|123456|Computer Science|
|123456|Computer Science|
+------+----------------+

+------+-----------------+
|    id|   departmentName|
+------+-----------------+
|901234|Indoor Recreation|
|901234|Indoor Recreation|
+------+-----------------+

+------+-----------------+
|    id|   departmentName|
+------+-----------------+
|345678|Theater and Drama|
|345678|Theater and Drama|
+------+-----------------+

+------+-----------------+
|    id|   departmentName|
+------+-----------------+
|123456| Computer Science|
|123456| Computer Science|
|901234|Indoor Recreation|
|901234|Indoor Recreation|
+------+-----------------+

</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Setting">Setting<a class="anchor-link" href="#Setting">¶</a>
</h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [16]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># 연산을 통한 컬럼 생성</span>
<span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">"id"</span><span class="p">,</span> <span class="s2">"salary"</span><span class="p">,</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">"salary"</span><span class="p">]</span> <span class="o">*</span> <span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">"bonus"</span><span class="p">))</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">"id"</span><span class="p">,</span> <span class="s2">"salary"</span><span class="p">)</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">"bonus"</span><span class="p">,</span> <span class="n">df</span><span class="p">[</span><span class="s2">"salary"</span><span class="p">]</span> <span class="o">*</span> <span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">"id"</span><span class="p">,</span> <span class="s2">"departmentName"</span><span class="p">,</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">"departmentName"</span><span class="p">]</span><span class="o">.</span><span class="n">substr</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">"substr"</span><span class="p">))</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># 조건을 통한 컬럼 생성</span>
<span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">"id"</span><span class="p">,</span> <span class="s2">"salary"</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">"salary"</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">120000</span><span class="p">,</span> <span class="s2">"High"</span><span class="p">)</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span><span class="s2">"Low"</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">"cost"</span><span class="p">))</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>+------+------+-------+
|    id|salary|  bonus|
+------+------+-------+
|123456|100000|50000.0|
|123456|120000|60000.0|
+------+------+-------+
only showing top 2 rows

+------+------+-------+
|    id|salary|  bonus|
+------+------+-------+
|123456|100000|50000.0|
|123456|120000|60000.0|
+------+------+-------+
only showing top 2 rows

+------+----------------+------+
|    id|  departmentName|substr|
+------+----------------+------+
|123456|Computer Science|   Com|
|123456|Computer Science|   Com|
+------+----------------+------+
only showing top 2 rows

+------+------+----+
|    id|salary|cost|
+------+------+----+
|123456|100000| Low|
|123456|120000| Low|
|789012|140000|High|
+------+------+----+
only showing top 3 rows

</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [17]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># 사용자 함수를 통한 컬럼 생성</span>
<span class="c1"># Lambda 함수 방식</span>
<span class="n">bonus</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">udf</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">x</span> <span class="o">*</span> <span class="n">y</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">FloatType</span><span class="p">())</span>
<span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s1">'bonus'</span><span class="p">,</span> <span class="n">bonus</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">'salary'</span><span class="p">],</span> <span class="n">f</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)))</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Annotation 방식</span>
<span class="nd">@f</span><span class="o">.</span><span class="n">udf</span><span class="p">(</span><span class="s1">'float'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">bonus</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">*</span> <span class="n">y</span>

<span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s1">'bonus'</span><span class="p">,</span> <span class="n">bonus</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">'salary'</span><span class="p">],</span> <span class="n">f</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)))</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>+------+--------------------+---------+--------+--------------------+------+-------+
|    id|      departmentName|firstName|lastName|               email|salary|  bonus|
+------+--------------------+---------+--------+--------------------+------+-------+
|123456|    Computer Science|  michael|armbrust|no-reply@berkeley...|100000|50000.0|
|123456|    Computer Science| xiangrui|    meng|no-reply@stanford...|120000|60000.0|
|789012|Mechanical Engine...|    matei|    null|no-reply@waterloo...|140000|70000.0|
|789012|Mechanical Engine...|     null| wendell|no-reply@berkeley...|160000|80000.0|
|345678|   Theater and Drama|  michael|armbrust|no-reply@berkeley...|100000|50000.0|
|345678|   Theater and Drama|     null| wendell|no-reply@berkeley...|160000|80000.0|
|901234|   Indoor Recreation| xiangrui|    meng|no-reply@stanford...|120000|60000.0|
|901234|   Indoor Recreation|    matei|    null|no-reply@waterloo...|140000|70000.0|
+------+--------------------+---------+--------+--------------------+------+-------+

+------+--------------------+---------+--------+--------------------+------+-------+
|    id|      departmentName|firstName|lastName|               email|salary|  bonus|
+------+--------------------+---------+--------+--------------------+------+-------+
|123456|    Computer Science|  michael|armbrust|no-reply@berkeley...|100000|50000.0|
|123456|    Computer Science| xiangrui|    meng|no-reply@stanford...|120000|60000.0|
|789012|Mechanical Engine...|    matei|    null|no-reply@waterloo...|140000|70000.0|
|789012|Mechanical Engine...|     null| wendell|no-reply@berkeley...|160000|80000.0|
|345678|   Theater and Drama|  michael|armbrust|no-reply@berkeley...|100000|50000.0|
|345678|   Theater and Drama|     null| wendell|no-reply@berkeley...|160000|80000.0|
|901234|   Indoor Recreation| xiangrui|    meng|no-reply@stanford...|120000|60000.0|
|901234|   Indoor Recreation|    matei|    null|no-reply@waterloo...|140000|70000.0|
+------+--------------------+---------+--------+--------------------+------+-------+

</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [18]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df1</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">parallelize</span><span class="p">([</span>
  <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> 
  <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> 
  <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> 
<span class="p">])</span><span class="o">.</span><span class="n">toDF</span><span class="p">([</span><span class="s1">'c1'</span><span class="p">,</span> <span class="s1">'c2'</span><span class="p">,</span> <span class="s1">'c3'</span><span class="p">,</span> <span class="s1">'c4'</span><span class="p">,</span> <span class="s1">'c5'</span><span class="p">])</span>
<span class="n">df1</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Array 방식을 통한 여러 컬럼 연산</span>
<span class="k">def</span> <span class="nf">sum_two</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

<span class="n">udf_sum_two</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">udf</span><span class="p">(</span><span class="n">sum_two</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">IntegerType</span><span class="p">())</span>
  
<span class="k">def</span> <span class="nf">sum_all</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>

<span class="n">udf_sum_all</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">udf</span><span class="p">(</span><span class="n">sum_all</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">IntegerType</span><span class="p">())</span>


<span class="c1"># Sum Two Columns c1 + c2</span>
<span class="n">df1</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">"sum_two"</span><span class="p">,</span> <span class="n">udf_sum_two</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">"c1"</span><span class="p">),</span> <span class="n">f</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">"c2"</span><span class="p">)))</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Sum All Columns</span>
<span class="n">df1</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">"sum_all"</span><span class="p">,</span> <span class="n">udf_sum_all</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">df1</span><span class="o">.</span><span class="n">columns</span><span class="p">]))</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Sum Some Columns</span>
<span class="n">df1</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">"sum_some"</span><span class="p">,</span> <span class="n">udf_sum_all</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">"c1"</span><span class="p">),</span> <span class="n">f</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">"c2"</span><span class="p">),</span> <span class="n">f</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">"c3"</span><span class="p">)))</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>+---+---+---+---+---+
| c1| c2| c3| c4| c5|
+---+---+---+---+---+
|  1|  2|  3|  4|  5|
|  1|  2|  3|  4|  5|
|  1|  2|  3|  4|  5|
+---+---+---+---+---+

+---+---+---+---+---+-------+
| c1| c2| c3| c4| c5|sum_two|
+---+---+---+---+---+-------+
|  1|  2|  3|  4|  5|      3|
|  1|  2|  3|  4|  5|      3|
|  1|  2|  3|  4|  5|      3|
+---+---+---+---+---+-------+

+---+---+---+---+---+-------+
| c1| c2| c3| c4| c5|sum_all|
+---+---+---+---+---+-------+
|  1|  2|  3|  4|  5|     15|
|  1|  2|  3|  4|  5|     15|
|  1|  2|  3|  4|  5|     15|
+---+---+---+---+---+-------+

+---+---+---+---+---+--------+
| c1| c2| c3| c4| c5|sum_some|
+---+---+---+---+---+--------+
|  1|  2|  3|  4|  5|       6|
|  1|  2|  3|  4|  5|       6|
|  1|  2|  3|  4|  5|       6|
+---+---+---+---+---+--------+

</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Missing-Value">Missing Value<a class="anchor-link" href="#Missing-Value">¶</a>
</h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [19]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">"id"</span><span class="p">,</span> <span class="s2">"firstName"</span><span class="p">,</span> <span class="s2">"lastName"</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># 결측치 체크  </span>
<span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">"id"</span><span class="p">,</span> <span class="s2">"firstName"</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">"firstName"</span><span class="p">]</span><span class="o">.</span><span class="n">isNotNull</span><span class="p">())</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">"id"</span><span class="p">,</span> <span class="s2">"firstName"</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">"firstName"</span><span class="p">]</span><span class="o">.</span><span class="n">isNull</span><span class="p">())</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>+------+---------+--------+
|    id|firstName|lastName|
+------+---------+--------+
|123456|  michael|armbrust|
|123456| xiangrui|    meng|
|789012|    matei|    null|
|789012|     null| wendell|
|345678|  michael|armbrust|
|345678|     null| wendell|
|901234| xiangrui|    meng|
|901234|    matei|    null|
+------+---------+--------+

+------+---------+
|    id|firstName|
+------+---------+
|123456|  michael|
|123456| xiangrui|
|789012|    matei|
|345678|  michael|
|901234| xiangrui|
|901234|    matei|
+------+---------+

+------+---------+
|    id|firstName|
+------+---------+
|789012|     null|
|345678|     null|
+------+---------+

</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [20]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># 상수로 체우기</span>
<span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">"id"</span><span class="p">,</span> <span class="s2">"firstName"</span><span class="p">,</span> <span class="s2">"lastName"</span><span class="p">)</span><span class="o">.</span><span class="n">fillna</span><span class="p">({</span> <span class="s1">'firstName'</span><span class="p">:</span> <span class="s1">'Unknown'</span><span class="p">,</span> <span class="s1">'lastName'</span><span class="p">:</span> <span class="s1">'Unknown'</span> <span class="p">})</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>+------+---------+--------+
|    id|firstName|lastName|
+------+---------+--------+
|123456|  michael|armbrust|
|123456| xiangrui|    meng|
|789012|    matei| Unknown|
|789012|  Unknown| wendell|
|345678|  michael|armbrust|
|345678|  Unknown| wendell|
|901234| xiangrui|    meng|
|901234|    matei| Unknown|
+------+---------+--------+

</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Operation">Operation<a class="anchor-link" href="#Operation">¶</a>
</h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [21]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># 컬럼 이름 변경</span>
<span class="n">df</span><span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s1">'id'</span><span class="p">,</span> <span class="s1">'ID'</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># 컬럼 삭제</span>
<span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">"email"</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># 통계 확인</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"n rows: </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">count</span><span class="p">()))</span>
<span class="n">df</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>+------+--------------------+---------+--------+--------------------+------+
|    ID|      departmentName|firstName|lastName|               email|salary|
+------+--------------------+---------+--------+--------------------+------+
|123456|    Computer Science|  michael|armbrust|no-reply@berkeley...|100000|
|123456|    Computer Science| xiangrui|    meng|no-reply@stanford...|120000|
|789012|Mechanical Engine...|    matei|    null|no-reply@waterloo...|140000|
|789012|Mechanical Engine...|     null| wendell|no-reply@berkeley...|160000|
|345678|   Theater and Drama|  michael|armbrust|no-reply@berkeley...|100000|
|345678|   Theater and Drama|     null| wendell|no-reply@berkeley...|160000|
|901234|   Indoor Recreation| xiangrui|    meng|no-reply@stanford...|120000|
|901234|   Indoor Recreation|    matei|    null|no-reply@waterloo...|140000|
+------+--------------------+---------+--------+--------------------+------+

+------+--------------------+---------+--------+------+
|    id|      departmentName|firstName|lastName|salary|
+------+--------------------+---------+--------+------+
|123456|    Computer Science|  michael|armbrust|100000|
|123456|    Computer Science| xiangrui|    meng|120000|
|789012|Mechanical Engine...|    matei|    null|140000|
|789012|Mechanical Engine...|     null| wendell|160000|
|345678|   Theater and Drama|  michael|armbrust|100000|
|345678|   Theater and Drama|     null| wendell|160000|
|901234|   Indoor Recreation| xiangrui|    meng|120000|
|901234|   Indoor Recreation|    matei|    null|140000|
+------+--------------------+---------+--------+------+

n rows: 8
+-------+-----------------+-----------------+---------+--------+--------------------+------------------+
|summary|               id|   departmentName|firstName|lastName|               email|            salary|
+-------+-----------------+-----------------+---------+--------+--------------------+------------------+
|  count|                8|                8|        6|       6|                   8|                 8|
|   mean|         539845.0|             null|     null|    null|                null|          130000.0|
| stddev|339649.7466592818|             null|     null|    null|                null|23904.572186687874|
|    min|           123456| Computer Science|    matei|armbrust|no-reply@berkeley...|            100000|
|    max|           901234|Theater and Drama| xiangrui| wendell|no-reply@waterloo...|            160000|
+-------+-----------------+-----------------+---------+--------+--------------------+------------------+

</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [22]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># GroupBy</span>
<span class="n">df</span><span class="o">.</span><span class="n">groupBy</span><span class="p">(</span><span class="s2">"departmentName"</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="s1">'salary'</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s1">'tot_salary'</span><span class="p">),</span> <span class="n">f</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">'salary'</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s1">'avg_salary'</span><span class="p">))</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Pivot</span>
<span class="n">df</span><span class="o">.</span><span class="n">groupBy</span><span class="p">(</span><span class="s2">"departmentName"</span><span class="p">)</span><span class="o">.</span><span class="n">pivot</span><span class="p">(</span><span class="s1">'firstName'</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">'salary'</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s1">'avg_salary'</span><span class="p">))</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>+--------------------+----------+----------+
|      departmentName|tot_salary|avg_salary|
+--------------------+----------+----------+
|   Theater and Drama|    260000|  130000.0|
|Mechanical Engine...|    300000|  150000.0|
|    Computer Science|    220000|  110000.0|
|   Indoor Recreation|    260000|  130000.0|
+--------------------+----------+----------+

+--------------------+--------+--------+--------+--------+
|      departmentName|    null|   matei| michael|xiangrui|
+--------------------+--------+--------+--------+--------+
|   Theater and Drama|160000.0|    null|100000.0|    null|
|Mechanical Engine...|160000.0|140000.0|    null|    null|
|    Computer Science|    null|    null|100000.0|120000.0|
|   Indoor Recreation|    null|140000.0|    null|120000.0|
+--------------------+--------+--------+--------+--------+

</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [23]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Sort</span>
<span class="n">df</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">'salary'</span><span class="p">]</span><span class="o">.</span><span class="n">desc</span><span class="p">(),</span> <span class="n">df</span><span class="p">[</span><span class="s1">'id'</span><span class="p">]</span><span class="o">.</span><span class="n">asc</span><span class="p">())</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">df</span><span class="o">.</span><span class="n">sort</span><span class="p">([</span><span class="s2">"salary"</span><span class="p">,</span> <span class="s2">"id"</span><span class="p">],</span> <span class="n">ascending</span><span class="o">=</span><span class="p">[</span><span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">])</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">df</span><span class="o">.</span><span class="n">orderBy</span><span class="p">([</span><span class="s2">"salary"</span><span class="p">,</span> <span class="s2">"id"</span><span class="p">],</span><span class="n">ascending</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>+------+--------------------+---------+--------+--------------------+------+
|    id|      departmentName|firstName|lastName|               email|salary|
+------+--------------------+---------+--------+--------------------+------+
|345678|   Theater and Drama|     null| wendell|no-reply@berkeley...|160000|
|789012|Mechanical Engine...|     null| wendell|no-reply@berkeley...|160000|
|789012|Mechanical Engine...|    matei|    null|no-reply@waterloo...|140000|
|901234|   Indoor Recreation|    matei|    null|no-reply@waterloo...|140000|
|123456|    Computer Science| xiangrui|    meng|no-reply@stanford...|120000|
|901234|   Indoor Recreation| xiangrui|    meng|no-reply@stanford...|120000|
|123456|    Computer Science|  michael|armbrust|no-reply@berkeley...|100000|
|345678|   Theater and Drama|  michael|armbrust|no-reply@berkeley...|100000|
+------+--------------------+---------+--------+--------------------+------+

+------+--------------------+---------+--------+--------------------+------+
|    id|      departmentName|firstName|lastName|               email|salary|
+------+--------------------+---------+--------+--------------------+------+
|345678|   Theater and Drama|     null| wendell|no-reply@berkeley...|160000|
|789012|Mechanical Engine...|     null| wendell|no-reply@berkeley...|160000|
|789012|Mechanical Engine...|    matei|    null|no-reply@waterloo...|140000|
|901234|   Indoor Recreation|    matei|    null|no-reply@waterloo...|140000|
|123456|    Computer Science| xiangrui|    meng|no-reply@stanford...|120000|
|901234|   Indoor Recreation| xiangrui|    meng|no-reply@stanford...|120000|
|123456|    Computer Science|  michael|armbrust|no-reply@berkeley...|100000|
|345678|   Theater and Drama|  michael|armbrust|no-reply@berkeley...|100000|
+------+--------------------+---------+--------+--------------------+------+

+------+--------------------+---------+--------+--------------------+------+
|    id|      departmentName|firstName|lastName|               email|salary|
+------+--------------------+---------+--------+--------------------+------+
|345678|   Theater and Drama|     null| wendell|no-reply@berkeley...|160000|
|789012|Mechanical Engine...|     null| wendell|no-reply@berkeley...|160000|
|789012|Mechanical Engine...|    matei|    null|no-reply@waterloo...|140000|
|901234|   Indoor Recreation|    matei|    null|no-reply@waterloo...|140000|
|123456|    Computer Science| xiangrui|    meng|no-reply@stanford...|120000|
|901234|   Indoor Recreation| xiangrui|    meng|no-reply@stanford...|120000|
|123456|    Computer Science|  michael|armbrust|no-reply@berkeley...|100000|
|345678|   Theater and Drama|  michael|armbrust|no-reply@berkeley...|100000|
+------+--------------------+---------+--------+--------------------+------+

</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Merge">Merge<a class="anchor-link" href="#Merge">¶</a>
</h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [24]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sa</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">'Pirate'</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">'Monkey'</span><span class="p">),(</span><span class="mi">3</span><span class="p">,</span> <span class="s1">'Ninja'</span><span class="p">),(</span><span class="mi">4</span><span class="p">,</span> <span class="s1">'Spaghetti'</span><span class="p">)]</span>
<span class="n">df_a</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span><span class="n">sa</span><span class="p">,</span> <span class="p">[</span><span class="s1">'a_id'</span><span class="p">,</span><span class="s1">'a_name'</span><span class="p">])</span>
 
<span class="n">sb</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">'Rutabaga'</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">'Pirate'</span><span class="p">),(</span><span class="mi">3</span><span class="p">,</span> <span class="s1">'Ninja'</span><span class="p">),(</span><span class="mi">4</span><span class="p">,</span> <span class="s1">'Darth Vader'</span><span class="p">)]</span>
<span class="n">df_b</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span><span class="n">sb</span><span class="p">,</span> <span class="p">[</span><span class="s1">'b_id'</span><span class="p">,</span><span class="s1">'b_name'</span><span class="p">])</span>
 
<span class="n">df_a</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">df_b</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Join; Inner</span>
<span class="n">df_join</span> <span class="o">=</span> <span class="n">df_a</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s1">'a'</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">df_b</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s1">'b'</span><span class="p">),</span> <span class="n">f</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">"a.a_name"</span><span class="p">)</span> <span class="o">==</span> <span class="n">f</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">"b.b_name"</span><span class="p">),</span> <span class="s1">'inner'</span><span class="p">)</span>
<span class="n">df_join</span> <span class="o">=</span> <span class="n">df_join</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">"a.*"</span><span class="p">),</span> <span class="n">f</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">"b.*"</span><span class="p">))</span>
<span class="n">df_join</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>+----+---------+
|a_id|   a_name|
+----+---------+
|   1|   Pirate|
|   2|   Monkey|
|   3|    Ninja|
|   4|Spaghetti|
+----+---------+

+----+-----------+
|b_id|     b_name|
+----+-----------+
|   1|   Rutabaga|
|   2|     Pirate|
|   3|      Ninja|
|   4|Darth Vader|
+----+-----------+

+----+------+----+------+
|a_id|a_name|b_id|b_name|
+----+------+----+------+
|   3| Ninja|   3| Ninja|
|   1|Pirate|   2|Pirate|
+----+------+----+------+

</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [25]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Join: Left</span>
<span class="n">df_join</span> <span class="o">=</span> <span class="n">df_a</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s1">'a'</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">df_b</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s1">'b'</span><span class="p">),</span> <span class="n">f</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">"a.a_name"</span><span class="p">)</span> <span class="o">==</span> <span class="n">f</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">"b.b_name"</span><span class="p">),</span> <span class="s1">'left'</span><span class="p">)</span>
<span class="n">df_join</span> <span class="o">=</span> <span class="n">df_join</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">"a.*"</span><span class="p">),</span> <span class="n">f</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">"b.*"</span><span class="p">))</span>
<span class="n">df_join</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Join: Left</span>
<span class="n">df_join</span> <span class="o">=</span> <span class="n">df_a</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s1">'a'</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">df_b</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s1">'b'</span><span class="p">),</span> <span class="n">f</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">"a.a_name"</span><span class="p">)</span> <span class="o">==</span> <span class="n">f</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">"b.b_name"</span><span class="p">),</span> <span class="s1">'right'</span><span class="p">)</span>
<span class="n">df_join</span> <span class="o">=</span> <span class="n">df_join</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">"a.*"</span><span class="p">),</span> <span class="n">f</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">"b.*"</span><span class="p">))</span>
<span class="n">df_join</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Join: Full</span>
<span class="n">df_join</span> <span class="o">=</span> <span class="n">df_a</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s1">'a'</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">df_b</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s1">'b'</span><span class="p">),</span> <span class="n">f</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">"a.a_name"</span><span class="p">)</span> <span class="o">==</span> <span class="n">f</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">"b.b_name"</span><span class="p">),</span> <span class="s1">'full'</span><span class="p">)</span>
<span class="n">df_join</span> <span class="o">=</span> <span class="n">df_join</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">"a.*"</span><span class="p">),</span> <span class="n">f</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">"b.*"</span><span class="p">))</span>
<span class="n">df_join</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>+----+---------+----+------+
|a_id|   a_name|b_id|b_name|
+----+---------+----+------+
|   4|Spaghetti|null|  null|
|   3|    Ninja|   3| Ninja|
|   1|   Pirate|   2|Pirate|
|   2|   Monkey|null|  null|
+----+---------+----+------+

+----+------+----+-----------+
|a_id|a_name|b_id|     b_name|
+----+------+----+-----------+
|null|  null|   1|   Rutabaga|
|   3| Ninja|   3|      Ninja|
|   1|Pirate|   2|     Pirate|
|null|  null|   4|Darth Vader|
+----+------+----+-----------+

+----+---------+----+-----------+
|a_id|   a_name|b_id|     b_name|
+----+---------+----+-----------+
|null|     null|   1|   Rutabaga|
|   4|Spaghetti|null|       null|
|   3|    Ninja|   3|      Ninja|
|   1|   Pirate|   2|     Pirate|
|   2|   Monkey|null|       null|
|null|     null|   4|Darth Vader|
+----+---------+----+-----------+

</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="SQL-Query">SQL Query<a class="anchor-link" href="#SQL-Query">¶</a>
</h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [26]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># register the DataFrame as a temp table so that we can query it using SQL</span>
<span class="n">df</span><span class="o">.</span><span class="n">registerTempTable</span><span class="p">(</span><span class="s2">"df_example"</span><span class="p">)</span>

<span class="c1"># Perform the same query as the DataFrame above and return ``explain``</span>
<span class="n">df_table</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="s2">"SELECT departmentName, SUM(salary) AS tot_salary, AVG(salary) AS avg_salary FROM df_example GROUP BY departmentName"</span><span class="p">)</span>
<span class="n">df_table</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>+--------------------+----------+----------+
|      departmentName|tot_salary|avg_salary|
+--------------------+----------+----------+
|   Theater and Drama|    260000|  130000.0|
|Mechanical Engine...|    300000|  150000.0|
|    Computer Science|    220000|  110000.0|
|   Indoor Recreation|    260000|  130000.0|
+--------------------+----------+----------+

</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [27]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">spark</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>
    </div>
        <section class="comments"><h2>Comments</h2>
        
        
        <div id="disqus_thread"></div>
        <script>
        var disqus_shortname ="comafire",
            disqus_url="https://comafire.github.io/pages/de-spark-dataframe-10mins/",
        disqus_title="Data Engineering - Apache Spark Dataframe 10\ubd84\ub9cc\uc5d0 \ud6d1\uc5b4\ubcf4\uae30",
        disqus_identifier="cache/pages/de-spark-dataframe-10mins.html",
        disqus_config = function () {
            this.language = "en";
        };
        (function() {
            var dsq = document.createElement('script'); dsq.async = true;
            dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript>
    <a href="https://disqus.com" class="dsq-brlink" rel="nofollow">Comments powered by <span class="logo-disqus">Disqus</span></a>


        </section><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML" integrity="sha384-3lJUsx1TJHt7BA4udB5KPnDrlkO8T6J6v/op7ui0BbCjvZ9WqV4Xm6DTP6kQ/iBH" crossorigin="anonymous"></script><script type="text/x-mathjax-config">
        MathJax.Hub.Config({tex2jax: {inlineMath: [['$latex ','$'], ['\\(','\\)']]}});
        </script></article><!--End of body content--><footer id="footer">
            Contents © 2020         <a href="mailto:comafire@gmail.com">comafire</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         
            
            
        </footer>
</div>
</div>


        <script src="../../assets/js/all-nocdn.js"></script><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script>
</body>
</html>
