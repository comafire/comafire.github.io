<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# " lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="Comafire's Lab">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Comafire's Lab (old posts, page 8) | Comafire's Lab</title>
<link href="../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link href="../assets/css/ipython.min.css" rel="stylesheet" type="text/css">
<link href="../assets/css/nikola_ipython.css" rel="stylesheet" type="text/css">
<link href="https://fonts.googleapis.com/css?family=Playfair+Display:700,900" rel="stylesheet">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" href="../rss.xml">
<link rel="canonical" href="https://comafire.github.io/posts/index-8.html">
<link rel="prev" href="." type="text/html">
<link rel="next" href="index-7.html" type="text/html">
<!--[if lt IE 9]><script src="../assets/js/html5.js"></script><![endif]--><!-- Google Adsense --><script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script>
     (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-0670106451680512",
          enable_page_level_ads: true
     });
</script><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-81648003-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-81648003-1');
</script>
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Header and menu bar -->
<div class="container">
      <header class="blog-header py-3"><div class="row nbb-header align-items-center">
          <div class="col-md-3 col-xs-2 col-sm-2" style="width: auto;">
            <button class="navbar-toggler navbar-light bg-light nbb-navbar-toggler" type="button" data-toggle="collapse" data-target=".bs-nav-collapsible" aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse bs-nav-collapsible bootblog4-search-form-holder">
                
<!-- DuckDuckGo custom search -->
<form method="get" id="search" action="https://duckduckgo.com/" class="navbar-form pull-left">
<input type="hidden" name="sites" value="https://comafire.github.io/"><input type="hidden" name="k8" value="#444444"><input type="hidden" name="k9" value="#D51920"><input type="hidden" name="kt" value="h"><input type="text" name="q" maxlength="255" placeholder="Search…" class="span2" style="margin-top: 4px;"><input type="submit" value="DuckDuckGo Search" style="visibility: hidden;">
</form>
<!-- End of custom search -->

            </div>
        </div>
          <div class="col-md-6 col-xs-10 col-sm-10 bootblog4-brand" style="width: auto;">
            <a class="navbar-brand blog-header-logo text-dark" href="https://comafire.github.io/">

            <span id="blog-title">Comafire's Lab</span>
        </a>
          </div>
            <div class="col-md-3 justify-content-end align-items-center bs-nav-collapsible collapse flex-collapse bootblog4-right-nav">
            <nav class="navbar navbar-light bg-white"><ul class="navbar-nav bootblog4-right-nav"></ul></nav>
</div>
    </div>
</header><nav class="navbar navbar-expand-md navbar-light bg-white static-top"><div class="collapse navbar-collapse bs-nav-collapsible" id="bs-navbar">
            <ul class="navbar-nav nav-fill d-flex w-100">
<li class="nav-item">
<a href="../index.html" class="nav-link">Home</a>
            </li>
<li class="nav-item dropdown">
<a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Pages</a>
            <div class="dropdown-menu">
                    <a href="../pages/st-kilda-pier" class="dropdown-item">St. Kilda Pier</a>
                    <a href="../pages/notebooks-skp" class="dropdown-item">Notebooks for St. Kilda Pier</a>
            </div>
            </li>
<li class="nav-item dropdown">
<a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Posts</a>
            <div class="dropdown-menu">
                    <a href="../posts" class="dropdown-item">Posts</a>
                    <a href="../archive.html" class="dropdown-item">Archive</a>
                    <a href="../categories/" class="dropdown-item">Tag</a>
                    <a href="../rss.xml" class="dropdown-item">RSS</a>
            </div>
                </li>
<li class="nav-item">
<a href="https://github.com/comafire" class="nav-link">GitHub</a>

                
            </li>
</ul>
</div>
<!-- /.navbar-collapse -->
</nav>
</div>

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        
        
    
        

    
        
    <div class="postindex">
            <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="2018-bitcoin-core-basic/" class="u-url">BitCoin 설치</a></h1>
                <div class="metadata">
                    <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                        comafire
                    </span></p>
            <p class="dateline">
            <a href="2018-bitcoin-core-basic/" rel="bookmark">
            <time class="published dt-published" datetime="2018-03-03T00:00:00+09:00" itemprop="datePublished" title="2018-03-03 00:00">2018-03-03 00:00</time></a>
            </p>
                        <p class="commentline">
        
    <a href="2018-bitcoin-core-basic/#disqus_thread" data-disqus-identifier="cache/posts/2018-bitcoin-core-basic.html">Comments</a>


                </p>
</div>
            </header><div class="e-content entry-content">
                    <div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Bitcoin에 대한 구조를 알아보기 위해 일단 Bitcoin을 설치해보고 간단하게 거래 테스트를 해보았습니다.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Bitcoin-설치">Bitcoin 설치<a class="anchor-link" href="2018-bitcoin-core-basic/#Bitcoin-%EC%84%A4%EC%B9%98">¶</a>
</h2>
<p>운영체제: Ubuntu 16.04 LTS</p>
<p>Github 에서 bitcoin 소스를 다운로드 받습니다.</p>

<pre><code>git clone https://github.com/bitcoin/bitcoin.git</code></pre>
<p>bitcoin 의존성 패키지 목록 소스의 docs/dependencies.md 파일 또는 아래 링크를 참조하세요</p>
<p><a href="https://github.com/bitcoin/bitcoin/blob/master/doc/dependencies.md">https://github.com/bitcoin/bitcoin/blob/master/doc/dependencies.md</a></p>
<p>의존성 패키지 설치를 설치합니다.</p>
<p>gcc 빌드 툴 및 python3</p>

<pre><code>sudo apt-get update
sudo apt-get install -y build-essential bsdmainutils autoconf automake autotools-dev pkg-config libtool python3</code></pre>
<p>openssl, boost, event, miniupnpc, zmq 라이브러리</p>

<pre><code>sudo apt-get install -y libssl-dev libboost-all-dev libevent-dev libminiupnpc-dev libzmq3-dev</code></pre>
<p>db4.8 (Ubuntu는 기본 5.1 버전을 사용하기 때문에 4.8 버전으로 다시 설치)</p>

<pre><code>sudo apt-get install -y software-properties-common
sudo add-apt-repository ppa:bitcoin/bitcoin
sudo apt-get update
sudo apt-get install -y libdb4.8-dev libdb4.8++-dev</code></pre>
<p>GUI 를 위한 QT5 설치</p>

<pre><code>sudo apt-get install -y libqt5gui5 libqt5core5a libqt5dbus5 qttools5-dev qttools5-dev-tools libprotobuf-dev protobuf-compiler
sudo apt-get install -y libqrencode-dev</code></pre>
<p>bitcoin 컴파일</p>

<pre><code>cd bitcoin
./autogen.sh
./configure
make</code></pre>
<p>문제 없이 컴파일이 완료되었으면 아래 명령으로 설치를 완료합니다.</p>

<pre><code>sudo make install</code></pre>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Bitcoin-Core-실행">Bitcoin Core 실행<a class="anchor-link" href="2018-bitcoin-core-basic/#Bitcoin-Core-%EC%8B%A4%ED%96%89">¶</a>
</h2>
<p>비트코인을 실제 네트워크 상에서 돌리기보다는 동작 방식을 익히기 위해 테스트로 사용합니다.</p>
<ul>
<li>Testnet: 인터넷 상의 테스트 네트워크</li>
<li>Regtest: 로컬 네트워크상의 테스트 네트워크</li>
</ul>
<p>Testnet 은 인터넷 상에 공개된 테스트 네트워크여서 이미 대량의 블록 체인이 존재하기 때문에 초기 기동시 모든 데이터를 다운로드 받는데 시간이 걸리므로 간단한 테스트용으로는 Regtest 가 적당합니다.</p>
<p>게다가 Bitcoin Core 에서는 0.13 버전 이후로 테스트넷 이외에서 마이닝 하는 기능을 빼버렸기 때문에 굳이 모든 데이터를 다운로드 받을 필요가 없습니다.</p>
<p>사용을 위한 모든 정보는 틀별히 설정하지 않았다면 계정의 .bitcoin 디렉안에 있습니다.</p>
<p>아래와 같이 daemon 형식으로 띄워 줍니다.</p>

<pre><code>bitcoind -regtest -daemon</code></pre>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Bitcoin-거래-테스트">Bitcoin 거래 테스트<a class="anchor-link" href="2018-bitcoin-core-basic/#Bitcoin-%EA%B1%B0%EB%9E%98-%ED%85%8C%EC%8A%A4%ED%8A%B8">¶</a>
</h2>
<p>송금 테스트를 하기 위해서 테스트용 비트코인을 생성해 봅니다. 블록을 생성(채굴)한 보상으로 비트코인을 받을 수 있으며, 채굴자는 보상 후 100블록 이후에 송금이 가능하기 때문에 101개의 블록을 생성해 봅니다.</p>

<pre><code>bitcoin-cli -regtest generate 101
[
  "05f8a8ea539fc9d51538e45dc501543da9ead2b7321c6224bfff053b74247ef8",
  "4a2a7cdd7fa6948f33b1507de7ba03501b9f352833d3690c54f95e1a5b4c1b75",
  ...
  "6a5af93afbedee8b88660cadde8b041077e73a79598b60f0e30bf60090a8baa5",
  "5dc2356eb4381c3d10341cbab83d767dd91ab527d7d394b9a5b4b7fc293b9803"
]

bitcoin-cli -regtest getblockcount
101</code></pre>
<p>채굴자의 잔고를 확인해봅니다. 50 비트코인이 생성된 것을 확인할 수 있습니다.</p>

<pre><code>bitcoin-cli -regtest getbalance
50.00000000</code></pre>
<p>이제 이 비트코인을 송금 받을 거래에 사용할 계좌를 생성하고 잔고를 확인해봅니다.</p>

<pre><code>bitcoin-cli -regtest getnewaddress comafire
2Mzy66ig8SwcC7UdQVrzYHtRDxZgBoxdq3G

bitcoin-cli -regtest getbalance comafire
0.00000000</code></pre>
<p>채굴자에게서 비트코인을 받아봅니다. 송금시에는 계좌 주소가 필요합니다. 송금을 하면 송장번호라 할수 있는 트랜잭션 인덱스가 출력되고 이를 확인해 볼수 있습니다. 아직 송금이 완료되지는 않은 상태라 미완료 인덱스를 볼수 있도록 listunspent 명령에 0 값을 넣어 확인합니다.</p>

<pre><code>bitcoin-cli -regtest sendtoaddress 2Mzy66ig8SwcC7UdQVrzYHtRDxZgBoxdq3G 5
ddc39e2c235a0357d27005602ecc83143b01caf51976c7c2a4a3abcf474744f7

bitcoin-cli -regtest listunspent 0
[
  {
    "txid": "ddc39e2c235a0357d27005602ecc83143b01caf51976c7c2a4a3abcf474744f7",
    "vout": 0,
    "address": "2Mzy66ig8SwcC7UdQVrzYHtRDxZgBoxdq3G",
    "account": "comafire",
    "redeemScript": "0014da2f417e870b024d832839a790282a9185e40f4d",
    "scriptPubKey": "a91454b3c3f3c71578881eaaa0b540ad7710babd917287",
    "amount": 5.00000000,
    "confirmations": 0,
    "spendable": true,
    "solvable": true,
    "safe": true
  },
  {
    "txid": "ddc39e2c235a0357d27005602ecc83143b01caf51976c7c2a4a3abcf474744f7",
    "vout": 1,
    "address": "2MwhGAo4Y5BBEPnt9mJBpFjNZRDGBRfYN7x",
    "redeemScript": "0014a88a6ade15594dc14b92fb985398378d79bace28",
    "scriptPubKey": "a91430cd23915145b69463dde98b080f43b10e2e37ea87",
    "amount": 44.99996240,
    "confirmations": 0,
    "spendable": true,
    "solvable": true,
    "safe": true
  }
]</code></pre>
<p>송금은 완료 되지 않았지만, 수수료는 이미 떼어져 있네요.</p>
<p>이제 채굴을 통해서 미완료 트랙잰션을 완료하고 계좌 잔고를 확인해봅니다.</p>

<pre><code>bitcoin-cli -regtest generate 1
[
  "623f16c369a64e3b14da59aa1a901d9b28b6d25d875219ae62d714acb266894f"
]

bitcoin-cli -regtest listunspent

bitcoin-cli -regtest getbalance comafire
5.00000000</code></pre>
<p>5 비트코인이 입금된 것을 확인해 볼수 있습니다.</p>
<p>이제 기록상에서도 송금된 내역을 확인해 볼 수 있습니다.</p>

<pre><code>bitcoin-cli -regtest listunspent
[
  {
    "txid": "fbd7979b39d018d235fc61cc9d895b6bed6aa385fc15db11a5f006f18d59d1ef",
    "vout": 0,
    "address": "miV8mJqKPBtRSVdyhKPMpy6CQsy7omodJK",
    "scriptPubKey": "2102cf0d8f1c775ef3697128eea2c8a18082f10498306cd9d032f96c3f50736bfa29ac",
    "amount": 50.00000000,
    "confirmations": 101,
    "spendable": true,
    "solvable": true,
    "safe": true
  },
  {
    "txid": "ddc39e2c235a0357d27005602ecc83143b01caf51976c7c2a4a3abcf474744f7",
    "vout": 0,
    "address": "2Mzy66ig8SwcC7UdQVrzYHtRDxZgBoxdq3G",
    "account": "comafire",
    "redeemScript": "0014da2f417e870b024d832839a790282a9185e40f4d",
    "scriptPubKey": "a91454b3c3f3c71578881eaaa0b540ad7710babd917287",
    "amount": 5.00000000,
    "confirmations": 1,
    "spendable": true,
    "solvable": true,
    "safe": true
  },
  {
    "txid": "ddc39e2c235a0357d27005602ecc83143b01caf51976c7c2a4a3abcf474744f7",
    "vout": 1,
    "address": "2MwhGAo4Y5BBEPnt9mJBpFjNZRDGBRfYN7x",
    "redeemScript": "0014a88a6ade15594dc14b92fb985398378d79bace28",
    "scriptPubKey": "a91430cd23915145b69463dde98b080f43b10e2e37ea87",
    "amount": 44.99996240,
    "confirmations": 1,
    "spendable": true,
    "solvable": true,
    "safe": true
  }
]</code></pre>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
</div>
                </div>
            </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="2017-python-jupyter-kernel-gateway-module/" class="u-url">2017-python-jupyter-kernel-gateway-module</a></h1>
                <div class="metadata">
                    <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                        comafire
                    </span></p>
            <p class="dateline">
            <a href="2017-python-jupyter-kernel-gateway-module/" rel="bookmark">
            <time class="published dt-published" datetime="2017-09-16T00:00:00+09:00" itemprop="datePublished" title="2017-09-16 00:00">2017-09-16 00:00</time></a>
            </p>
                        <p class="commentline">
        
    <a href="2017-python-jupyter-kernel-gateway-module/#disqus_thread" data-disqus-identifier="cache/posts/2017-python-jupyter-kernel-gateway-module.html">Comments</a>


                </p>
</div>
            </header><div class="e-content entry-content">
                    <div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [1]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="kn">from</span> <span class="nn">IPython.core.interactiveshell</span> <span class="kn">import</span> <span class="n">InteractiveShell</span>
<span class="n">InteractiveShell</span><span class="o">.</span><span class="n">ast_node_interactivity</span> <span class="o">=</span> <span class="s2">"all"</span>

<span class="kn">from</span> <span class="nn">IPython.core.display</span> <span class="kn">import</span> <span class="n">display</span><span class="p">,</span> <span class="n">HTML</span>
<span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="s2">"&lt;style&gt;.container { width:100% !important; }&lt;/style&gt;"</span><span class="p">))</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="o">%</span><span class="k">matplotlib</span> inline

<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="n">np</span><span class="o">.</span><span class="n">set_printoptions</span><span class="p">(</span><span class="n">precision</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>
<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">'display.max_rows'</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span> 
<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">'display.max_columns'</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span> 
<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">'display.max_colwidth'</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<style>.container { width:100% !important; }</style>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [2]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">io</span><span class="o">,</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">logging</span><span class="o">,</span> <span class="nn">imp</span><span class="o">,</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">time</span><span class="o">,</span> <span class="nn">pickle</span><span class="o">,</span> <span class="nn">requests</span><span class="o">,</span> <span class="nn">json</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">from</span> <span class="nn">os</span> <span class="kn">import</span> <span class="n">listdir</span>
<span class="kn">from</span> <span class="nn">os.path</span> <span class="kn">import</span> <span class="n">isfile</span><span class="p">,</span> <span class="n">join</span>

<span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">()</span>
<span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">()</span>
<span class="n">log</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [3]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="k">class</span> <span class="nc">Store</span><span class="p">:</span>
    <span class="n">store</span> <span class="o">=</span> <span class="bp">None</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">store</span> <span class="o">=</span> <span class="p">{}</span>
    
    <span class="k">def</span> <span class="nf">post</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">req</span><span class="p">):</span>
        <span class="n">user_id</span> <span class="o">=</span> <span class="n">req</span><span class="p">[</span><span class="s2">"path"</span><span class="p">][</span><span class="s2">"user_id"</span><span class="p">]</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">req</span><span class="p">[</span><span class="s2">"body"</span><span class="p">][</span><span class="s2">"name"</span><span class="p">]</span>
        <span class="n">res</span> <span class="o">=</span> <span class="p">{}</span>
  
        <span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="p">[</span><span class="n">user_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span>
        <span class="n">res</span><span class="p">[</span><span class="s2">"status"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"SUCCESS"</span>
        <span class="n">res</span><span class="p">[</span><span class="s2">"name"</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span>
        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">req</span><span class="p">):</span>
        <span class="n">user_id</span> <span class="o">=</span> <span class="n">req</span><span class="p">[</span><span class="s2">"path"</span><span class="p">][</span><span class="s2">"user_id"</span><span class="p">]</span>
        <span class="n">res</span> <span class="o">=</span> <span class="p">{}</span>
        
        <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="p">[</span><span class="n">user_id</span><span class="p">]</span>
        <span class="n">res</span><span class="p">[</span><span class="s2">"status"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"SUCCESS"</span>
        <span class="n">res</span><span class="p">[</span><span class="s2">"name"</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span>
        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">req</span><span class="p">):</span>
        <span class="n">user_id</span> <span class="o">=</span> <span class="n">req</span><span class="p">[</span><span class="s2">"path"</span><span class="p">][</span><span class="s2">"user_id"</span><span class="p">]</span>
        <span class="n">res</span> <span class="o">=</span> <span class="p">{}</span>
        
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="p">[</span><span class="n">user_id</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>
                </div>
            </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="2017-python-jupyter-kernel-gateway-for-rest-api/" class="u-url">Jupyter 노트북으로 Rest API 개발해보기</a></h1>
                <div class="metadata">
                    <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                        comafire
                    </span></p>
            <p class="dateline">
            <a href="2017-python-jupyter-kernel-gateway-for-rest-api/" rel="bookmark">
            <time class="published dt-published" datetime="2017-09-16T00:00:00+09:00" itemprop="datePublished" title="2017-09-16 00:00">2017-09-16 00:00</time></a>
            </p>
                        <p class="commentline">
        
    <a href="2017-python-jupyter-kernel-gateway-for-rest-api/#disqus_thread" data-disqus-identifier="cache/posts/2017-python-jupyter-kernel-gateway-for-rest-api.html">Comments</a>


                </p>
</div>
            </header><div class="e-content entry-content">
                    <div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [1]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="kn">from</span> <span class="nn">IPython.core.interactiveshell</span> <span class="kn">import</span> <span class="n">InteractiveShell</span>
<span class="n">InteractiveShell</span><span class="o">.</span><span class="n">ast_node_interactivity</span> <span class="o">=</span> <span class="s2">"all"</span>

<span class="kn">from</span> <span class="nn">IPython.core.display</span> <span class="kn">import</span> <span class="n">display</span><span class="p">,</span> <span class="n">HTML</span>
<span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="s2">"&lt;style&gt;.container { width:100% !important; }&lt;/style&gt;"</span><span class="p">))</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="o">%</span><span class="k">matplotlib</span> inline

<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="n">np</span><span class="o">.</span><span class="n">set_printoptions</span><span class="p">(</span><span class="n">precision</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>
<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">'display.max_rows'</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span> 
<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">'display.max_columns'</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span> 
<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">'display.max_colwidth'</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<style>.container { width:100% !important; }</style>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [2]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">io</span><span class="o">,</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">logging</span><span class="o">,</span> <span class="nn">imp</span><span class="o">,</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">time</span><span class="o">,</span> <span class="nn">pickle</span><span class="o">,</span> <span class="nn">requests</span><span class="o">,</span> <span class="nn">json</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">from</span> <span class="nn">os</span> <span class="kn">import</span> <span class="n">listdir</span>
<span class="kn">from</span> <span class="nn">os.path</span> <span class="kn">import</span> <span class="n">isfile</span><span class="p">,</span> <span class="n">join</span>

<span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">()</span>
<span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">()</span>
<span class="n">log</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">pretty_json</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="README">README<a class="anchor-link" href="2017-python-jupyter-kernel-gateway-for-rest-api/#README">¶</a>
</h2>
<p>데이터 분석을 할때에는 주로 jupyter에서 python를 많이 사용합니다. 머신 사양이 좋다면 pyspark을 이용하여 데이터 전처리시 편하게 대용량 램과 멀티코어를 활용할 수도 있고, python에 있는 많은 편리한 유틸과 머신러닝 라이브러리도 생산성을 배가 시켜 줍니다. 게다가 간단한 PoC를 위한 개발을 하면서 문서화 및 발표자료까지 한번에 만들수 있다는 매력도 있습니다.</p>
<p></p>
<p>
하지만, PoC 할때 가끔 FrontEnd 단과 연계가 필요해서 정제 분석한 데이터 기반으로 간단하게 Restful API를 작성해 줘야 할 경우가 종종 있는데, 이럴때는 jupyter가 생산성에 별 도움을 주지 못합니다. 이때 마다 다시 로컬 IDE를 사용하거나, 개발은 jupyter에서 실행은 nbconvert를 이용해 .py 로 변환해 사용하는 불편함을 감수해야 했습니다.</p>
<p></p>
<p>
그렇지만, jupyter의 kernel_gateway 모듈을 사용한다면, 이 문제를 극복 할 수 있습니다. kernel_gateway 모듈은 jupyter 노트북 상에서 바로 Restful API에 대해 개발과 테스트가 가능하도록 도움을 줍니다.</p>
<p></p>
<p>
<a href="https://github.com/jupyter/kernel_gateway">https://github.com/jupyter/kernel_gateway</a></p>
<p></p>
<p>
설치는 간단히 pip 를 이용해 가능합니다.</p>
<p></p>
<p></p>
<div class="highlight"><pre><span></span>&gt; pip install jupyter_kernel_gateway
</pre></div>
<p></p>
<p>
설치가 끝났다면 이제 kernel_gateway 모듈을 사용해 보겠습니다.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Module">Module<a class="anchor-link" href="2017-python-jupyter-kernel-gateway-for-rest-api/#Module">¶</a>
</h2>
<p>현재 kernel_gateway 모듈은 하나의 jupyter 파일(.ipynb)만 Server로 띄울수 있습니다. 간단한 PoC의 경우 한 파일안에 모든 구현을 담는게 가능하지만, 코드의 가독성을 위해서라도 모듈로 분리하는 것이 좋습니다. jupyter에서는 다른 파일을 로드할 수 있는 %run 매직 키워드를 제공합니다.</p>
<p></p>
<p>
%run 매직 키워드는 해당 파일의 실행을 전제 하기 때문에 모듈안에 클래스를 만들어서 해당 클래스를 통해 모듈화를 진행합니다.</p>
<p></p>
<p>
2017-python-jupyter-kernel-gateway-module.ipynb 파일안의 Restful API 수행시 필요한 클래스를 로드합니다.</p>
<p></p>
<p>
파일의 내용은 아래와 같습니다. 해당 파일은 사이트내에서 파일이름으로 찾아서 보실 수도 있습니다.</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">IPython.core.interactiveshell</span> <span class="kn">import</span> <span class="n">InteractiveShell</span>
<span class="n">InteractiveShell</span><span class="o">.</span><span class="n">ast_node_interactivity</span> <span class="o">=</span> <span class="s2">"all"</span>

<span class="kn">from</span> <span class="nn">IPython.core.display</span> <span class="kn">import</span> <span class="n">display</span><span class="p">,</span> <span class="n">HTML</span>
<span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="s2">"&lt;style&gt;.container { width:100% !important; }&lt;/style&gt;"</span><span class="p">))</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="n">np</span><span class="o">.</span><span class="n">set_printoptions</span><span class="p">(</span><span class="n">precision</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>
<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">'display.max_rows'</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span> 
<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">'display.max_columns'</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span> 
<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">'display.max_colwidth'</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">io</span><span class="o">,</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">logging</span><span class="o">,</span> <span class="nn">imp</span><span class="o">,</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">time</span><span class="o">,</span> <span class="nn">pickle</span><span class="o">,</span> <span class="nn">requests</span><span class="o">,</span> <span class="nn">json</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">from</span> <span class="nn">os</span> <span class="kn">import</span> <span class="n">listdir</span>
<span class="kn">from</span> <span class="nn">os.path</span> <span class="kn">import</span> <span class="n">isfile</span><span class="p">,</span> <span class="n">join</span>

<span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">()</span>
<span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">()</span>
<span class="n">log</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Store</span><span class="p">:</span>
    <span class="n">store</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">store</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">post</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">req</span><span class="p">):</span>
        <span class="n">user_id</span> <span class="o">=</span> <span class="n">req</span><span class="p">[</span><span class="s2">"path"</span><span class="p">][</span><span class="s2">"user_id"</span><span class="p">]</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">req</span><span class="p">[</span><span class="s2">"body"</span><span class="p">][</span><span class="s2">"name"</span><span class="p">]</span>
        <span class="n">res</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="p">[</span><span class="n">user_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span>
        <span class="n">res</span><span class="p">[</span><span class="s2">"status"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"SUCCESS"</span>
        <span class="n">res</span><span class="p">[</span><span class="s2">"name"</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span>
        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">req</span><span class="p">):</span>
        <span class="n">user_id</span> <span class="o">=</span> <span class="n">req</span><span class="p">[</span><span class="s2">"path"</span><span class="p">][</span><span class="s2">"user_id"</span><span class="p">]</span>
        <span class="n">res</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="p">[</span><span class="n">user_id</span><span class="p">]</span>
        <span class="n">res</span><span class="p">[</span><span class="s2">"status"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"SUCCESS"</span>
        <span class="n">res</span><span class="p">[</span><span class="s2">"name"</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span>
        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">req</span><span class="p">):</span>
        <span class="n">user_id</span> <span class="o">=</span> <span class="n">req</span><span class="p">[</span><span class="s2">"path"</span><span class="p">][</span><span class="s2">"user_id"</span><span class="p">]</span>
        <span class="n">res</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="p">[</span><span class="n">user_id</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [3]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="o">%</span><span class="k">run</span> ./2017-python-jupyter-kernel-gateway-module.ipynb
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<style>.container { width:100% !important; }</style>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Store">Store<a class="anchor-link" href="2017-python-jupyter-kernel-gateway-for-rest-api/#Store">¶</a>
</h2>
<p>Restful API를 위해 모듈안에 예제로 만들어 놓은 Store 클래스를 생성합니다.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [4]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">store</span> <span class="o">=</span> <span class="n">Store</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="POST-/store/:user_id">POST /store/:user_id<a class="anchor-link" href="2017-python-jupyter-kernel-gateway-for-rest-api/#POST-/store/:user_id">¶</a>
</h3>
<p>kernel_gateway 에 handler를 호출하기 위한 코드가 이미 구현되어 있기 때문에 독립된 셀안에 handler 만 작성해 주면 됩니다.</p>
<p></p>
<p>
REQUEST 에 개발시 테스트를 위한 요청 파라미터를 작성합니다. 개발시에는 서버 없이도 jupyter 안에서 해당 함수에 대해 REQUEST 요청을 Mock형태로 바로 테스트 해볼 수 있기 때문에 아주 편리합니다.</p>
<p></p>
<p>
handler 코드는 독립된 셀에 "# [POST/GET/PUT/DELETE] /url" 형식으로 주석을 작성하면 해당 셀이 kernel_gateway 모듈에서 handler 로 간주됩니다.</p>
<p></p>
<p>
개발 후 kernel_gateway를 통해 서버를 띄우게 되면 사용자 요청시 사용자 요청 파라미터는 REQUEST에 자동으로 파싱되어 들어가고 해당 handler 셀이 수행됩니다.</p>
<p></p>
<p>
리턴 값은 print를 통해 출력된 값이 자동으로 사용자 응답으로 전송되게 됩니다.</p>
<p></p>
<p>
이제 개발 테스트를 위한 REQUEST를 만들고, jupyter 내에서 handler를 통해 POST 작업을 수행해 보겠습니다.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [5]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">REQUEST</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span>
    <span class="s2">"path"</span> <span class="p">:</span> <span class="p">{</span> <span class="s2">"user_id"</span> <span class="p">:</span> <span class="s2">"user1"</span> <span class="p">},</span>
    <span class="s2">"body"</span> <span class="p">:</span> <span class="p">{</span> <span class="s2">"name"</span> <span class="p">:</span> <span class="s2">"user1 store"</span> <span class="p">}</span>
<span class="p">})</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [6]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="c1"># POST /store/:user_id</span>
<span class="n">req</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">REQUEST</span><span class="p">)</span>
<span class="n">res</span> <span class="o">=</span> <span class="n">store</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>{"status": "SUCCESS", "name": "user1 store"}
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="GET-/store/:user_id">GET /store/:user_id<a class="anchor-link" href="2017-python-jupyter-kernel-gateway-for-rest-api/#GET-/store/:user_id">¶</a>
</h3>
<p>이제 저장한 store를 GET 를 통해 가져오는 handler를 수행해 보겠습니다.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [7]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">REQUEST</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span>
    <span class="s2">"path"</span> <span class="p">:</span> <span class="p">{</span> <span class="s2">"user_id"</span> <span class="p">:</span> <span class="s2">"user1"</span> <span class="p">}</span>
<span class="p">})</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [8]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="c1"># GET /store/:user_id</span>
<span class="n">req</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">REQUEST</span><span class="p">)</span>
<span class="n">res</span> <span class="o">=</span> <span class="n">store</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>{"status": "SUCCESS", "name": "user1 store"}
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>이제 Restful API 작성이 끝났습니다.</p>
<p></p>
<p>
개발을 점진 적으로 진행한다고 하였을때, 개발을 진행하면서 새로운 Restful API함수를 모듈 클래스에 추가하고 테스트하는 순서를 반복하게 됩니다. 하지만, %run 에 로드된 모듈은 변경시 자동으로 로드되지 않기 때문에 위 아래를 왔다 갔다 하면서 해당 셀을 다시 수행하는 불편함은 존재합니다.</p>
<p></p>
<p>
그래서 이경우 저는 빠르게 해당 위치를 찾기 위해 jupyter extension 으로 Markdown 셀의 제목에 대해서 자동으로 Table of Content를 생성해주는 toc2 확장을 사용합니다.</p>
<p></p>
<p>
<a href="https://github.com/ipython-contrib/jupyter_contrib_nbextensions/tree/master/src/jupyter_contrib_nbextensions/nbextensions/toc2">https://github.com/ipython-contrib/jupyter_contrib_nbextensions/tree/master/src/jupyter_contrib_nbextensions/nbextensions/toc2</a></p>
<p></p>
<p>
해당 확장을 사용할 경우 위해서 작성했던 Markdown 창의 제목으로 빠르게 찾아 갈수 있기때문에 스크롤의 압박에서 벗어날 수 있습니다.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Test">Test<a class="anchor-link" href="2017-python-jupyter-kernel-gateway-for-rest-api/#Test">¶</a>
</h2>
<p>이제 현재까지 작성한 파일을 kernel_gateway 모듈을 이용하여 Restful API 서버로 띄운 후에 request 모듈을 이용하여 실 테스트를 진행해 봅니다.</p>
<p></p>
<p>
jupyter에서 Terminal 창을 열고 아래 명령으로 수행해 봅니다.</p>
<p></p>
<p></p>

<pre><code>jupyter kernelgateway \
--KernelGatewayApp.ip=0.0.0.0 \
--KernelGatewayApp.port=8088 \
--KernelGatewayApp.api=notebook-http \
--KernelGatewayApp.seed_uri=/root/volume/workspace/2017-python-jupyter-kernel-gateway-for-rest-api.ipynb</code></pre>
<p></p>
<p>
서버가 제대로 수행되었다면 아래와 같은 로그가 보입니다.</p>
<p></p>
<p></p>

<pre><code>[KernelGatewayApp] Kernel started: 4d43a978-11ec-4801-b156-a5e234a82e91
[KernelGatewayApp] Registering resource: /store/(?P&lt;user_id&gt;[^\/]+), methods: ([u'POST', u'GET'])
[KernelGatewayApp] Registering resource: /_api/spec/swagger.json, methods: (GET)
[KernelGatewayApp] Jupyter Kernel Gateway at http://127.0.0.1:8088</code></pre>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="EndPoint">EndPoint<a class="anchor-link" href="2017-python-jupyter-kernel-gateway-for-rest-api/#EndPoint">¶</a>
</h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [9]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">URL</span> <span class="o">=</span> <span class="s1">'http://127.0.0.1:8088'</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="POST-/store/:user_id">POST /store/:user_id<a class="anchor-link" href="2017-python-jupyter-kernel-gateway-for-rest-api/#POST-/store/:user_id">¶</a>
</h3>
<p>POST 메서드에 대해 서버에 실제 요청을 보내서 테스트해봅니다.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [10]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="k">if</span> <span class="s1">'KERNEL_GATEWAY'</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
    <span class="n">body</span> <span class="o">=</span> <span class="p">{</span> 
        <span class="s2">"name"</span> <span class="p">:</span> <span class="s2">"user2 store"</span><span class="p">,</span>
    <span class="p">}</span>    
    <span class="n">res</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">URL</span> <span class="o">+</span> <span class="s2">"/store/user2"</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">body</span><span class="p">)</span>  
    <span class="n">res</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
    <span class="k">print</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">json</span><span class="p">())</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>{u'status': u'SUCCESS', u'name': u'user2 store'}
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="GET-/store/:user_id">GET /store/:user_id<a class="anchor-link" href="2017-python-jupyter-kernel-gateway-for-rest-api/#GET-/store/:user_id">¶</a>
</h3>
<p>GET 메서드에 대해 서버에 실제 요청을 보내서 테스트해봅니다.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [11]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="k">if</span> <span class="s1">'KERNEL_GATEWAY'</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">URL</span> <span class="o">+</span> <span class="s2">"/store/user2"</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">body</span><span class="p">)</span>  
    <span class="n">res</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
    <span class="k">print</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">json</span><span class="p">())</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>{u'status': u'SUCCESS', u'name': u'user2 store'}
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>지금 까지 jupyter 상에서 kernel_gateway 모듈을 통해서 편리하게 Restful API 서버를 개발하는 법에 대해서 알아봤습니다.</p>

</div>
</div>
</div>
</div>
                </div>
            </article>
</div>
    
        <ul class="pager postindexpager clearfix">
<li class="previous"><a href="." rel="prev">Newer posts</a></li>
            <li class="next"><a href="index-7.html" rel="next">Older posts</a></li>
        </ul>
<script>var disqus_shortname="comafire";(function(){var a=document.createElement("script");a.async=true;a.src="https://"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)}());</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML" integrity="sha256-SDRP1VVYu+tgAGKhddBSl5+ezofHKZeI+OzxakbIe/Y=" crossorigin="anonymous"></script><script type="text/x-mathjax-config">
        MathJax.Hub.Config({tex2jax: {inlineMath: [['$latex ','$'], ['\\(','\\)']]}});
        </script><!--End of body content--><footer id="footer">
            Contents © 2019         <a href="mailto:comafire@gmail.com">comafire</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         
            
        </footer>
</div>
</div>


        <script src="../assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script>
</body>
</html>
